<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ben Franklin's Virtue Tracker</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap');

    /* Parchment-like tiled background */
    body {
      margin: 0;
      padding: 0;
      background: url("tile.png") repeat;
      font-family: 'Dancing Script', cursive;
      min-height: 100vh;
      color: #333;
    }
    /* Header styling with two-line placeholder for subtitle */
    header {
      max-width: 700px;
      margin: 1em auto 0 auto;
      padding: 1em;
      background-color: rgba(255,255,255,0.9);
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
      border-radius: 8px;
      margin-bottom: 0;
    }
    header h1, header p {
      text-align: center;
      margin: 0.25em 0;
    }
    header h1 {
      font-size: 3em;
    }
    header p {
      font-size: 1.75em;
      min-height: 3em; /* Reserve space for two lines */
      display: flex;
      align-items: center;
      justify-content: center;
    }
    main {
      max-width: 700px;
      margin: 0 auto 1em auto;
      padding: 1em;
      background-color: rgba(255,255,255,0.9);
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
      border-radius: 8px;
      position: relative;
      margin-top: 0;
    }
    /* Table styling */
    #virtueTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0;
    }
    #virtueTable th,
    #virtueTable td {
      border: 1px solid #000;
      text-align: center;
      height: 3em;
      position: relative;
      cursor: pointer;
    }
    /* Virtue letter cell */
    #virtueTable td.virtue-label {
      font-weight: bold;
      font-size: 1.2em;
      width: 2.5em;
      padding: 0.2em;
      cursor: pointer;
    }
    /* Highlight the day cell for the current day */
    .day-highlight {
      background-color: rgba(255,215,0,0.5);
    }
    /* Toggle checkmark style */
    .checked::after {
      content: "‚úì";
      color: green;
      font-weight: bold;
      font-size: 1.5em;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    /* Week navigation container using spans for arrows (emojis as buttons) */
    #weekNav {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 1em;
      gap: 1em;
      font-size: 1.5em;
    }
    /* Lighter arrow "buttons" */
    #weekNav .arrow {
      cursor: pointer;
      padding: 0.5em;
      background: #ddd;
      color: #333;
      border-radius: 5px;
      user-select: none;
    }
    #weekDisplay {
      font-weight: bold;
    }
    /* Action buttons container (save and clear) positioned bottom right */
    #actionButtons {
      position: absolute;
      bottom: 10px;
      right: 10px;
    }
    #actionButtons button {
      margin-left: 0.5em;
      background: transparent;
      border: none;
      padding: 0;
      font-size: 1.5em;
      cursor: pointer;
    }
    @media (max-width: 600px) {
      header, main { padding: 0.5em; }
      #virtueTable th, #virtueTable td { height: 3em; font-size: 1em; }
      #virtueTable td.virtue-label { font-size: 1.2em; width: 2.5em; }
    }
  </style>
</head>
<body>
  <header id="headerArea">
    <h1>Ben Franklin's Virtue Tracker</h1>
    <p>Tap a virtue letter to see its details and start tracking!</p>
  </header>
  <main>
    <table id="virtueTable">
      <thead>
        <tr>
          <th></th>
          <th>S</th>
          <th>M</th>
          <th>T</th>
          <th>W</th>
          <th>T</th>
          <th>F</th>
          <th>S</th>
        </tr>
      </thead>
      <tbody id="gridBody">
        <!-- Grid rows are generated by JavaScript -->
      </tbody>
    </table>
    <div id="weekNav">
      <span id="prevWeek" class="arrow">‚ü∏</span>
      <span id="weekDisplay">Week 1</span>
      <span id="nextWeek" class="arrow">‚üπ</span>
    </div>
    <div id="actionButtons">
      <button id="saveBtn">üíæ</button>
      <button id="clearBtn">üóëÔ∏è</button>
    </div>
  </main>
  <script>
    /*
      Data Structure:
      - virtuesData: Array of 13 virtues with abbreviation, full name, and explanation.
      - gridData: For each virtue, an array of week arrays; each week array contains 7 booleans (for days Sun-Sat).
      - currentWeek: the 0-based index of the week currently displayed.
      - Instead of row highlighting, when a virtue letter is tapped, we highlight the cell corresponding to today's day.
    */
    const virtuesData = [
      { abbr: "T",  name: "Temperance",   explanation: "Eat not to dullness; drink not to elevation." },
      { abbr: "S",  name: "Silence",      explanation: "Speak not but what may benefit others or yourself; avoid trifling conversation." },
      { abbr: "O",  name: "Order",        explanation: "Let all your things have their places; let each part of your business have its time." },
      { abbr: "R",  name: "Resolution",   explanation: "Resolve to perform what you ought; perform without fail what you resolve." },
      { abbr: "F",  name: "Frugality",    explanation: "Make no expense but to do good to others or yourself; waste nothing." },
      { abbr: "I",  name: "Industry",     explanation: "Lose no time; be always employed in something useful; cut off all unnecessary actions." },
      { abbr: "S",  name: "Sincerity",    explanation: "Use no hurtful deceit; think innocently and justly." },
      { abbr: "J",  name: "Justice",      explanation: "Wrong none by doing injuries or omitting the benefits that are your duty." },
      { abbr: "M",  name: "Moderation",   explanation: "Avoid extremes; forbear resenting injuries." },
      { abbr: "C",  name: "Cleanliness",  explanation: "Tolerate no uncleanliness in body, clothes, or habitation." },
      { abbr: "T",  name: "Tranquility",  explanation: "Be not disturbed at trifles or accidents common or unavoidable." },
      { abbr: "Ch", name: "Chastity",     explanation: "Rarely use venery but for health or offspring; never to dullness, weakness, or injury." },
      { abbr: "H",  name: "Humility",     explanation: "Imitate Jesus and Socrates." }
    ];
    
    let currentWeek = 0; // 0-based week index
    let currentSelectedVirtue = null; // index of the selected virtue
    
    // Load gridData from localStorage if it exists; otherwise, initialize one week (week 0) per virtue.
    let gridData = JSON.parse(localStorage.getItem("franklinGrid"));
    if (!gridData) {
      gridData = virtuesData.map(() => [Array(7).fill(false)]);
    }
    
    const gridBody = document.getElementById("gridBody");
    const headerArea = document.getElementById("headerArea");
    const weekDisplay = document.getElementById("weekDisplay");
    const prevWeekElem = document.getElementById("prevWeek");
    const nextWeekElem = document.getElementById("nextWeek");
    const saveBtn = document.getElementById("saveBtn");
    const clearBtn = document.getElementById("clearBtn");
    
    function renderGrid() {
      gridBody.innerHTML = "";
      virtuesData.forEach((virtue, rowIndex) => {
        const tr = document.createElement("tr");
        // Virtue letter cell (first column)
        const virtueCell = document.createElement("td");
        virtueCell.textContent = virtue.abbr;
        virtueCell.classList.add("virtue-label");
        virtueCell.addEventListener("click", () => {
          currentSelectedVirtue = rowIndex;
          // Remove any existing day highlight from all rows
          document.querySelectorAll('#virtueTable tbody tr td.day-highlight').forEach(cell => cell.classList.remove('day-highlight'));
          // Update header area with the virtue's full name and explanation
          headerArea.innerHTML = `<h1>${virtuesData[rowIndex].name}</h1>
                                  <p>${virtuesData[rowIndex].explanation}</p>`;
          // Highlight the cell corresponding to today's day in this row
          let today = new Date().getDay(); // Sunday=0, Monday=1, etc.
          // The first cell is virtue label, so add 1
          let cellIndex = today + 1;
          if (tr.children[cellIndex]) {
            tr.children[cellIndex].classList.add("day-highlight");
          }
        });
        tr.appendChild(virtueCell);
        // Day cells for the current week
        for (let day = 0; day < 7; day++) {
          const td = document.createElement("td");
          // Ensure the week array exists for this virtue
          if (!gridData[rowIndex][currentWeek]) {
            gridData[rowIndex][currentWeek] = Array(7).fill(false);
          }
          if (gridData[rowIndex][currentWeek][day]) {
            td.classList.add("checked");
          }
          td.addEventListener("click", (e) => {
            // Prevent triggering virtue letter click when tapping a day cell
            e.stopPropagation();
            td.classList.toggle("checked");
            gridData[rowIndex][currentWeek][day] = td.classList.contains("checked");
          });
          tr.appendChild(td);
        }
        gridBody.appendChild(tr);
      });
      weekDisplay.textContent = `Week ${currentWeek + 1}`;
      
      // Reapply day highlight if a virtue is selected
      if (currentSelectedVirtue !== null) {
        const rows = document.querySelectorAll('#virtueTable tbody tr');
        if (rows[currentSelectedVirtue]) {
          // Remove previous highlights in that row first
          rows[currentSelectedVirtue].querySelectorAll('td.day-highlight').forEach(cell => cell.classList.remove('day-highlight'));
          let today = new Date().getDay();
          let cellIndex = today + 1;
          if (rows[currentSelectedVirtue].children[cellIndex]) {
            rows[currentSelectedVirtue].children[cellIndex].classList.add("day-highlight");
          }
        }
      }
    }
    
    function nextWeek() {
      currentWeek++;
      // Create a new week array for each virtue if it doesn't exist
      virtuesData.forEach((_, rowIndex) => {
        if (!gridData[rowIndex][currentWeek]) {
          gridData[rowIndex][currentWeek] = Array(7).fill(false);
        }
      });
      renderGrid();
    }
    
    function prevWeek() {
      if (currentWeek > 0) {
        currentWeek--;
        renderGrid();
      }
    }
    
    function saveData() {
      localStorage.setItem("franklinGrid", JSON.stringify(gridData));
      alert("Progress saved!");
    }
    
    function clearAll() {
      if (confirm("Clear all progress?")) {
        localStorage.removeItem("franklinGrid");
        gridData = virtuesData.map(() => [Array(7).fill(false)]);
        currentWeek = 0;
        currentSelectedVirtue = null;
        headerArea.innerHTML = `<h1>Ben Franklin's Virtue Tracker</h1>
                                <p>Tap a virtue letter to see its details and start tracking!</p>`;
        renderGrid();
        alert("All data cleared!");
      }
    }
    
    prevWeekElem.addEventListener("click", prevWeek);
    nextWeekElem.addEventListener("click", nextWeek);
    saveBtn.addEventListener("click", saveData);
    clearBtn.addEventListener("click", clearAll);
    
    // Initial render of grid
    renderGrid();
  </script>
</body>
</html>
