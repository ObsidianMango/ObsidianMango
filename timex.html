<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Stopwatch+ (Add Time + Laps)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <style>
    :root{
      --bg:#0b0d10; --fg:#e7e9ee; --muted:#9aa3af;
      --btn:#111827; --btn-border:#263042;
      --ring:rgba(96,165,250,.35);
      --green:#10b981; --green-d:#059669;
      --amber:#f59e0b; --amber-d:#d97706;
      --red:#ef4444; --red-d:#dc2626;
      --blue:#2563eb; --blue-d:#1d4ed8;
      --panel:#0e141c;
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{
      margin:0; background:var(--bg); color:var(--fg);
      font:500 16px/1.4 ui-sans-serif, system-ui, -apple-system, "SF Pro Text","Segoe UI",Roboto,Arial;
      height:100%;
    }
    .app{
      min-height:100svh;
      padding:env(safe-area-inset-top) env(safe-area-inset-right) calc(env(safe-area-inset-bottom)+14px) env(safe-area-inset-left);
      display:flex; flex-direction:column; align-items:center; gap:14px; margin:0 auto; max-width:1290px;
    }
    header{width:100%; padding:8px 18px 0; display:flex; align-items:center; justify-content:space-between; opacity:.9}
    .title{font-weight:800; letter-spacing:.2px}
    .badge{color:var(--muted); font-size:13px}

    .time{
      width:100%; flex:0; display:flex; align-items:center; justify-content:center; text-align:center; padding:4px 16px 0;
    }
    .time h1{
      margin:0; font-weight:800; font-variant-numeric:tabular-nums lining-nums;
      letter-spacing:.5px; font-size:clamp(52px, 11vw, 120px);
    }
    .time small{display:block; color:var(--muted); margin-top:.25em; font-weight:600}

    .controls, .presets, .custom, .laps-wrap{
      width:100%; padding:0 16px; max-width:820px; margin:0 auto;
    }
    .row{
      display:grid; gap:10px; margin-bottom:10px;
    }
    .row-3{grid-template-columns:1fr 1fr 1fr;}
    .row-2{grid-template-columns:1fr 1fr;}

    button, .chip{
      appearance:none; border:1px solid var(--btn-border); background:var(--btn); color:var(--fg);
      border-radius:16px; padding:15px; font-weight:800; font-size:17px; line-height:1; width:100%;
      transition:transform .06s ease, box-shadow .12s ease, filter .12s ease;
    }
    button:active, .chip:active{transform:scale(.985)}
    .go{background:linear-gradient(180deg,var(--green),var(--green-d)); border-color:var(--green)}
    .pause{background:linear-gradient(180deg,var(--amber),var(--amber-d)); border-color:var(--amber)}
    .reset{background:linear-gradient(180deg,var(--red),var(--red-d)); border-color:var(--red)}
    .lap{background:linear-gradient(180deg,var(--blue),var(--blue-d)); border-color:var(--blue)}

    .chips{display:flex; flex-wrap:wrap; gap:10px}
    .chip{width:auto; padding:10px 12px; font-weight:700; font-size:15px; border-radius:12px; background:#121a24}
    .chip:focus{outline:2px solid var(--ring); outline-offset:2px}

    .custom .grid{display:grid; grid-template-columns:repeat(4,1fr); gap:10px}
    .field{background:var(--panel); border:1px solid var(--btn-border); border-radius:14px; padding:10px 12px; display:flex; flex-direction:column; gap:6px}
    .label{font-size:12px; color:var(--muted); letter-spacing:.2px}
    input[type="number"]{
      width:100%; background:transparent; border:0; outline:0; color:var(--fg);
      font-size:20px; font-weight:800; -webkit-appearance:none; appearance:none;
    }
    input::-webkit-outer-spin-button, input::-webkit-inner-spin-button{-webkit-appearance:none; margin:0}
    .custom .grid button{grid-column:span 4; box-shadow:0 0 0 2px var(--ring)}

    .laps-wrap{display:flex; flex-direction:column; gap:8px}
    .laps-head{display:flex; justify-content:space-between; align-items:center; color:var(--muted); font-size:13px}
    .laps{
      background:var(--panel); border:1px solid var(--btn-border); border-radius:14px;
      overflow:auto; max-height:36vh;
    }
    .lap-row{
      display:grid; grid-template-columns:88px 1fr 1fr; gap:10px;
      padding:10px 12px; border-bottom:1px solid #1b2533; align-items:center; font-variant-numeric:tabular-nums;
    }
    .lap-row:last-child{border-bottom:0}
    .lap-num{color:var(--muted); font-weight:700}
    .lap-split, .lap-total{justify-self:end; font-weight:800}
    .empty{padding:16px; text-align:center; color:var(--muted)}

    @media (min-height: 800px){
      button,.chip{padding:17px}
      .time h1{font-size:clamp(58px, 10.5vw, 124px)}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">Stopwatch+</div>
      <div class="badge">iPhone 16 Pro Max</div>
    </header>

    <section class="time" aria-live="polite" aria-atomic="true">
      <div>
        <h1 id="display">00:00:00.00</h1>
        <small id="since">Ready</small>
      </div>
    </section>

    <section class="controls">
      <div class="row row-3">
        <button id="startPause" class="go">Start</button>
        <button id="lapBtn" class="lap">Lap</button>
        <button id="reset" class="reset">Reset</button>
      </div>
    </section>

    <section class="presets">
      <div class="chips">
        <button class="chip" data-add="1h">+1 hr</button>
        <button class="chip" data-add="10m">+10 min</button>
        <button class="chip" data-add="5m">+5 min</button>
        <button class="chip" data-add="1m">+1 min</button>
        <button class="chip" data-add="30s">+30 sec</button>
        <button class="chip" data-add="10s">+10 sec</button>
        <button class="chip" data-add="5s">+5 sec</button>
        <button class="chip" data-add="1s">+1 sec</button>
      </div>
    </section>

    <section class="custom">
      <div class="grid">
        <div class="field">
          <div class="label">Hours</div>
          <input id="hours" type="number" inputmode="numeric" min="0" placeholder="0">
        </div>
        <div class="field">
          <div class="label">Minutes</div>
          <input id="minutes" type="number" inputmode="numeric" min="0" placeholder="0">
        </div>
        <div class="field">
          <div class="label">Seconds</div>
          <input id="seconds" type="number" inputmode="numeric" min="0" placeholder="0">
        </div>
        <div class="field">
          <div class="label">Milliseconds</div>
          <input id="millis" type="number" inputmode="numeric" min="0" placeholder="0">
        </div>
        <button id="addCustom">Add Custom Time</button>
      </div>
    </section>

    <section class="laps-wrap">
      <div class="laps-head"><span>Laps</span><span id="lapMeta" class="badge">0 laps</span></div>
      <div id="laps" class="laps">
        <div class="empty">No laps yet</div>
      </div>
    </section>
  </div>

  <script>
    const $ = (s)=>document.querySelector(s);
    const $$ = (s)=>[...document.querySelectorAll(s)];

    const display = $('#display');
    const since = $('#since');
    const startPauseBtn = $('#startPause');
    const resetBtn = $('#reset');
    const lapBtn = $('#lapBtn');
    const chips = $$('.chip');
    const addCustomBtn = $('#addCustom');

    const hoursEl = $('#hours');
    const minutesEl = $('#minutes');
    const secondsEl = $('#seconds');
    const millisEl = $('#millis');

    const lapsEl = $('#laps');
    const lapMeta = $('#lapMeta');

    let running = false;
    let baseElapsed = 0;     // accumulated ms including adds
    let startedAt = 0;       // perf.now() when started
    let rafId = null;

    let lapCount = 0;
    let lastLapMark = 0;     // total elapsed at last lap (for split)

    const pad2 = (n)=>String(n).padStart(2,'0');
    const fmt = (ms)=>{
      const total = Math.max(0, Math.floor(ms));
      const h = Math.floor(total / 3600000);
      const m = Math.floor((total % 3600000) / 60000);
      const s = Math.floor((total % 60000) / 1000);
      const c = Math.floor((total % 1000) / 10);
      return `${pad2(h)}:${pad2(m)}:${pad2(s)}.${pad2(c)}`;
    };

    const render = (ms)=>{
      display.textContent = fmt(ms);
      since.textContent = running ? 'Running' : 'Paused';
    };

    const loop = ()=>{
      const now = performance.now();
      const elapsed = (running ? (now - startedAt) : 0) + baseElapsed;
      render(elapsed);
      rafId = requestAnimationFrame(loop);
    };

    const start = ()=>{
      if (running) return;
      running = true;
      startedAt = performance.now();
      startPauseBtn.textContent = 'Pause';
      startPauseBtn.className = 'pause';
    };

    const pause = ()=>{
      if (!running) return;
      running = false;
      baseElapsed += performance.now() - startedAt;
      startPauseBtn.textContent = 'Start';
      startPauseBtn.className = 'go';
    };

    const reset = ()=>{
      running = false;
      baseElapsed = 0;
      startedAt = 0;
      lapCount = 0;
      lastLapMark = 0;
      startPauseBtn.textContent = 'Start';
      startPauseBtn.className = 'go';
      lapsEl.innerHTML = '<div class="empty">No laps yet</div>';
      lapMeta.textContent = '0 laps';
      render(0);
    };

    const addMilliseconds = (ms)=>{
      if (!ms) return;
      if (running){
        baseElapsed += performance.now() - startedAt;
        startedAt = performance.now();
      }
      baseElapsed += ms;
    };

    const parseAddSpec = (spec)=>{
      const n = parseInt(spec,10);
      if (Number.isNaN(n)) return 0;
      if (spec.endsWith('h')) return n * 3600000;
      if (spec.endsWith('m')) return n * 60000;
      if (spec.endsWith('s')) return n * 1000;
      return 0;
    };

    const doLap = ()=>{
      // compute totals first
      const total = (running ? (performance.now() - startedAt) : 0) + baseElapsed;
      const split = total - lastLapMark;
      lastLapMark = total;

      lapCount++;
      lapMeta.textContent = `${lapCount} ${lapCount===1?'lap':'laps'}`;
      if (lapsEl.firstElementChild && lapsEl.firstElementChild.classList.contains('empty')) {
        lapsEl.removeChild(lapsEl.firstElementChild);
      }
      const row = document.createElement('div');
      row.className = 'lap-row';
      row.innerHTML = `
        <div class="lap-num">Lap ${lapCount}</div>
        <div class="lap-split">${fmt(split)}</div>
        <div class="lap-total">${fmt(total)}</div>
      `;
      lapsEl.prepend(row);
    };

    // Wire up UI
    startPauseBtn.addEventListener('click', ()=> running ? pause() : start());
    resetBtn.addEventListener('click', reset);
    lapBtn.addEventListener('click', ()=>{
      // If first lap before starting, treat current time as baseline (allows marking preloaded time)
      doLap();
    });

    chips.forEach(chip=>{
      chip.addEventListener('click', ()=>{
        const ms = parseAddSpec(chip.dataset.add || '');
        addMilliseconds(ms);
      });
    });

    addCustomBtn.addEventListener('click', ()=>{
      const h = +hoursEl.value || 0;
      const m = +minutesEl.value || 0;
      const s = +secondsEl.value || 0;
      const ms = +millisEl.value || 0;
      const addMs = h*3600000 + m*60000 + s*1000 + ms;
      addMilliseconds(addMs);
      hoursEl.value = minutesEl.value = secondsEl.value = millisEl.value = '';
    });

    // init
    render(0);
    loop();

    // iOS niceties
    if (window.visualViewport){
      const app = document.querySelector('.app');
      const onVV = ()=> app.style.minHeight = window.visualViewport.height + 'px';
      window.visualViewport.addEventListener('resize', onVV);
      onVV();
    }
  </script>
</body>
</html>