<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, user-scalable=no"
/>
<title>Mothman Life / Turn / Rad Tracker</title>
<style>
  :root {
    --bg: #050608;
    --panel: #11131a;
    --panel-soft: #181b24;
    --border-soft: #262a36;
    --text-main: #f7f7f7;
    --muted: #a0a8c0;
    --accent: #5ee0ff;
    --heal: #6dff9f;
    --dmg: #ff5a5a;
    --life: #a6ff78; /* fluorescent greenish */
  }

  * {
    box-sizing: border-box;
  }

  html,
  body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: radial-gradient(circle at top, #131626 0, #050608 55%);
    color: var(--text-main);
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    display: flex;
    align-items: stretch;
    justify-content: center;
  }

  .app {
    position: relative;
    width: 100%;
    max-width: 520px;
    height: 100vh;
    display: flex;
    flex-direction: column;
    padding: 12px 12px 24px;
  }

  /* TOP BAR – TURN TRACKER */

  #topBar {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    margin-bottom: 10px;
  }

  #turnTracker {
    position: relative;
    width: 88px;
    height: 88px;
    border-radius: 50%;
    background: radial-gradient(circle at center, #181b27 0, #090b11 60%);
    border: 1px solid var(--border-soft);
    box-shadow:
      0 0 0 1px rgba(0, 0, 0, 0.6),
      0 10px 22px rgba(0, 0, 0, 0.85);
  }

  .turn-orb {
    position: absolute;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    opacity: 0.25;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.9);
    transition:
      opacity 0.16s ease,
      transform 0.16s ease,
      box-shadow 0.16s ease;
  }

  .orb0 { /* white - top */
    top: 8%;
    left: 50%;
    background: #f8f5e6;
  }
  .orb1 { /* blue - upper right */
    top: 34%;
    left: 90%;
    background: #3aa3ff;
  }
  .orb2 { /* black - lower right */
    top: 78%;
    left: 70%;
    background: #1b1b24;
  }
  .orb3 { /* red - lower left */
    top: 78%;
    left: 30%;
    background: #ff5a40;
  }
  .orb4 { /* green - upper left */
    top: 34%;
    left: 10%;
    background: #2fd166;
  }
  .orb5 { /* center - 6th player */
    top: 50%;
    left: 50%;
    background: #b38cff;
  }

  .turn-orb.active {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1.18);
    box-shadow:
      0 0 8px rgba(255, 255, 255, 0.9),
      0 0 18px rgba(94, 224, 255, 0.7);
  }

  .turn-orb.disabled {
    opacity: 0.08;
    box-shadow: none;
  }

  #turnText {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: var(--muted);
    padding: 4px 10px;
    border-radius: 999px;
    background: rgba(8, 10, 18, 0.7);
    border: 1px solid rgba(38, 42, 54, 0.9);
  }

  #turnText:active {
    transform: scale(0.97);
    opacity: 0.9;
  }

  /* LIFE AREA */

  #lifeArea {
    flex: 1;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #lifeWrapper {
    position: relative;
    width: 100%;
    max-width: 360px;
    aspect-ratio: 4 / 3;
    border-radius: 24px;
    background: radial-gradient(circle at top, #141826 0, #090b10 60%);
    border: 1px solid var(--border-soft);
    box-shadow:
      0 0 0 1px rgba(94, 224, 255, 0.05),
      0 20px 35px rgba(0, 0, 0, 0.85);
    overflow: hidden;
  }

  #lifeHintRow {
    position: absolute;
    top: 8px;
    left: 0;
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 14px;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--muted);
    opacity: 0.8;
    pointer-events: none;
  }

  #life {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 112px;
    font-weight: 800;
    color: var(--life);
    text-shadow:
      0 0 14px rgba(166, 255, 120, 0.6),
      0 0 30px rgba(166, 255, 120, 0.4);
    transition:
      transform 0.17s ease,
      color 0.17s ease,
      text-shadow 0.17s ease;
    pointer-events: none;
  }

  .life-label {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: var(--muted);
    opacity: 0.65;
    pointer-events: none;
  }

  #lifeLabelLeft {
    left: 10px;
  }

  #lifeLabelRight {
    right: 10px;
    text-align: right;
  }

  .life-zone {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 50%;
  }

  #lifeLeftZone {
    left: 0;
  }

  #lifeRightZone {
    right: 0;
  }

  /* RAD CONTROL */

  #radControl {
    position: absolute;
    bottom: 14px;
    left: 50%;
    transform: translateX(-50%);
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 4px 11px;
    border-radius: 999px;
    border: 1px solid #3bffb0;
    background: rgba(10, 20, 16, 0.9);
    box-shadow:
      0 0 10px rgba(166, 255, 120, 0.35),
      0 0 18px rgba(40, 120, 80, 0.45);
    font-size: 11px;
    color: var(--muted);
  }

  #radLabel {
    text-transform: uppercase;
    letter-spacing: 0.18em;
    font-size: 9px;
  }

  #radDisplay {
    min-width: 22px;
    text-align: center;
    color: var(--life);
    font-weight: 600;
  }

  /* LIFE FEEDBACK ANIMATIONS */

  .life-heal {
    color: var(--heal) !important;
    transform: translate(-50%, -50%) scale(1.08) !important;
    text-shadow:
      0 0 14px rgba(109, 255, 159, 0.8),
      0 0 32px rgba(109, 255, 159, 0.7) !important;
  }

  .life-dmg {
    color: var(--dmg) !important;
    transform: translate(-50%, -50%) scale(0.93) !important;
    text-shadow:
      0 0 14px rgba(255, 90, 90, 0.9),
      0 0 30px rgba(255, 90, 90, 0.7) !important;
  }

  #flash {
    position: fixed;
    inset: 0;
    pointer-events: none;
    background: transparent;
    opacity: 0;
    transition: opacity 0.18s ease;
    mix-blend-mode: screen;
  }

  #flash.flash-heal {
    background: radial-gradient(circle at center, rgba(109, 255, 159, 0.25), transparent 60%);
    opacity: 1;
  }

  #flash.flash-dmg {
    background: radial-gradient(circle at center, rgba(255, 90, 90, 0.3), transparent 65%);
    opacity: 1;
  }

  /* EFFECTS PANEL */

  #effectsPanel {
    margin-top: 8px;
    padding: 10px 10px 8px;
    border-radius: 16px;
    background: linear-gradient(180deg, #10131f, #080910);
    border: 1px solid var(--border-soft);
    box-shadow: 0 10px 26px rgba(0, 0, 0, 0.75);
  }

  .effects-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
  }

  .effects-title {
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--muted);
  }

  #addEffectBtn {
    padding: 4px 10px;
    border-radius: 999px;
    border: 1px solid var(--accent);
    background: radial-gradient(circle at top, #22273b 0, #12141e 70%);
    color: var(--text-main);
    font-size: 11px;
    font-weight: 600;
  }

  #addEffectBtn:active {
    transform: scale(0.96);
    opacity: 0.9;
  }

  #effectsList {
    max-height: 130px;
    overflow-y: auto;
    padding-right: 4px;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .effect-chip {
    display: inline-flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 2px;
    padding: 6px 9px;
    border-radius: 12px;
    font-size: 11px;
    background: #171a26;
    border: 1px solid #262a36;
    color: var(--muted);
    min-width: 0;
    max-width: 100%;
  }

  .effect-chip-main {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    width: 100%;
  }

  .effect-dot {
    width: 8px;
    height: 8px;
    border-radius: 999px;
    background: var(--accent);
    box-shadow: 0 0 6px rgba(94, 224, 255, 0.7);
    flex-shrink: 0;
  }

  .effect-name {
    color: var(--text-main);
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
  }

  .effect-tag-inline {
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--muted);
    opacity: 0.85;
    white-space: nowrap;
  }

  .effect-remove {
    border: none;
    background: transparent;
    color: #707793;
    font-size: 12px;
    padding: 0;
    flex-shrink: 0;
  }

  .effect-remove:active {
    transform: scale(0.9);
    opacity: 0.7;
  }

  .effect-note {
    font-size: 10px;
    line-height: 1.25;
    color: var(--muted);
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  #footerSpacer {
    flex-shrink: 0;
    height: 18px; /* thumb room at the bottom on iPhone */
  }

  /* EFFECT PICKER (BOTTOM SHEET) */

  #effectPicker {
    position: fixed;
    inset: 0;
    background: rgba(1, 2, 5, 0.55);
    display: none;
    align-items: flex-end;
    justify-content: center;
    z-index: 20;
  }

  #effectPicker.open {
    display: flex;
  }

  .picker-inner {
    width: 100%;
    max-width: 520px;
    max-height: 60vh;
    border-radius: 16px 16px 0 0;
    background: #090b11;
    border-top: 1px solid var(--border-soft);
    box-shadow: 0 -18px 30px rgba(0, 0, 0, 0.8);
    padding: 8px 12px 12px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .picker-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-bottom: 4px;
  }

  .picker-title {
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--muted);
  }

  #closePickerBtn {
    border-radius: 999px;
    border: 1px solid var(--border-soft);
    background: #141722;
    color: var(--muted);
    font-size: 12px;
    padding: 2px 8px;
  }

  #effectOptions {
    flex: 1;
    overflow-y: auto;
    margin-top: 4px;
    padding-right: 4px;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .picker-section-title {
    margin-top: 6px;
    margin-bottom: 2px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--muted);
    opacity: 0.95;
  }

  .effect-option {
    padding: 8px 9px;
    border-radius: 10px;
    background: #11141f;
    border: 1px solid #242737;
  }

  .effect-option-main {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    margin-bottom: 3px;
  }

  .effect-option-name {
    font-size: 13px;
    font-weight: 600;
  }

  .effect-tag {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--muted);
  }

  .effect-option-note {
    font-size: 11px;
    color: var(--muted);
  }

  .effect-option:active {
    transform: scale(0.98);
    border-color: var(--accent);
  }

  /* PLAYER CONFIG POPUP */

  #playerConfig {
    position: fixed;
    inset: 0;
    background: rgba(1, 2, 5, 0.6);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 25;
  }

  #playerConfig.open {
    display: flex;
  }

  .config-inner {
    width: 100%;
    max-width: 420px;
    border-radius: 16px;
    background: #090b11;
    border: 1px solid var(--border-soft);
    box-shadow: 0 18px 35px rgba(0, 0, 0, 0.9);
    padding: 10px 14px 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .config-header {
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
  }

  .player-count-row {
    display: flex;
    gap: 6px;
    margin: 4px 0;
  }

  .count-btn {
    flex: 1;
    padding: 6px 0;
    border-radius: 999px;
    border: 1px solid var(--border-soft);
    background: #121421;
    color: var(--muted);
    font-size: 12px;
  }

  .count-btn.active {
    border-color: var(--accent);
    color: var(--text-main);
    background: radial-gradient(circle at top, #22273b 0, #121421 80%);
  }

  #nameFields {
    margin-top: 4px;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .name-row {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .name-row label {
    min-width: 64px;
    font-size: 11px;
    color: var(--muted);
  }

  .name-row input {
    flex: 1;
    padding: 4px 6px;
    border-radius: 8px;
    border: 1px solid var(--border-soft);
    background: #11141f;
    color: var(--text-main);
    font-size: 12px;
  }

  .config-footer {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
    margin-top: 6px;
  }

  .config-btn {
    padding: 5px 12px;
    border-radius: 999px;
    font-size: 12px;
    border: 1px solid var(--border-soft);
    background: #141722;
    color: var(--muted);
  }

  #configSave {
    border-color: var(--accent);
    color: var(--text-main);
    background: radial-gradient(circle at top, #22273b 0, #11131f 80%);
  }

  .config-btn:active {
    transform: scale(0.97);
    opacity: 0.9;
  }

  /* SCROLLBARS (SUBTLE) */
  #effectsList::-webkit-scrollbar,
  #effectOptions::-webkit-scrollbar {
    width: 4px;
  }

  #effectsList::-webkit-scrollbar-thumb,
  #effectOptions::-webkit-scrollbar-thumb {
    background: #2b3040;
    border-radius: 999px;
  }
</style>
</head>
<body>
<div class="app">
  <header id="topBar">
    <div id="turnTracker">
      <div class="turn-orb orb0" data-index="0"></div>
      <div class="turn-orb orb1" data-index="1"></div>
      <div class="turn-orb orb2" data-index="2"></div>
      <div class="turn-orb orb3" data-index="3"></div>
      <div class="turn-orb orb4" data-index="4"></div>
      <div class="turn-orb orb5" data-index="5"></div>
    </div>
    <div id="turnText">Player 1</div>
  </header>

  <main id="lifeArea">
    <div id="lifeWrapper">
      <div id="lifeHintRow">
        <span>Tap left = -1</span>
        <span>Tap right = +1</span>
      </div>
      <div id="lifeLabelLeft" class="life-label">Damage</div>
      <div id="lifeLabelRight" class="life-label">Heal</div>

      <div id="life">40</div>

      <div id="lifeLeftZone" class="life-zone"></div>
      <div id="lifeRightZone" class="life-zone"></div>

      <div id="radControl">
        <span id="radLabel">RAD</span>
        <div id="radDisplay">0</div>
      </div>
    </div>
  </main>

  <section id="effectsPanel">
    <div class="effects-header">
      <div class="effects-title">Mothman Effects / Reminders</div>
      <button id="addEffectBtn">+ Add</button>
    </div>
    <div id="effectsList"></div>
  </section>

  <div id="footerSpacer"></div>
</div>

<div id="effectPicker">
  <div class="picker-inner">
    <div class="picker-header">
      <div class="picker-title">Select Mutant Menace Card</div>
      <button id="closePickerBtn">Close</button>
    </div>
    <div id="effectOptions"></div>
  </div>
</div>

<div id="playerConfig">
  <div class="config-inner">
    <div class="config-header">Players & Names</div>
    <div class="player-count-row">
      <button class="count-btn" data-count="1">1</button>
      <button class="count-btn" data-count="2">2</button>
      <button class="count-btn" data-count="3">3</button>
      <button class="count-btn" data-count="4">4</button>
      <button class="count-btn" data-count="5">5</button>
      <button class="count-btn" data-count="6">6</button>
    </div>
    <div id="nameFields">
      <div class="name-row" data-index="0">
        <label>Player 1</label>
        <input id="nameInput0" type="text" placeholder="Player 1" />
      </div>
      <div class="name-row" data-index="1">
        <label>Player 2</label>
        <input id="nameInput1" type="text" placeholder="Player 2" />
      </div>
      <div class="name-row" data-index="2">
        <label>Player 3</label>
        <input id="nameInput2" type="text" placeholder="Player 3" />
      </div>
      <div class="name-row" data-index="3">
        <label>Player 4</label>
        <input id="nameInput3" type="text" placeholder="Player 4" />
      </div>
      <div class="name-row" data-index="4">
        <label>Player 5</label>
        <input id="nameInput4" type="text" placeholder="Player 5" />
      </div>
      <div class="name-row" data-index="5">
        <label>Player 6</label>
        <input id="nameInput5" type="text" placeholder="Player 6" />
      </div>
    </div>
    <div class="config-footer">
      <button id="configCancel" class="config-btn">Cancel</button>
      <button id="configSave" class="config-btn">Save</button>
    </div>
  </div>
</div>

<div id="flash"></div>

<script>
  const DEFAULT_LIFE = 40;

  // Mutant Menace / Mothman deck key cards, with more specific effect reminders.
  // These are short summaries, not full rules text.
  const EFFECT_SECTIONS = [
    {
      title: "Commanders & Rad Engines",
      items: [
        {
          id: "wise_mothman",
          name: "The Wise Mothman",
          tag: "commander · rad engine",
          note:
            "ETB/attack: each player gets 1 rad. When rads resolve, you spread that many +1/+1 counters on your creatures."
        },
        {
          id: "master_transcendent",
          name: "The Master, Transcendent",
          tag: "legendary · reanimate",
          note:
            "Reanimates a creature that went to a graveyard this turn as a 3/3 Mutant under your control."
        },
        {
          id: "jason_bright",
          name: "Jason Bright, Glowing Prophet",
          tag: "legendary · rad drain",
          note:
            "Gives rads, then drains or gains life based on rad counts. Watch total rads on each player."
        },
        {
          id: "hancock",
          name: "Hancock, Ghoulish Mayor",
          tag: "legendary · ghoul engine",
          note:
            "Rewards you for Ghouls / death / radiation with life loss and card advantage."
        },
        {
          id: "glowing_one",
          name: "Glowing One",
          tag: "creature · rad drain",
          note:
            "Gives rad counters, then drains life from each player based on their rad total."
        },
        {
          id: "vexing_radgull",
          name: "Vexing Radgull",
          tag: "creature · combat rad",
          note:
            "On combat damage to a player, that player gets rad counters. Airborne rad pressure."
        },
        {
          id: "radstorm",
          name: "Radstorm",
          tag: "sorcery · mass rad",
          note:
            "Each player gets rad counters; you gain value. Big symmetric radiation hit for the whole table."
        },
        {
          id: "nuclear_fallout",
          name: "Nuclear Fallout",
          tag: "sorcery · wipe",
          note:
            "Board wipe that also hands out rads / damage. Track life loss and post-wipe radiation."
        },
        {
          id: "struggle_purity",
          name: "Struggle for Project Purity",
          tag: "sorcery · huge swing",
          note:
            "Mass life and radiation change. Expect multiple rads per player and big life swings."
        },
        {
          id: "contaminated_drink",
          name: "Contaminated Drink",
          tag: "spell · single target rad",
          note:
            "Gives one player rads and life loss. Good for finishing or setting up lethal rad resolution."
        }
      ]
    },
    {
      title: "Fallout Legends & Mutants",
      items: [
        {
          id: "mirelurk_queen",
          name: "Mirelurk Queen",
          tag: "legendary creature",
          note:
            "Big body that makes tokens on cast/attack. Tracks how many extra bodies you’re making."
        },
        {
          id: "piper_wright",
          name: "Piper Wright, Publick Reporter",
          tag: "legendary creature",
          note:
            "Attack trigger for cards/selection. Attacking multiple players scales value."
        },
        {
          id: "screeching_scorchbeast",
          name: "Screeching Scorchbeast",
          tag: "creature · flier",
          note:
            "Flying finisher; on attack usually drains/damages multiple things. Count potential lethal."
        },
        {
          id: "harold_bob",
          name: "Harold and Bob, First Numens",
          tag: "legendary creature",
          note:
            "Land/counter synergy; grows your board and mana over time via counters."
        },
        {
          id: "lily_bowen",
          name: "Lily Bowen, Raging Grandma",
          tag: "legendary creature",
          note:
            "Combat monster; gives surprise power or combat bonuses. Plan around burst damage."
        },
        {
          id: "power_fist",
          name: "Power Fist",
          tag: "equipment",
          note:
            "Massive attack buff to one creature. Track which creature is wearing it and total swing."
        },
        {
          id: "rampaging_yao_guai",
          name: "Rampaging Yao Guai",
          tag: "creature · trampler",
          note:
            "Large trampler; punishes small boards. Good for trample-over lethal math."
        },
        {
          id: "strong_brutish_thespian",
          name: "Strong, the Brutish Thespian",
          tag: "legendary creature",
          note:
            "Big attacker that rewards big board / Mutants. Attack triggers remove blockers or push damage."
        },
        {
          id: "tato_farmer",
          name: "Tato Farmer",
          tag: "creature · value engine",
          note:
            "Produces Food/tokens over time. Marks slow life gain and sacrifice fodder."
        },
        {
          id: "watchful_radstag",
          name: "Watchful Radstag",
          tag: "creature · utility",
          note:
            "Utility passive (fixing / information). Remember it whenever you tap lands or attack."
        },
        {
          id: "agent_frank_horrigan",
          name: "Agent Frank Horrigan",
          tag: "legendary creature · finisher",
          note:
            "Huge finisher with removal stapled on. Plan to clear one key permanent plus swing big."
        },
        {
          id: "alpha_deathclaw",
          name: "Alpha Deathclaw",
          tag: "creature · finisher",
          note:
            "Fast lethal attacker with evasion/extra combat text. Count how many hits kill from current life."
        },
        {
          id: "marcus_mutant_mayor",
          name: "Marcus, Mutant Mayor",
          tag: "legendary creature · tribal",
          note:
            "Buffs Mutants / counters. Track your team’s size as you add more Mutants."
        },
        {
          id: "raul_trouble_shooter",
          name: "Raul, Trouble Shooter",
          tag: "legendary creature · artifacts",
          note:
            "Artifact/equipment support; cost reduction/recursion. Watch extra value from casting/equipping artifacts."
        },
        {
          id: "young_deathclaws",
          name: "Young Deathclaws",
          tag: "creature · pack",
          note:
            "Better in packs; swinging multiple pushes a lot more damage."
        },
        {
          id: "lumbering_megasloth",
          name: "Lumbering Megasloth",
          tag: "creature",
          note:
            "Big stabilizer/finisher that can pick up counters. Keep track of its size over time."
        },
        {
          id: "nightkin_ambusher",
          name: "Nightkin Ambusher",
          tag: "creature · flash",
          note:
            "Flash ambusher that punishes attackers. Hold up mana to blow people out in combat."
        },
        {
          id: "bloatfly_swarm",
          name: "Bloatfly Swarm",
          tag: "creature · death trigger",
          note:
            "Dies into additional bodies/damage. Great sacrifice target; track death triggers."
        },
        {
          id: "infesting_radroach",
          name: "Infesting Radroach",
          tag: "creature · pest",
          note:
            "Cheap annoyance that comes back or spreads value via death. Good early blocker/sac fodder."
        },
        {
          id: "cathedral_acolyte",
          name: "Cathedral Acolyte",
          tag: "creature · life gain",
          note:
            "Grants life via ETB or specific condition. Track life gained to know how safe you are."
        },
        {
          id: "feral_ghoul",
          name: "Feral Ghoul",
          tag: "creature · ghoul",
          note:
            "Aggressive Ghoul; may grow or synergize with Ghoul payoffs and death triggers."
        }
      ]
    },
    {
      title: "Fallout Spells, Artifacts & Tech",
      items: [
        {
          id: "mutational_advantage",
          name: "Mutational Advantage",
          tag: "enchantment · counters",
          note:
            "Adds extra +1/+1 counters to creatures under set conditions. Track how many counters new creatures should get."
        },
        {
          id: "forced_evolution",
          name: "Forced Evolution",
          tag: "enchantment · aura",
          note:
            "Aura that steadily grows one creature. Keep mental note which creature is wearing it and its boosted stats."
        },
        {
          id: "atomize",
          name: "Atomize",
          tag: "instant · removal",
          note:
            "Instant-speed destroy/exile at fixed cost. Use as single-target answer to a key threat."
        },
        {
          id: "nuka_nuke_launcher",
          name: "Nuka-Nuke Launcher",
          tag: "artifact · equipment",
          note:
            "Equipment that lets you deal direct damage (often to any target). Count damage lines when planning a kill."
        },
        {
          id: "recon_craft_theta",
          name: "Recon Craft Theta",
          tag: "artifact · vehicle",
          note:
            "Vehicle that becomes a flying attacker and often draws or generates advantage on combat damage."
        },
        {
          id: "strength_bobblehead",
          name: "Strength Bobblehead",
          tag: "artifact · buff",
          note:
            "Boosts power (often commander/creatures). Track final power when planning lethal swings."
        }
      ]
    },
    {
      title: "Fallout Locations & Bases",
      items: [
        {
          id: "the_necropolis",
          name: "The Necropolis",
          tag: "legendary land",
          note:
            "Graveyard/Zombie land. Activated ability uses graveyards or Zombies—remember when you can cash those in."
        },
        {
          id: "mariposa_base",
          name: "Mariposa Military Base",
          tag: "land · base",
          note:
            "Mutant/counter support land. Often adds counters or tokens over time."
        },
        {
          id: "overflowing_basin",
          name: "Overflowing Basin",
          tag: "land",
          note:
            "Adds extra counters to permanents for a mana cost. Use spare mana end step to grow your board."
        },
        {
          id: "viridescent_bog",
          name: "Viridescent Bog",
          tag: "land",
          note:
            "Fixes mana and possibly interacts with counters or radiation. Remember you have fixing for splashes."
        }
      ]
    },
    {
      title: "Reprints: Engines & Counters",
      items: [
        {
          id: "fraying_sanity",
          name: "Fraying Sanity",
          tag: "enchantment · mill doubler",
          note:
            "End step: chosen player mills again equal to cards that hit their yard this turn (rad mill + normal mill)."
        },
        {
          id: "inexorable_tide",
          name: "Inexorable Tide",
          tag: "enchantment · proliferate",
          note:
            "Whenever you cast a spell, proliferate. Every spell grows all counters and rads on the table."
        },
        {
          id: "branching_evolution",
          name: "Branching Evolution",
          tag: "enchantment · double counters",
          note:
            "Your creatures get twice as many +1/+1 counters. Turns every small counter effect into a big buff."
        },
        {
          id: "guardian_project",
          name: "Guardian Project",
          tag: "enchantment · card draw",
          note:
            "Draw a card whenever a nontoken creature ETBs under your control with a new name. Don’t miss triggers."
        },
        {
          id: "hardened_scales",
          name: "Hardened Scales",
          tag: "enchantment · extra counters",
          note:
            "Whenever a creature would get counters, it gets one extra +1/+1. Stacks with your other doublers."
        },
        {
          id: "tireless_tracker",
          name: "Tireless Tracker",
          tag: "creature · landfall draw",
          note:
            "Landfall: make a Clue. Sac a Clue: put a +1/+1 counter on it. Tracks both tokens and counters."
        },
        {
          id: "biomass_mutation",
          name: "Biomass Mutation",
          tag: "instant · finisher",
          note:
            "XGU GU: all your creatures become X/X. Cast pre-combat to turn a wide board into lethal out of nowhere."
        },
        {
          id: "casualties_of_war",
          name: "Casualties of War",
          tag: "sorcery · multi kill",
          note:
            "Destroy up to one of each: artifact, creature, enchantment, land, planeswalker. Plan targets ahead."
        },
        {
          id: "find_finality",
          name: "Find // Finality",
          tag: "split spell",
          note:
            "Find: return up to 2 creatures from yard. Finality: board wipe that buffs one of your creatures first."
        },
        {
          id: "corpsejack_menace",
          name: "Corpsejack Menace",
          tag: "creature · double counters",
          note:
            "Doubles +1/+1 counters on your creatures. Combos hard with Branching Evolution."
        },
        {
          id: "winding_constrictor",
          name: "Winding Constrictor",
          tag: "creature · extra counters",
          note:
            "You/your permanents get an extra counter of each type. Buffs rads on players and +1/+1 on creatures."
        },
        {
          id: "contagion_clasp",
          name: "Contagion Clasp",
          tag: "artifact · proliferate",
          note:
            "ETB: put a -1/-1 counter on a creature. 4,T: proliferate (grow all counters, including rad)."
        },
        {
          id: "harmonize",
          name: "Harmonize",
          tag: "sorcery · draw 3",
          note:
            "Simple: draw 3 cards for 4 mana. Use mid-game to refuel."
        },
        {
          id: "inspiring_call",
          name: "Inspiring Call",
          tag: "instant · protect & draw",
          note:
            "Creatures with +1/+1 counters gain indestructible; draw for each of them. Cast vs wipes or in big combats."
        }
      ]
    }
  ];

  let numPlayers = 4;
  let currentPlayer = 0;
  let players = []; // { name, life, rad }
  let activeEffects = []; // { id, name, tag, note }

  const lifeEl = document.getElementById("life");
  const lifeLeftZone = document.getElementById("lifeLeftZone");
  const lifeRightZone = document.getElementById("lifeRightZone");
  const flashEl = document.getElementById("flash");

  const radDisplay = document.getElementById("radDisplay");
  const radControl = document.getElementById("radControl");

  const turnTracker = document.getElementById("turnTracker");
  const turnText = document.getElementById("turnText");
  const turnOrbs = Array.from(document.querySelectorAll(".turn-orb"));

  const effectsListEl = document.getElementById("effectsList");
  const addEffectBtn = document.getElementById("addEffectBtn");
  const effectPicker = document.getElementById("effectPicker");
  const effectOptionsEl = document.getElementById("effectOptions");
  const closePickerBtn = document.getElementById("closePickerBtn");

  const playerConfig = document.getElementById("playerConfig");
  const countButtons = Array.from(document.querySelectorAll(".count-btn"));
  const nameRows = Array.from(document.querySelectorAll(".name-row"));
  const nameInputs = [
    document.getElementById("nameInput0"),
    document.getElementById("nameInput1"),
    document.getElementById("nameInput2"),
    document.getElementById("nameInput3"),
    document.getElementById("nameInput4"),
    document.getElementById("nameInput5")
  ];
  const configCancel = document.getElementById("configCancel");
  const configSave = document.getElementById("configSave");

  let configSelectedCount = 4;

  function defaultName(index) {
    return `Player ${index + 1}`;
  }

  function initPlayers(count) {
    numPlayers = Math.min(Math.max(count, 1), 6);
    const newPlayers = [];

    for (let i = 0; i < numPlayers; i++) {
      const existing = players[i];
      newPlayers.push({
        name: existing ? existing.name : defaultName(i),
        life: existing ? existing.life : DEFAULT_LIFE,
        rad: existing ? existing.rad : 0
      });
    }

    players = newPlayers;
    if (currentPlayer >= numPlayers) currentPlayer = numPlayers - 1;

    updateTurnDisplay();
    updateTurnOrbs();
    updateLifeDisplay();
    updateRadDisplay();
  }

  function updateTurnDisplay() {
    const p = players[currentPlayer];
    const name = p && p.name ? p.name : defaultName(currentPlayer);
    turnText.textContent = name;
  }

  function updateTurnOrbs() {
    turnOrbs.forEach((orb, idx) => {
      orb.classList.remove("active", "disabled");
      if (idx >= numPlayers) {
        orb.classList.add("disabled");
      }
      if (idx === currentPlayer) {
        orb.classList.add("active");
      }
    });
  }

  function updateLifeDisplay(type) {
    const life = players[currentPlayer].life;
    lifeEl.textContent = life;

    lifeEl.classList.remove("life-heal", "life-dmg");
    void lifeEl.offsetWidth;

    flashEl.classList.remove("flash-heal", "flash-dmg");
    void flashEl.offsetWidth;

    if (type === "heal") {
      lifeEl.classList.add("life-heal");
      flashEl.classList.add("flash-heal");
    } else if (type === "dmg") {
      lifeEl.classList.add("life-dmg");
      flashEl.classList.add("flash-dmg");
    }

    if (type === "heal" || type === "dmg") {
      setTimeout(() => {
        flashEl.classList.remove("flash-heal", "flash-dmg");
      }, 200);
    }

    updateTurnDisplay();
  }

  function changeLife(delta) {
    const player = players[currentPlayer];
    player.life = Math.max(0, player.life + delta);
    const type = delta > 0 ? "heal" : delta < 0 ? "dmg" : null;
    updateLifeDisplay(type);
  }

  function updateRadDisplay() {
    const rad = players[currentPlayer].rad;
    radDisplay.textContent = rad;
  }

  function changeRad(delta) {
    const player = players[currentPlayer];
    player.rad = Math.max(0, player.rad + delta);
    updateRadDisplay();
  }

  function renderEffects() {
    effectsListEl.innerHTML = "";

    if (!activeEffects.length) {
      const empty = document.createElement("div");
      empty.textContent =
        "No active effects – tap + Add to track Mothman / Mutant Menace cards.";
      empty.style.fontSize = "11px";
      empty.style.color = "var(--muted)";
      effectsListEl.appendChild(empty);
      return;
    }

    activeEffects.forEach((eff, idx) => {
      const chip = document.createElement("div");
      chip.className = "effect-chip";

      const mainRow = document.createElement("div");
      mainRow.className = "effect-chip-main";

      const dot = document.createElement("div");
      dot.className = "effect-dot";

      const nameSpan = document.createElement("span");
      nameSpan.className = "effect-name";
      nameSpan.textContent = eff.name;

      const tagSpan = document.createElement("span");
      tagSpan.className = "effect-tag-inline";
      tagSpan.textContent = eff.tag || "";

      const removeBtn = document.createElement("button");
      removeBtn.className = "effect-remove";
      removeBtn.textContent = "✕";
      removeBtn.addEventListener("click", () => {
        activeEffects.splice(idx, 1);
        renderEffects();
      });

      mainRow.appendChild(dot);
      mainRow.appendChild(nameSpan);
      if (eff.tag) mainRow.appendChild(tagSpan);
      mainRow.appendChild(removeBtn);

      const noteDiv = document.createElement("div");
      noteDiv.className = "effect-note";
      noteDiv.textContent = eff.note || "";

      chip.appendChild(mainRow);
      chip.appendChild(noteDiv);

      effectsListEl.appendChild(chip);
    });
  }

  function openEffectPicker() {
    effectPicker.classList.add("open");
  }

  function closeEffectPicker() {
    effectPicker.classList.remove("open");
  }

  function buildEffectOptions() {
    effectOptionsEl.innerHTML = "";

    EFFECT_SECTIONS.forEach(section => {
      const header = document.createElement("div");
      header.className = "picker-section-title";
      header.textContent = section.title;
      effectOptionsEl.appendChild(header);

      section.items.forEach(tpl => {
        const opt = document.createElement("div");
        opt.className = "effect-option";

        const mainRow = document.createElement("div");
        mainRow.className = "effect-option-main";

        const nameSpan = document.createElement("span");
        nameSpan.className = "effect-option-name";
        nameSpan.textContent = tpl.name;

        const tagSpan = document.createElement("span");
        tagSpan.className = "effect-tag";
        tagSpan.textContent = tpl.tag;

        mainRow.appendChild(nameSpan);
        mainRow.appendChild(tagSpan);

        const note = document.createElement("div");
        note.className = "effect-option-note";
        note.textContent = tpl.note;

        opt.appendChild(mainRow);
        opt.appendChild(note);

        opt.addEventListener("click", () => {
          activeEffects.push({
            id: tpl.id,
            name: tpl.name,
            tag: tpl.tag,
            note: tpl.note
          });
          renderEffects();
          closeEffectPicker();
        });

        effectOptionsEl.appendChild(opt);
      });
    });
  }

  function attachLifeZoneHandlers() {
    const onLeft = () => changeLife(-1);
    const onRight = () => changeLife(1);

    ["pointerdown"].forEach(evt => {
      lifeLeftZone.addEventListener(evt, onLeft);
      lifeRightZone.addEventListener(evt, onRight);
    });
  }

  function attachRadHandlers() {
    radControl.addEventListener("pointerdown", e => {
      const rect = radControl.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const half = rect.width / 2;
      if (x < half) {
        changeRad(-1);
      } else {
        changeRad(1);
      }
    });
  }

  // Turn tracker: tap to advance turn
  turnTracker.addEventListener("pointerdown", () => {
    currentPlayer = (currentPlayer + 1) % numPlayers;
    updateTurnOrbs();
    lifeEl.classList.remove("life-heal", "life-dmg");
    flashEl.classList.remove("flash-heal", "flash-dmg");
    lifeEl.textContent = players[currentPlayer].life;
    updateRadDisplay();
    updateTurnDisplay();
  });

  // Player config popup

  function setConfigCount(count) {
    configSelectedCount = count;
    countButtons.forEach(btn => {
      const c = parseInt(btn.getAttribute("data-count"), 10);
      btn.classList.toggle("active", c === count);
    });
    nameRows.forEach((row, idx) => {
      row.style.display = idx < count ? "flex" : "none";
    });
  }

  function openPlayerConfig() {
    setConfigCount(numPlayers);
    for (let i = 0; i < 6; i++) {
      const player = players[i];
      nameInputs[i].value = player && player.name ? player.name : defaultName(i);
    }
    playerConfig.classList.add("open");
  }

  function closePlayerConfig() {
    playerConfig.classList.remove("open");
  }

  turnText.addEventListener("pointerdown", openPlayerConfig);

  countButtons.forEach(btn => {
    btn.addEventListener("pointerdown", () => {
      const count = parseInt(btn.getAttribute("data-count"), 10);
      setConfigCount(count);
    });
  });

  configCancel.addEventListener("pointerdown", closePlayerConfig);

  configSave.addEventListener("pointerdown", () => {
    const newPlayers = [];
    for (let i = 0; i < configSelectedCount; i++) {
      const existing = players[i];
      const rawName = nameInputs[i].value.trim();
      const name = rawName || defaultName(i);
      newPlayers.push({
        name,
        life: existing ? existing.life : DEFAULT_LIFE,
        rad: existing ? existing.rad : 0
      });
    }
    players = newPlayers;
    numPlayers = configSelectedCount;
    if (currentPlayer >= numPlayers) currentPlayer = numPlayers - 1;

    updateTurnOrbs();
    updateTurnDisplay();
    updateLifeDisplay();
    updateRadDisplay();
    closePlayerConfig();
  });

  playerConfig.addEventListener("click", e => {
    if (e.target === playerConfig) {
      closePlayerConfig();
    }
  });

  // Effect picker controls
  addEffectBtn.addEventListener("click", openEffectPicker);
  closePickerBtn.addEventListener("pointerdown", closeEffectPicker);

  effectPicker.addEventListener("click", e => {
    if (e.target === effectPicker) {
      closeEffectPicker();
    }
  });

  // INIT
  buildEffectOptions();
  attachLifeZoneHandlers();
  attachRadHandlers();
  renderEffects();

  players = [];
  for (let i = 0; i < 4; i++) {
    players.push({ name: defaultName(i), life: DEFAULT_LIFE, rad: 0 });
  }
  initPlayers(4);
</script>
</body>
</html>