<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, user-scalable=no"
/>
<title>Mothman Life / Turn / Rad Tracker</title>
<style>
  :root {
    --bg: #050608;
    --panel: #11131a;
    --panel-soft: #181b24;
    --border-soft: #262a36;
    --text-main: #f7f7f7;
    --muted: #a0a8c0;
    --accent: #5ee0ff;
    --heal: #6dff9f;
    --dmg: #ff5a5a;
    --life: #a6ff78; /* fluorescent greenish */
  }

  * {
    box-sizing: border-box;
  }

  html,
  body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: radial-gradient(circle at top, #131626 0, #050608 55%);
    color: var(--text-main);
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    display: flex;
    align-items: stretch;
    justify-content: center;
  }

  .app {
    position: relative;
    width: 100%;
    max-width: 520px;
    height: 100vh;
    display: flex;
    flex-direction: column;
    padding: 12px 12px 10px;
  }

  /* TOP BAR – 5-COLOR TURN TRACKER + CENTER */

  #topBar {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    margin-bottom: 10px;
  }

  #turnTracker {
    position: relative;
    width: 88px;
    height: 88px;
    border-radius: 50%;
    background: radial-gradient(circle at center, #181b27 0, #090b11 60%);
    border: 1px solid var(--border-soft);
    box-shadow:
      0 0 0 1px rgba(0, 0, 0, 0.6),
      0 10px 22px rgba(0, 0, 0, 0.85);
  }

  .turn-orb {
    position: absolute;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    opacity: 0.25;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.9);
    transition:
      opacity 0.16s ease,
      transform 0.16s ease,
      box-shadow 0.16s ease;
  }

  /* Positions for pentagon layout */
  .orb0 { /* white - top */
    top: 8%;
    left: 50%;
    background: #f8f5e6;
  }
  .orb1 { /* blue - upper right */
    top: 34%;
    left: 90%;
    background: #3aa3ff;
  }
  .orb2 { /* black - lower right */
    top: 78%;
    left: 70%;
    background: #1b1b24;
  }
  .orb3 { /* red - lower left */
    top: 78%;
    left: 30%;
    background: #ff5a40;
  }
  .orb4 { /* green - upper left */
    top: 34%;
    left: 10%;
    background: #2fd166;
  }
  .orb5 { /* center - 6th player */
    top: 50%;
    left: 50%;
    background: #b38cff;
  }

  .turn-orb.active {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1.18);
    box-shadow:
      0 0 8px rgba(255, 255, 255, 0.9),
      0 0 18px rgba(94, 224, 255, 0.7);
  }

  .turn-orb.disabled {
    opacity: 0.08;
    box-shadow: none;
  }

  #turnText {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: var(--muted);
    padding: 4px 10px;
    border-radius: 999px;
    background: rgba(8, 10, 18, 0.7);
    border: 1px solid rgba(38, 42, 54, 0.9);
  }

  #turnText:active {
    transform: scale(0.97);
    opacity: 0.9;
  }

  /* LIFE AREA */

  #lifeArea {
    flex: 1;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #lifeWrapper {
    position: relative;
    width: 100%;
    max-width: 360px;
    aspect-ratio: 4 / 3;
    border-radius: 24px;
    background: radial-gradient(circle at top, #141826 0, #090b10 60%);
    border: 1px solid var(--border-soft);
    box-shadow:
      0 0 0 1px rgba(94, 224, 255, 0.05),
      0 20px 35px rgba(0, 0, 0, 0.85);
    overflow: hidden;
  }

  #lifeHintRow {
    position: absolute;
    top: 8px;
    left: 0;
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 14px;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--muted);
    opacity: 0.8;
    pointer-events: none;
  }

  #life {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 112px;
    font-weight: 800;
    color: var(--life);
    text-shadow:
      0 0 14px rgba(166, 255, 120, 0.6),
      0 0 30px rgba(166, 255, 120, 0.4);
    transition:
      transform 0.17s ease,
      color 0.17s ease,
      text-shadow 0.17s ease;
    pointer-events: none;
  }

  .life-label {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: var(--muted);
    opacity: 0.65;
    pointer-events: none;
  }

  #lifeLabelLeft {
    left: 10px;
  }

  #lifeLabelRight {
    right: 10px;
    text-align: right;
  }

  .life-zone {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 50%;
  }

  #lifeLeftZone {
    left: 0;
  }

  #lifeRightZone {
    right: 0;
  }

  /* RAD CONTROL */

  #radControl {
    position: absolute;
    bottom: 14px;
    left: 50%;
    transform: translateX(-50%);
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 4px 11px;
    border-radius: 999px;
    border: 1px solid #3bffb0;
    background: rgba(10, 20, 16, 0.9);
    box-shadow:
      0 0 10px rgba(166, 255, 120, 0.35),
      0 0 18px rgba(40, 120, 80, 0.45);
    font-size: 11px;
    color: var(--muted);
  }

  #radLabel {
    text-transform: uppercase;
    letter-spacing: 0.18em;
    font-size: 9px;
  }

  #radDisplay {
    min-width: 22px;
    text-align: center;
    color: var(--life);
    font-weight: 600;
  }

  /* LIFE FEEDBACK ANIMATIONS */

  .life-heal {
    color: var(--heal) !important;
    transform: translate(-50%, -50%) scale(1.08) !important;
    text-shadow:
      0 0 14px rgba(109, 255, 159, 0.8),
      0 0 32px rgba(109, 255, 159, 0.7) !important;
  }

  .life-dmg {
    color: var(--dmg) !important;
    transform: translate(-50%, -50%) scale(0.93) !important;
    text-shadow:
      0 0 14px rgba(255, 90, 90, 0.9),
      0 0 30px rgba(255, 90, 90, 0.7) !important;
  }

  #flash {
    position: fixed;
    inset: 0;
    pointer-events: none;
    background: transparent;
    opacity: 0;
    transition: opacity 0.18s ease;
    mix-blend-mode: screen;
  }

  #flash.flash-heal {
    background: radial-gradient(circle at center, rgba(109, 255, 159, 0.25), transparent 60%);
    opacity: 1;
  }

  #flash.flash-dmg {
    background: radial-gradient(circle at center, rgba(255, 90, 90, 0.3), transparent 65%);
    opacity: 1;
  }

  /* EFFECTS PANEL */

  #effectsPanel {
    margin-top: 8px;
    padding: 10px 10px 8px;
    border-radius: 16px;
    background: linear-gradient(180deg, #10131f, #080910);
    border: 1px solid var(--border-soft);
    box-shadow: 0 10px 26px rgba(0, 0, 0, 0.75);
  }

  .effects-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
  }

  .effects-title {
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--muted);
  }

  #addEffectBtn {
    padding: 4px 10px;
    border-radius: 999px;
    border: 1px solid var(--accent);
    background: radial-gradient(circle at top, #22273b 0, #12141e 70%);
    color: var(--text-main);
    font-size: 11px;
    font-weight: 600;
  }

  #addEffectBtn:active {
    transform: scale(0.96);
    opacity: 0.9;
  }

  #effectsList {
    max-height: 130px;
    overflow-y: auto;
    padding-right: 4px;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .effect-chip {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 5px 9px;
    border-radius: 999px;
    font-size: 11px;
    background: #171a26;
    border: 1px solid #262a36;
    color: var(--muted);
  }

  .effect-dot {
    width: 8px;
    height: 8px;
    border-radius: 999px;
    background: var(--accent);
    box-shadow: 0 0 6px rgba(94, 224, 255, 0.7);
  }

  .effect-name {
    color: var(--text-main);
  }

  .effect-remove {
    border: none;
    background: transparent;
    color: #707793;
    font-size: 12px;
    padding: 0;
  }

  .effect-remove:active {
    transform: scale(0.9);
    opacity: 0.7;
  }

  /* EFFECT PICKER (BOTTOM SHEET) */

  #effectPicker {
    position: fixed;
    inset: 0;
    background: rgba(1, 2, 5, 0.55);
    display: none;
    align-items: flex-end;
    justify-content: center;
    z-index: 20;
  }

  #effectPicker.open {
    display: flex;
  }

  .picker-inner {
    width: 100%;
    max-width: 520px;
    max-height: 60vh;
    border-radius: 16px 16px 0 0;
    background: #090b11;
    border-top: 1px solid var(--border-soft);
    box-shadow: 0 -18px 30px rgba(0, 0, 0, 0.8);
    padding: 8px 12px 12px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .picker-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-bottom: 4px;
  }

  .picker-title {
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--muted);
  }

  #closePickerBtn {
    border-radius: 999px;
    border: 1px solid var(--border-soft);
    background: #141722;
    color: var(--muted);
    font-size: 12px;
    padding: 2px 8px;
  }

  #effectOptions {
    flex: 1;
    overflow-y: auto;
    margin-top: 4px;
    padding-right: 4px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .effect-option {
    padding: 8px 9px;
    border-radius: 10px;
    background: #11141f;
    border: 1px solid #242737;
  }

  .effect-option-main {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    margin-bottom: 3px;
  }

  .effect-option-name {
    font-size: 13px;
    font-weight: 600;
  }

  .effect-tag {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--muted);
  }

  .effect-option-note {
    font-size: 11px;
    color: var(--muted);
  }

  .effect-option:active {
    transform: scale(0.98);
    border-color: var(--accent);
  }

  /* PLAYER CONFIG POPUP */

  #playerConfig {
    position: fixed;
    inset: 0;
    background: rgba(1, 2, 5, 0.6);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 25;
  }

  #playerConfig.open {
    display: flex;
  }

  .config-inner {
    width: 100%;
    max-width: 420px;
    border-radius: 16px;
    background: #090b11;
    border: 1px solid var(--border-soft);
    box-shadow: 0 18px 35px rgba(0, 0, 0, 0.9);
    padding: 10px 14px 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .config-header {
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
  }

  .player-count-row {
    display: flex;
    gap: 6px;
    margin: 4px 0;
  }

  .count-btn {
    flex: 1;
    padding: 6px 0;
    border-radius: 999px;
    border: 1px solid var(--border-soft);
    background: #121421;
    color: var(--muted);
    font-size: 12px;
  }

  .count-btn.active {
    border-color: var(--accent);
    color: var(--text-main);
    background: radial-gradient(circle at top, #22273b 0, #121421 80%);
  }

  #nameFields {
    margin-top: 4px;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .name-row {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .name-row label {
    min-width: 64px;
    font-size: 11px;
    color: var(--muted);
  }

  .name-row input {
    flex: 1;
    padding: 4px 6px;
    border-radius: 8px;
    border: 1px solid var(--border-soft);
    background: #11141f;
    color: var(--text-main);
    font-size: 12px;
  }

  .config-footer {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
    margin-top: 6px;
  }

  .config-btn {
    padding: 5px 12px;
    border-radius: 999px;
    font-size: 12px;
    border: 1px solid var(--border-soft);
    background: #141722;
    color: var(--muted);
  }

  #configSave {
    border-color: var(--accent);
    color: var(--text-main);
    background: radial-gradient(circle at top, #22273b 0, #11131f 80%);
  }

  .config-btn:active {
    transform: scale(0.97);
    opacity: 0.9;
  }

  /* SCROLLBARS (SUBTLE) */
  #effectsList::-webkit-scrollbar,
  #effectOptions::-webkit-scrollbar {
    width: 4px;
  }

  #effectsList::-webkit-scrollbar-thumb,
  #effectOptions::-webkit-scrollbar-thumb {
    background: #2b3040;
    border-radius: 999px;
  }
</style>
</head>
<body>
<div class="app">
  <header id="topBar">
    <div id="turnTracker">
      <div class="turn-orb orb0" data-index="0"></div>
      <div class="turn-orb orb1" data-index="1"></div>
      <div class="turn-orb orb2" data-index="2"></div>
      <div class="turn-orb orb3" data-index="3"></div>
      <div class="turn-orb orb4" data-index="4"></div>
      <div class="turn-orb orb5" data-index="5"></div>
    </div>
    <div id="turnText">Player 1</div>
  </header>

  <main id="lifeArea">
    <div id="lifeWrapper">
      <div id="lifeHintRow">
        <span>Tap left = -1</span>
        <span>Tap right = +1</span>
      </div>
      <div id="lifeLabelLeft" class="life-label">Damage</div>
      <div id="lifeLabelRight" class="life-label">Heal</div>

      <div id="life">40</div>

      <div id="lifeLeftZone" class="life-zone"></div>
      <div id="lifeRightZone" class="life-zone"></div>

      <div id="radControl">
        <span id="radLabel">RAD</span>
        <div id="radDisplay">0</div>
      </div>
    </div>
  </main>

  <section id="effectsPanel">
    <div class="effects-header">
      <div class="effects-title">Mothman Effects / Reminders</div>
      <button id="addEffectBtn">+ Add</button>
    </div>
    <div id="effectsList"></div>
  </section>
</div>

<div id="effectPicker">
  <div class="picker-inner">
    <div class="picker-header">
      <div class="picker-title">Select Mothman Effect</div>
      <button id="closePickerBtn">Close</button>
    </div>
    <div id="effectOptions"></div>
  </div>
</div>

<div id="playerConfig">
  <div class="config-inner">
    <div class="config-header">Players & Names</div>
    <div class="player-count-row">
      <button class="count-btn" data-count="1">1</button>
      <button class="count-btn" data-count="2">2</button>
      <button class="count-btn" data-count="3">3</button>
      <button class="count-btn" data-count="4">4</button>
      <button class="count-btn" data-count="5">5</button>
      <button class="count-btn" data-count="6">6</button>
    </div>
    <div id="nameFields">
      <div class="name-row" data-index="0">
        <label>Player 1</label>
        <input id="nameInput0" type="text" placeholder="Player 1" />
      </div>
      <div class="name-row" data-index="1">
        <label>Player 2</label>
        <input id="nameInput1" type="text" placeholder="Player 2" />
      </div>
      <div class="name-row" data-index="2">
        <label>Player 3</label>
        <input id="nameInput2" type="text" placeholder="Player 3" />
      </div>
      <div class="name-row" data-index="3">
        <label>Player 4</label>
        <input id="nameInput3" type="text" placeholder="Player 4" />
      </div>
      <div class="name-row" data-index="4">
        <label>Player 5</label>
        <input id="nameInput4" type="text" placeholder="Player 5" />
      </div>
      <div class="name-row" data-index="5">
        <label>Player 6</label>
        <input id="nameInput5" type="text" placeholder="Player 6" />
      </div>
    </div>
    <div class="config-footer">
      <button id="configCancel" class="config-btn">Cancel</button>
      <button id="configSave" class="config-btn">Save</button>
    </div>
  </div>
</div>

<div id="flash"></div>

<script>
  const DEFAULT_LIFE = 40;

  // Mothman / Mutant Menace specific reminders
  const EFFECT_TEMPLATES = [
    {
      id: "mothman_rad_main",
      name: "Wise Mothman – Rad trigger",
      tag: "precombat main",
      note: "Each player with rad counters mills that many and loses that much life."
    },
    {
      id: "mothman_attack",
      name: "Wise Mothman – Attack trigger",
      tag: "attack",
      note: "On attack, each player gets a rad counter."
    },
    {
      id: "vault_87",
      name: "Vault 87 / heavy rad source",
      tag: "static",
      note: "Persistent rad from Vault 87 or similar effects."
    },
    {
      id: "inexorable_tide",
      name: "Inexorable Tide",
      tag: "cast spell",
      note: "Whenever you cast a spell, proliferate (rad and +1/+1 counters)."
    },
    {
      id: "counters_double",
      name: "Corpsejack Menace / Branching Evolution",
      tag: "counters",
      note: "Counters entering on your creatures are doubled or increased."
    },
    {
      id: "master_reanimate",
      name: "The Master – Reanimate",
      tag: "activated",
      note: "Once per turn, reanimate a creature milled this turn as a 3/3 Mutant."
    }
  ];

  let numPlayers = 4;
  let currentPlayer = 0;
  let players = []; // { name, life, rad }
  let activeEffects = [];

  const lifeEl = document.getElementById("life");
  const lifeLeftZone = document.getElementById("lifeLeftZone");
  const lifeRightZone = document.getElementById("lifeRightZone");
  const flashEl = document.getElementById("flash");

  const radDisplay = document.getElementById("radDisplay");
  const radControl = document.getElementById("radControl");

  const turnTracker = document.getElementById("turnTracker");
  const turnText = document.getElementById("turnText");
  const turnOrbs = Array.from(document.querySelectorAll(".turn-orb"));

  const effectsListEl = document.getElementById("effectsList");
  const addEffectBtn = document.getElementById("addEffectBtn");
  const effectPicker = document.getElementById("effectPicker");
  const effectOptionsEl = document.getElementById("effectOptions");
  const closePickerBtn = document.getElementById("closePickerBtn");

  const playerConfig = document.getElementById("playerConfig");
  const countButtons = Array.from(document.querySelectorAll(".count-btn"));
  const nameRows = Array.from(document.querySelectorAll(".name-row"));
  const nameInputs = [
    document.getElementById("nameInput0"),
    document.getElementById("nameInput1"),
    document.getElementById("nameInput2"),
    document.getElementById("nameInput3"),
    document.getElementById("nameInput4"),
    document.getElementById("nameInput5")
  ];
  const configCancel = document.getElementById("configCancel");
  const configSave = document.getElementById("configSave");

  let configSelectedCount = 4;

  function defaultName(index) {
    return `Player ${index + 1}`;
  }

  function initPlayers(count) {
    numPlayers = Math.min(Math.max(count, 1), 6);
    const newPlayers = [];

    for (let i = 0; i < numPlayers; i++) {
      const existing = players[i];
      newPlayers.push({
        name: existing ? existing.name : defaultName(i),
        life: existing ? existing.life : DEFAULT_LIFE,
        rad: existing ? existing.rad : 0
      });
    }

    players = newPlayers;
    if (currentPlayer >= numPlayers) currentPlayer = numPlayers - 1;

    updateTurnDisplay();
    updateTurnOrbs();
    updateLifeDisplay();
    updateRadDisplay();
  }

  function updateTurnDisplay() {
    const p = players[currentPlayer];
    const name = p && p.name ? p.name : defaultName(currentPlayer);
    turnText.textContent = name;
  }

  function updateTurnOrbs() {
    turnOrbs.forEach((orb, idx) => {
      orb.classList.remove("active", "disabled");
      if (idx >= numPlayers) {
        orb.classList.add("disabled");
      }
      if (idx === currentPlayer) {
        orb.classList.add("active");
      }
    });
  }

  function updateLifeDisplay(type) {
    const life = players[currentPlayer].life;
    lifeEl.textContent = life;

    lifeEl.classList.remove("life-heal", "life-dmg");
    void lifeEl.offsetWidth;

    flashEl.classList.remove("flash-heal", "flash-dmg");
    void flashEl.offsetWidth;

    if (type === "heal") {
      lifeEl.classList.add("life-heal");
      flashEl.classList.add("flash-heal");
    } else if (type === "dmg") {
      lifeEl.classList.add("life-dmg");
      flashEl.classList.add("flash-dmg");
    }

    if (type === "heal" || type === "dmg") {
      setTimeout(() => {
        flashEl.classList.remove("flash-heal", "flash-dmg");
      }, 200);
    }

    updateTurnDisplay();
  }

  function changeLife(delta) {
    const player = players[currentPlayer];
    player.life = Math.max(0, player.life + delta);
    const type = delta > 0 ? "heal" : delta < 0 ? "dmg" : null;
    updateLifeDisplay(type);
  }

  function updateRadDisplay() {
    const rad = players[currentPlayer].rad;
    radDisplay.textContent = rad;
  }

  function changeRad(delta) {
    const player = players[currentPlayer];
    player.rad = Math.max(0, player.rad + delta);
    updateRadDisplay();
  }

  function renderEffects() {
    effectsListEl.innerHTML = "";

    if (!activeEffects.length) {
      const empty = document.createElement("div");
      empty.textContent = "No active effects – tap + Add to track Mothman triggers.";
      empty.style.fontSize = "11px";
      empty.style.color = "var(--muted)";
      effectsListEl.appendChild(empty);
      return;
    }

    activeEffects.forEach((eff, idx) => {
      const chip = document.createElement("div");
      chip.className = "effect-chip";

      const dot = document.createElement("div");
      dot.className = "effect-dot";

      const nameSpan = document.createElement("span");
      nameSpan.className = "effect-name";
      nameSpan.textContent = eff.name;

      const removeBtn = document.createElement("button");
      removeBtn.className = "effect-remove";
      removeBtn.textContent = "✕";
      removeBtn.addEventListener("click", () => {
        activeEffects.splice(idx, 1);
        renderEffects();
      });

      chip.appendChild(dot);
      chip.appendChild(nameSpan);
      chip.appendChild(removeBtn);

      effectsListEl.appendChild(chip);
    });
  }

  function openEffectPicker() {
    effectPicker.classList.add("open");
  }

  function closeEffectPicker() {
    effectPicker.classList.remove("open");
  }

  function buildEffectOptions() {
    effectOptionsEl.innerHTML = "";
    EFFECT_TEMPLATES.forEach(tpl => {
      const opt = document.createElement("div");
      opt.className = "effect-option";

      const mainRow = document.createElement("div");
      mainRow.className = "effect-option-main";

      const nameSpan = document.createElement("span");
      nameSpan.className = "effect-option-name";
      nameSpan.textContent = tpl.name;

      const tagSpan = document.createElement("span");
      tagSpan.className = "effect-tag";
      tagSpan.textContent = tpl.tag;

      mainRow.appendChild(nameSpan);
      mainRow.appendChild(tagSpan);

      const note = document.createElement("div");
      note.className = "effect-option-note";
      note.textContent = tpl.note;

      opt.appendChild(mainRow);
      opt.appendChild(note);

      opt.addEventListener("click", () => {
        activeEffects.push({
          id: tpl.id,
          name: tpl.name
        });
        renderEffects();
        closeEffectPicker();
      });

      effectOptionsEl.appendChild(opt);
    });
  }

  function attachLifeZoneHandlers() {
    const onLeft = () => changeLife(-1);
    const onRight = () => changeLife(1);

    ["pointerdown"].forEach(evt => {
      lifeLeftZone.addEventListener(evt, onLeft);
      lifeRightZone.addEventListener(evt, onRight);
    });
  }

  function attachRadHandlers() {
    radControl.addEventListener("pointerdown", e => {
      const rect = radControl.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const half = rect.width / 2;
      if (x < half) {
        changeRad(-1);
      } else {
        changeRad(1);
      }
    });
  }

  // Turn tracker: single tap advances turn
  turnTracker.addEventListener("pointerdown", () => {
    currentPlayer = (currentPlayer + 1) % numPlayers;
    updateTurnOrbs();
    lifeEl.classList.remove("life-heal", "life-dmg");
    flashEl.classList.remove("flash-heal", "flash-dmg");
    lifeEl.textContent = players[currentPlayer].life;
    updateRadDisplay();
    updateTurnDisplay();
  });

  // Player config popup

  function setConfigCount(count) {
    configSelectedCount = count;
    countButtons.forEach(btn => {
      const c = parseInt(btn.getAttribute("data-count"), 10);
      btn.classList.toggle("active", c === count);
    });
    nameRows.forEach((row, idx) => {
      row.style.display = idx < count ? "flex" : "none";
    });
  }

  function openPlayerConfig() {
    setConfigCount(numPlayers);
    for (let i = 0; i < 6; i++) {
      const player = players[i];
      nameInputs[i].value = player && player.name ? player.name : defaultName(i);
    }
    playerConfig.classList.add("open");
  }

  function closePlayerConfig() {
    playerConfig.classList.remove("open");
  }

  turnText.addEventListener("pointerdown", openPlayerConfig);

  countButtons.forEach(btn => {
    btn.addEventListener("pointerdown", () => {
      const count = parseInt(btn.getAttribute("data-count"), 10);
      setConfigCount(count);
    });
  });

  configCancel.addEventListener("pointerdown", closePlayerConfig);

  configSave.addEventListener("pointerdown", () => {
    const newPlayers = [];
    for (let i = 0; i < configSelectedCount; i++) {
      const existing = players[i];
      const rawName = nameInputs[i].value.trim();
      const name = rawName || defaultName(i);
      newPlayers.push({
        name,
        life: existing ? existing.life : DEFAULT_LIFE,
        rad: existing ? existing.rad : 0
      });
    }
    players = newPlayers;
    numPlayers = configSelectedCount;
    if (currentPlayer >= numPlayers) currentPlayer = numPlayers - 1;

    updateTurnOrbs();
    updateTurnDisplay();
    updateLifeDisplay();
    updateRadDisplay();
    closePlayerConfig();
  });

  playerConfig.addEventListener("click", e => {
    if (e.target === playerConfig) {
      closePlayerConfig();
    }
  });

  // Effect picker controls
  addEffectBtn.addEventListener("click", openEffectPicker);
  closePickerBtn.addEventListener("pointerdown", closeEffectPicker);

  effectPicker.addEventListener("click", e => {
    if (e.target === effectPicker) {
      closeEffectPicker();
    }
  });

  // INIT
  buildEffectOptions();
  attachLifeZoneHandlers();
  attachRadHandlers();
  renderEffects();

  players = [];
  for (let i = 0; i < 4; i++) {
    players.push({ name: defaultName(i), life: DEFAULT_LIFE, rad: 0 });
  }
  initPlayers(4);
</script>
</body>
</html>