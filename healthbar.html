<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, user-scalable=no"
/>
<title>Mothman Life & Turn Tracker</title>
<style>
  :root {
    --bg: #050608;
    --panel: #11131a;
    --panel-soft: #181b24;
    --border-soft: #262a36;
    --text-main: #f7f7f7;
    --muted: #a0a8c0;
    --accent: #5ee0ff;
    --heal: #6dff9f;
    --dmg: #ff5a5a;
    --life: #a6ff78; /* fluorescent greenish */
  }

  * {
    box-sizing: border-box;
  }

  html,
  body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: radial-gradient(circle at top, #131626 0, #050608 55%);
    color: var(--text-main);
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    display: flex;
    align-items: stretch;
    justify-content: center;
  }

  .app {
    position: relative;
    width: 100%;
    max-width: 520px;
    height: 100vh;
    display: flex;
    flex-direction: column;
    padding: 12px 12px 10px;
  }

  /* TOP BAR */

  #topBar {
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-bottom: 10px;
  }

  #playerDotsRow {
    display: flex;
    justify-content: center;
    gap: 10px;
  }

  .player-dot {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    border: 2px solid var(--border-soft);
    background: #080910;
    box-shadow: 0 0 6px rgba(0, 0, 0, 0.8);
    position: relative;
  }

  .player-dot::after {
    content: attr(data-players);
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 9px;
    color: var(--muted);
  }

  .player-dot.active {
    border-color: var(--accent);
    box-shadow: 0 0 9px rgba(94, 224, 255, 0.9);
  }

  #turnRow {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 6px 10px;
    border-radius: 10px;
    background: linear-gradient(135deg, #101321, #171a27);
    border: 1px solid var(--border-soft);
  }

  #turnDisplay {
    font-size: 14px;
    font-weight: 600;
  }

  #turnSub {
    font-size: 11px;
    color: var(--muted);
  }

  #turnLabelGroup {
    display: flex;
    flex-direction: column;
  }

  #nextTurnBtn {
    padding: 6px 14px;
    border-radius: 999px;
    border: 1px solid var(--accent);
    background: radial-gradient(circle at top, #2b3248 0, #11131a 60%);
    color: var(--text-main);
    font-size: 12px;
    font-weight: 600;
    letter-spacing: 0.03em;
    text-transform: uppercase;
  }

  #nextTurnBtn:active {
    transform: scale(0.96);
    opacity: 0.85;
  }

  /* LIFE AREA */

  #lifeArea {
    flex: 1;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #lifeWrapper {
    position: relative;
    width: 100%;
    max-width: 360px;
    aspect-ratio: 4 / 3;
    border-radius: 24px;
    background: radial-gradient(circle at top, #141826 0, #090b10 60%);
    border: 1px solid var(--border-soft);
    box-shadow:
      0 0 0 1px rgba(94, 224, 255, 0.05),
      0 20px 35px rgba(0, 0, 0, 0.85);
    overflow: hidden;
  }

  #lifeHintRow {
    position: absolute;
    top: 8px;
    left: 0;
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 14px;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--muted);
    opacity: 0.8;
    pointer-events: none;
  }

  #life {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 112px;
    font-weight: 800;
    color: var(--life);
    text-shadow:
      0 0 14px rgba(166, 255, 120, 0.6),
      0 0 30px rgba(166, 255, 120, 0.4);
    transition:
      transform 0.17s ease,
      color 0.17s ease,
      text-shadow 0.17s ease;
    pointer-events: none;
  }

  .life-label {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: var(--muted);
    opacity: 0.65;
    pointer-events: none;
  }

  #lifeLabelLeft {
    left: 10px;
  }

  #lifeLabelRight {
    right: 10px;
    text-align: right;
  }

  .life-zone {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 50%;
  }

  #lifeLeftZone {
    left: 0;
  }

  #lifeRightZone {
    right: 0;
  }

  /* LIFE FEEDBACK ANIMATIONS */

  .life-heal {
    color: var(--heal) !important;
    transform: translate(-50%, -50%) scale(1.08) !important;
    text-shadow:
      0 0 14px rgba(109, 255, 159, 0.8),
      0 0 32px rgba(109, 255, 159, 0.7) !important;
  }

  .life-dmg {
    color: var(--dmg) !important;
    transform: translate(-50%, -50%) scale(0.93) !important;
    text-shadow:
      0 0 14px rgba(255, 90, 90, 0.9),
      0 0 30px rgba(255, 90, 90, 0.7) !important;
  }

  #flash {
    position: fixed;
    inset: 0;
    pointer-events: none;
    background: transparent;
    opacity: 0;
    transition: opacity 0.18s ease;
    mix-blend-mode: screen;
  }

  #flash.flash-heal {
    background: radial-gradient(circle at center, rgba(109, 255, 159, 0.25), transparent 60%);
    opacity: 1;
  }

  #flash.flash-dmg {
    background: radial-gradient(circle at center, rgba(255, 90, 90, 0.3), transparent 65%);
    opacity: 1;
  }

  /* EFFECTS PANEL */

  #effectsPanel {
    margin-top: 8px;
    padding: 10px 10px 8px;
    border-radius: 16px;
    background: linear-gradient(180deg, #10131f, #080910);
    border: 1px solid var(--border-soft);
    box-shadow: 0 10px 26px rgba(0, 0, 0, 0.75);
  }

  .effects-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
  }

  .effects-title {
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--muted);
  }

  #addEffectBtn {
    padding: 4px 10px;
    border-radius: 999px;
    border: 1px solid var(--accent);
    background: radial-gradient(circle at top, #22273b 0, #12141e 70%);
    color: var(--text-main);
    font-size: 11px;
    font-weight: 600;
  }

  #addEffectBtn:active {
    transform: scale(0.96);
    opacity: 0.9;
  }

  #effectsList {
    max-height: 130px;
    overflow-y: auto;
    padding-right: 4px;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .effect-chip {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 5px 9px;
    border-radius: 999px;
    font-size: 11px;
    background: #171a26;
    border: 1px solid #262a36;
    color: var(--muted);
  }

  .effect-dot {
    width: 8px;
    height: 8px;
    border-radius: 999px;
    background: var(--accent);
    box-shadow: 0 0 6px rgba(94, 224, 255, 0.7);
  }

  .effect-name {
    color: var(--text-main);
  }

  .effect-remove {
    border: none;
    background: transparent;
    color: #707793;
    font-size: 12px;
    padding: 0;
  }

  .effect-remove:active {
    transform: scale(0.9);
    opacity: 0.7;
  }

  /* EFFECT PICKER (BOTTOM SHEET) */

  #effectPicker {
    position: fixed;
    inset: 0;
    background: rgba(1, 2, 5, 0.55);
    display: none;
    align-items: flex-end;
    justify-content: center;
    z-index: 20;
  }

  #effectPicker.open {
    display: flex;
  }

  .picker-inner {
    width: 100%;
    max-width: 520px;
    max-height: 60vh;
    border-radius: 16px 16px 0 0;
    background: #090b11;
    border-top: 1px solid var(--border-soft);
    box-shadow: 0 -18px 30px rgba(0, 0, 0, 0.8);
    padding: 8px 12px 12px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .picker-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-bottom: 4px;
  }

  .picker-title {
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--muted);
  }

  #closePickerBtn {
    border-radius: 999px;
    border: 1px solid var(--border-soft);
    background: #141722;
    color: var(--muted);
    font-size: 12px;
    padding: 2px 8px;
  }

  #effectOptions {
    flex: 1;
    overflow-y: auto;
    margin-top: 4px;
    padding-right: 4px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .effect-option {
    padding: 8px 9px;
    border-radius: 10px;
    background: #11141f;
    border: 1px solid #242737;
  }

  .effect-option-main {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    margin-bottom: 3px;
  }

  .effect-option-name {
    font-size: 13px;
    font-weight: 600;
  }

  .effect-tag {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--muted);
  }

  .effect-option-note {
    font-size: 11px;
    color: var(--muted);
  }

  .effect-option:active {
    transform: scale(0.98);
    border-color: var(--accent);
  }

  /* SCROLLBARS (SUBTLE) */
  #effectsList::-webkit-scrollbar,
  #effectOptions::-webkit-scrollbar {
    width: 4px;
  }

  #effectsList::-webkit-scrollbar-thumb,
  #effectOptions::-webkit-scrollbar-thumb {
    background: #2b3040;
    border-radius: 999px;
  }
</style>
</head>
<body>
<div class="app">
  <header id="topBar">
    <div id="playerDotsRow">
      <div class="player-dot" data-players="2"></div>
      <div class="player-dot" data-players="3"></div>
      <div class="player-dot active" data-players="4"></div>
      <div class="player-dot" data-players="5"></div>
    </div>
    <div id="turnRow">
      <div id="turnLabelGroup">
        <div id="turnDisplay">Player 1's turn</div>
        <div id="turnSub">Tap "Next" when you pass the turn</div>
      </div>
      <button id="nextTurnBtn">Next</button>
    </div>
  </header>

  <main id="lifeArea">
    <div id="lifeWrapper">
      <div id="lifeHintRow">
        <span>Tap left = -1</span>
        <span>Tap right = +1</span>
      </div>
      <div id="lifeLabelLeft" class="life-label">Damage</div>
      <div id="lifeLabelRight" class="life-label">Heal</div>

      <div id="life">40</div>

      <div id="lifeLeftZone" class="life-zone"></div>
      <div id="lifeRightZone" class="life-zone"></div>
    </div>
  </main>

  <section id="effectsPanel">
    <div class="effects-header">
      <div class="effects-title">Turn Effects / Reminders</div>
      <button id="addEffectBtn">+ Add</button>
    </div>
    <div id="effectsList"></div>
  </section>
</div>

<div id="effectPicker">
  <div class="picker-inner">
    <div class="picker-header">
      <div class="picker-title">Select Mothman Effect</div>
      <button id="closePickerBtn">Close</button>
    </div>
    <div id="effectOptions"></div>
  </div>
</div>

<div id="flash"></div>

<script>
  const DEFAULT_LIFE = 40;

  const EFFECT_TEMPLATES = [
    {
      id: "mothman_rad_main",
      name: "Wise Mothman – Rad trigger",
      tag: "precombat main",
      note: "Each player with rad counters mills and loses life. Remember this every precombat main phase."
    },
    {
      id: "mothman_attack",
      name: "Wise Mothman – Attack trigger",
      tag: "attack",
      note: "On attack, give each player a rad counter. Useful if you forget on busy boards."
    },
    {
      id: "vault_87",
      name: "Vault 87 / heavy rad",
      tag: "static",
      note: "High radiation effects active. Extra reminder to keep rad counters updated each turn cycle."
    },
    {
      id: "inexorable_tide",
      name: "Inexorable Tide",
      tag: "cast spell",
      note: "Whenever you cast a spell, proliferate (rad + +1/+1 counters)."
    },
    {
      id: "counters_double",
      name: "Corpsejack / Branching",
      tag: "counters",
      note: "Remember counters are doubled when placed on creatures you control."
    },
    {
      id: "master_reanimate",
      name: "The Master – Reanimate",
      tag: "activated",
      note: "Once per turn, you can reanimate a creature that was milled this turn as a 3/3 Mutant."
    }
  ];

  let numPlayers = 4;
  let currentPlayer = 0;
  let players = [];

  const lifeEl = document.getElementById("life");
  const lifeLeftZone = document.getElementById("lifeLeftZone");
  const lifeRightZone = document.getElementById("lifeRightZone");
  const flashEl = document.getElementById("flash");

  const playerDots = Array.from(document.querySelectorAll(".player-dot"));
  const turnDisplay = document.getElementById("turnDisplay");
  const turnSub = document.getElementById("turnSub");
  const nextTurnBtn = document.getElementById("nextTurnBtn");

  const effectsListEl = document.getElementById("effectsList");
  const addEffectBtn = document.getElementById("addEffectBtn");
  const effectPicker = document.getElementById("effectPicker");
  const effectOptionsEl = document.getElementById("effectOptions");
  const closePickerBtn = document.getElementById("closePickerBtn");

  function initPlayers(count) {
    numPlayers = count;
    players = [];
    for (let i = 0; i < count; i++) {
      players.push({ life: DEFAULT_LIFE, effects: [] });
    }
    currentPlayer = 0;
    updateTurnDisplay();
    updateLifeDisplay();
    renderEffects();
  }

  function setActivePlayerDot(dotEl) {
    playerDots.forEach(d => d.classList.remove("active"));
    if (dotEl) dotEl.classList.add("active");
  }

  function updateTurnDisplay() {
    const pNum = currentPlayer + 1;
    turnDisplay.textContent = `Player ${pNum}'s turn`;
    turnSub.textContent = `Commander life: ${players[currentPlayer].life}`;
  }

  function updateLifeDisplay(type) {
    const life = players[currentPlayer].life;
    lifeEl.textContent = life;

    lifeEl.classList.remove("life-heal", "life-dmg");
    void lifeEl.offsetWidth;

    flashEl.classList.remove("flash-heal", "flash-dmg");
    void flashEl.offsetWidth;

    if (type === "heal") {
      lifeEl.classList.add("life-heal");
      flashEl.classList.add("flash-heal");
    } else if (type === "dmg") {
      lifeEl.classList.add("life-dmg");
      flashEl.classList.add("flash-dmg");
    }

    setTimeout(() => {
      flashEl.classList.remove("flash-heal", "flash-dmg");
    }, 200);

    updateTurnDisplay();
  }

  function changeLife(delta) {
    const player = players[currentPlayer];
    player.life = Math.max(0, player.life + delta);
    const type = delta > 0 ? "heal" : delta < 0 ? "dmg" : null;
    updateLifeDisplay(type);
  }

  function renderEffects() {
    effectsListEl.innerHTML = "";
    const player = players[currentPlayer];

    if (!player.effects.length) {
      const empty = document.createElement("div");
      empty.textContent = "No active effects – tap + Add to track Mothman triggers.";
      empty.style.fontSize = "11px";
      empty.style.color = "var(--muted)";
      effectsListEl.appendChild(empty);
      return;
    }

    player.effects.forEach((eff, idx) => {
      const chip = document.createElement("div");
      chip.className = "effect-chip";

      const dot = document.createElement("div");
      dot.className = "effect-dot";

      const nameSpan = document.createElement("span");
      nameSpan.className = "effect-name";
      nameSpan.textContent = eff.name;

      const removeBtn = document.createElement("button");
      removeBtn.className = "effect-remove";
      removeBtn.textContent = "✕";
      removeBtn.addEventListener("click", () => {
        player.effects.splice(idx, 1);
        renderEffects();
      });

      chip.appendChild(dot);
      chip.appendChild(nameSpan);
      chip.appendChild(removeBtn);

      effectsListEl.appendChild(chip);
    });
  }

  function openEffectPicker() {
    effectPicker.classList.add("open");
  }

  function closeEffectPicker() {
    effectPicker.classList.remove("open");
  }

  function buildEffectOptions() {
    effectOptionsEl.innerHTML = "";
    EFFECT_TEMPLATES.forEach(tpl => {
      const opt = document.createElement("div");
      opt.className = "effect-option";

      const mainRow = document.createElement("div");
      mainRow.className = "effect-option-main";

      const nameSpan = document.createElement("span");
      nameSpan.className = "effect-option-name";
      nameSpan.textContent = tpl.name;

      const tagSpan = document.createElement("span");
      tagSpan.className = "effect-tag";
      tagSpan.textContent = tpl.tag;

      mainRow.appendChild(nameSpan);
      mainRow.appendChild(tagSpan);

      const note = document.createElement("div");
      note.className = "effect-option-note";
      note.textContent = tpl.note;

      opt.appendChild(mainRow);
      opt.appendChild(note);

      opt.addEventListener("click", () => {
        const player = players[currentPlayer];
        player.effects.push({
          id: tpl.id,
          name: tpl.name
        });
        renderEffects();
        closeEffectPicker();
      });

      effectOptionsEl.appendChild(opt);
    });
  }

  /* EVENTS */

  // Life zones: left = damage, right = heal
  function attachLifeZoneHandlers() {
    const onLeft = () => changeLife(-1);
    const onRight = () => changeLife(1);

    ["pointerdown"].forEach(evt => {
      lifeLeftZone.addEventListener(evt, onLeft);
      lifeRightZone.addEventListener(evt, onRight);
    });
  }

  // Turn cycling
  nextTurnBtn.addEventListener("click", () => {
    currentPlayer = (currentPlayer + 1) % numPlayers;
    updateLifeDisplay();
    renderEffects();
  });

  // Also allow tapping the turn display to advance
  document.getElementById("turnRow").addEventListener("click", e => {
    if (e.target === nextTurnBtn) return;
    currentPlayer = (currentPlayer + 1) % numPlayers;
    updateLifeDisplay();
    renderEffects();
  });

  // Player count dots – double tap / double click to change
  let lastDotTapTime = 0;
  let lastDotEl = null;

  playerDots.forEach(dot => {
    dot.addEventListener("dblclick", () => {
      const count = parseInt(dot.getAttribute("data-players"), 10);
      initPlayers(count);
      setActivePlayerDot(dot);
    });

    dot.addEventListener("pointerdown", () => {
      const now = performance.now();
      if (lastDotEl === dot && now - lastDotTapTime < 350) {
        const count = parseInt(dot.getAttribute("data-players"), 10);
        initPlayers(count);
        setActivePlayerDot(dot);
      }
      lastDotEl = dot;
      lastDotTapTime = now;
    });
  });

  // Effect picker controls
  addEffectBtn.addEventListener("click", openEffectPicker);
  closePickerBtn.addEventListener("click", closeEffectPicker);

  effectPicker.addEventListener("click", e => {
    if (e.target === effectPicker) {
      closeEffectPicker();
    }
  });

  // INIT
  buildEffectOptions();
  attachLifeZoneHandlers();
  initPlayers(4);
</script>
</body>
</html>