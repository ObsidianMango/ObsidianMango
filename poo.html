<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Poop Drop Game</title>
  <!-- Retro pixel font from Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #222;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: 'Press Start 2P', cursive;
      color: #fff;
    }
    #gameContainer {
      position: relative;
      width: 600px;
      height: 800px;
      background: #eee;
      border: 4px solid #000;
      overflow: hidden;
      background: #ccc;
    }
    /* Header for Score, Timer, and Misses */
    #header {
      position: absolute;
      top: 0;
      width: 100%;
      height: 40px;
      background: #000;
      color: #0f0;
      display: flex;
      justify-content: space-around;
      align-items: center;
      font-size: 14px;
      z-index: 10;
    }
    /* Food emojis container (top area) */
    #foodContainer {
      position: absolute;
      top: 45px;
      left: 0;
      width: 100%;
      height: 100px;
      z-index: 5;
    }
    .food {
      position: absolute;
      font-size: 30px;
      cursor: pointer;
      user-select: none;
      transition: transform 0.1s;
    }
    .food:active {
      transform: scale(1.2);
    }
    /* Poo Meter */
    #pooMeterContainer {
      position: absolute;
      top: 150px;
      left: 50%;
      transform: translateX(-50%);
      width: 300px;
      height: 20px;
      border: 2px solid #000;
      background: #fff;
      z-index: 10;
    }
    #pooMeterFill {
      height: 100%;
      background: #0a0;
      width: 0%;
    }
    /* POOP button */
    #poopButton {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 18px;
      padding: 10px 20px;
      z-index: 10;
      cursor: pointer;
    }
    /* Toilet (double-sized emoji) */
    #toilet {
      position: absolute;
      bottom: 70px;
      font-size: 40px;
      user-select: none;
      z-index: 5;
    }
    /* Falling poop emoji */
    .poop {
      position: absolute;
      font-size: 30px;
      user-select: none;
      z-index: 5;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <div id="header">
      <span id="score">Score: 0</span>
      <span id="timer">Time: 330</span>
      <span id="misses">Misses: 0</span>
    </div>
    <div id="foodContainer"></div>
    <div id="pooMeterContainer">
      <div id="pooMeterFill"></div>
    </div>
    <button id="poopButton">POOP</button>
    <div id="toilet">ðŸš½</div>
  </div>

  <script>
    // ----- Game Constants & Variables -----
    const gameWidth = 600;
    const gameHeight = 800;
    const maxPooMeter = 8;  // 8 units = full
    const poopCost = 1;     // Each poop uses 1 unit
    let score = 0;
    let timer = 330;  // seconds
    let misses = 0;
    let consecutiveHits = 0;
    let pooMeter = 0; // current meter (0 to 8)
    let gameRunning = true;
    const poopSpeed = 300; // pixels per second

    let fallingPoops = [];
    let lastFrame = performance.now();

    // Food types with varying fill values
    const foods = [
      { emoji: 'ðŸŽ', value: 1 },
      { emoji: 'ðŸŒ', value: 2 },
      { emoji: 'ðŸ’', value: 1 },
      { emoji: 'ðŸ‡', value: 2 },
      { emoji: 'ðŸ‰', value: 3 },
      { emoji: 'ðŸ', value: 2 },
      { emoji: 'ðŸ‘', value: 1 },
      { emoji: 'ðŸ“', value: 2 },
      { emoji: 'ðŸ”', value: 3 },
      { emoji: 'ðŸŸ', value: 2 },
      { emoji: 'ðŸ•', value: 3 }
    ];

    // ----- DOM Elements -----
    const gameContainer = document.getElementById('gameContainer');
    const foodContainer = document.getElementById('foodContainer');
    const pooMeterFill = document.getElementById('pooMeterFill');
    const scoreDisplay = document.getElementById('score');
    const timerDisplay = document.getElementById('timer');
    const missesDisplay = document.getElementById('misses');
    const poopButton = document.getElementById('poopButton');
    const toilet = document.getElementById('toilet');

    // ----- Utility Functions -----
    function updatePooMeterDisplay() {
      let percentage = (pooMeter / maxPooMeter) * 100;
      pooMeterFill.style.width = percentage + '%';
    }

    function updateScoreDisplay() {
      scoreDisplay.innerText = 'Score: ' + score;
    }

    function updateTimerDisplay() {
      timerDisplay.innerText = 'Time: ' + timer;
    }

    function updateMissesDisplay() {
      missesDisplay.innerText = 'Misses: ' + misses;
    }

    // ----- Food Emoji Spawn & Handling -----
    function spawnFood(foodObj) {
      const foodElem = document.createElement('div');
      foodElem.classList.add('food');
      foodElem.innerText = foodObj.emoji;
      foodElem.setAttribute('data-value', foodObj.value);
      // Random x position within game width (leave 40px padding)
      const x = Math.random() * (gameWidth - 60) + 30;
      // Random y within the top 80px of the foodContainer
      const y = Math.random() * (80 - 30) + 10;
      foodElem.style.left = x + 'px';
      foodElem.style.top = y + 'px';

      foodElem.addEventListener('click', function () {
        // Increase poo meter (cap at maxPooMeter)
        let fillValue = parseInt(this.getAttribute('data-value'));
        pooMeter = Math.min(maxPooMeter, pooMeter + fillValue);
        updatePooMeterDisplay();
        // Remove food and respawn after delay
        this.remove();
        setTimeout(() => { spawnFood(foodObj); }, 3000);
      });

      foodContainer.appendChild(foodElem);
    }

    // Spawn all food emojis initially
    foods.forEach(food => spawnFood(food));

    // ----- POOP Button Handling -----
    poopButton.addEventListener('click', function () {
      if (!gameRunning) return;
      if (pooMeter >= poopCost) {
        pooMeter -= poopCost;
        updatePooMeterDisplay();
        // Create falling poop emoji
        const poopElem = document.createElement('div');
        poopElem.classList.add('poop');
        poopElem.innerText = 'ðŸ’©';
        // Starting position: fixed x at center, just below the meter
        const startX = gameWidth / 2 - 15;
        const startY = 170;
        poopElem.style.left = startX + 'px';
        poopElem.style.top = startY + 'px';
        gameContainer.appendChild(poopElem);
        fallingPoops.push({ element: poopElem, x: startX, y: startY });
      }
    });

    // ----- Toilet Movement -----
    function updateToiletPosition(time) {
      // Oscillate horizontally using a sine wave.
      // Assume toilet width ~80px (double-sized emoji)
      const amplitude = (gameWidth - 80) / 2;
      const centerX = gameWidth / 2;
      const period = 5000; // full cycle in ms
      // time is in ms; adjust sine wave accordingly
      const x = centerX + amplitude * Math.sin((2 * Math.PI / period) * time) - 40;
      toilet.style.left = x + 'px';
    }

    // ----- Game Loop -----
    function gameLoop(time) {
      if (!gameRunning) return;
      const dt = (time - lastFrame) / 1000;
      lastFrame = time;
      
      // Update falling poops
      for (let i = fallingPoops.length - 1; i >= 0; i--) {
        const poop = fallingPoops[i];
        poop.y += poopSpeed * dt;
        poop.element.style.top = poop.y + 'px';
        // When poop nears the bottom (within 100px of gameHeight)
        if (poop.y > gameHeight - 120) {
          // Get center x of poop
          const poopRect = poop.element.getBoundingClientRect();
          const poopCenterX = poopRect.left + poopRect.width / 2;
          const toiletRect = toilet.getBoundingClientRect();
          // Check if poop lands within toilet's horizontal bounds
          if (poopCenterX >= toiletRect.left && poopCenterX <= toiletRect.right) {
            // Successful hit!
            score += 10;
            consecutiveHits++;
            // Award bonus time for consecutive hits (2nd hit onward)
            if (consecutiveHits > 1) {
              const bonus = 5 * (consecutiveHits - 1);
              timer += bonus;
            }
            updateScoreDisplay();
            updateTimerDisplay();
          } else {
            // Missed! Reset streak.
            misses++;
            consecutiveHits = 0;
            updateMissesDisplay();
          }
          // Remove poop element and from our array
          poop.element.remove();
          fallingPoops.splice(i, 1);
        }
      }
      // Update toilet position
      updateToiletPosition(time);
      
      // Check for game over conditions
      if (timer <= 0 || misses >= 50) {
        gameOver();
        return;
      }
      requestAnimationFrame(gameLoop);
    }

    // ----- Timer Countdown -----
    const timerInterval = setInterval(() => {
      if (!gameRunning) return;
      timer--;
      updateTimerDisplay();
      if (timer <= 0) gameOver();
    }, 1000);

    // ----- Game Over -----
    function gameOver() {
      gameRunning = false;
      clearInterval(timerInterval);
      alert("wow you stink");
      // Optionally, you can reload the page to restart:
      // location.reload();
    }

    // Start the game loop
    requestAnimationFrame(gameLoop);
  </script>
</body>
</html>