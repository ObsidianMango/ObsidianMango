<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Natural Crab Walker</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #87CEEB;
      touch-action: none; /* Prevent default touch gestures */
    }
    canvas { display: block; }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script>
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  // Crab properties
  const crab = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    speed: 3,
    angle: 0,           // Current facing direction (radians)
    legCycle: 0,        // Leg animation phase
    moving: false,
    bodySize: 40        // Base size for body and leg calculations
  };

  // Input state for keyboard
  const keys = { left: false, right: false, up: false, down: false };
  document.addEventListener('keydown', e => {
    if (e.key === 'ArrowLeft' || e.key === 'a') keys.left = true;
    if (e.key === 'ArrowRight' || e.key === 'd') keys.right = true;
    if (e.key === 'ArrowUp' || e.key === 'w') keys.up = true;
    if (e.key === 'ArrowDown' || e.key === 's') keys.down = true;
  });
  document.addEventListener('keyup', e => {
    if (e.key === 'ArrowLeft' || e.key === 'a') keys.left = false;
    if (e.key === 'ArrowRight' || e.key === 'd') keys.right = false;
    if (e.key === 'ArrowUp' || e.key === 'w') keys.up = false;
    if (e.key === 'ArrowDown' || e.key === 's') keys.down = false;
  });

  // Touch input variables
  let touchActive = false, touchStartX = 0, touchStartY = 0, touchDX = 0, touchDY = 0;
  canvas.addEventListener('touchstart', e => {
    const touch = e.touches[0];
    touchStartX = touch.clientX;
    touchStartY = touch.clientY;
    touchActive = true;
  });
  canvas.addEventListener('touchmove', e => {
    if (!touchActive) return;
    const touch = e.touches[0];
    touchDX = touch.clientX - touchStartX;
    touchDY = touch.clientY - touchStartY;
    const dist = Math.sqrt(touchDX * touchDX + touchDY * touchDY);
    if (dist > 0) {
      crab.angle = Math.atan2(touchDY, touchDX);
      crab.moving = true;
    }
  });
  canvas.addEventListener('touchend', () => {
    touchActive = false;
    touchDX = 0;
    touchDY = 0;
    crab.moving = false;
  });

  // Update crab position and leg animation
  function update() {
    let moveX = 0, moveY = 0;
    crab.moving = false;

    // Keyboard control
    if (keys.left) { moveX -= 1; crab.angle = Math.PI; crab.moving = true; }
    if (keys.right) { moveX += 1; crab.angle = 0; crab.moving = true; }
    if (keys.up) { moveY -= 1; crab.moving = true; }
    if (keys.down) { moveY += 1; crab.moving = true; }

    // Normalize keyboard movement vector
    if (moveX !== 0 || moveY !== 0) {
      const len = Math.sqrt(moveX * moveX + moveY * moveY);
      moveX /= len;
      moveY /= len;
    }

    // Override with touch control if active
    if (touchActive) {
      const tLen = Math.sqrt(touchDX * touchDX + touchDY * touchDY);
      if (tLen > 0) {
        moveX = touchDX / tLen;
        moveY = touchDY / tLen;
        crab.angle = Math.atan2(touchDY, touchDX);
        crab.moving = true;
      }
    }

    // Update crab position
    crab.x += moveX * crab.speed;
    crab.y += moveY * crab.speed;

    // Advance leg animation if moving
    if (crab.moving) {
      crab.legCycle += 0.15;
    }
  }

  // Draw crab body, eyes, and four legs (2 per side)
  function drawCrab() {
    ctx.save();
    ctx.translate(crab.x, crab.y);
    ctx.rotate(crab.angle);

    // Draw body
    ctx.fillStyle = 'red';
    ctx.beginPath();
    ctx.ellipse(0, 0, crab.bodySize, crab.bodySize * 0.6, 0, 0, Math.PI * 2);
    ctx.fill();

    // Draw eyes
    ctx.fillStyle = 'white';
    ctx.beginPath();
    ctx.arc(-crab.bodySize * 0.3, -crab.bodySize * 0.6, 5, 0, Math.PI * 2);
    ctx.arc(crab.bodySize * 0.3, -crab.bodySize * 0.6, 5, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = 'black';
    ctx.beginPath();
    ctx.arc(-crab.bodySize * 0.3, -crab.bodySize * 0.6, 2, 0, Math.PI * 2);
    ctx.arc(crab.bodySize * 0.3, -crab.bodySize * 0.6, 2, 0, Math.PI * 2);
    ctx.fill();

    // Draw legs using a sine-wave swing.
    ctx.strokeStyle = 'red';
    ctx.lineWidth = 3;
    // Two legs on left, two on right. Legs are drawn relative to the body.
    // For left side, side = -1; for right side, side = 1.
    drawLeg(-1, -crab.bodySize * 0.3, crab.legCycle);
    drawLeg(-1, crab.bodySize * 0.3, crab.legCycle + Math.PI);
    drawLeg(1, -crab.bodySize * 0.3, crab.legCycle + Math.PI);
    drawLeg(1, crab.bodySize * 0.3, crab.legCycle);

    ctx.restore();
  }

  // Draw a single leg as a line that swings using a sine function.
  // side: -1 (left) or 1 (right), offsetY: vertical offset, phase: phase offset for leg swing.
  function drawLeg(side, offsetY, phase) {
    ctx.save();
    // Base of the leg relative to the crab's center.
    const baseX = side * crab.bodySize;
    ctx.translate(baseX, offsetY);
    // Calculate swing angle: legs on opposite sides swing in opposite directions.
    const swing = Math.sin(phase) * 0.5; // ~ -0.5 to 0.5 radians
    ctx.rotate(swing * side);
    // Draw leg as a simple line.
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.lineTo(side * crab.bodySize * 0.8, 0);
    ctx.stroke();
    ctx.restore();
  }

  function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    update();
    drawCrab();
    requestAnimationFrame(gameLoop);
  }
  gameLoop();
</script>
</body>
</html>