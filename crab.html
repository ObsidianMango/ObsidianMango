<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crab Walker</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #87CEEB;
      touch-action: none; /* Prevent default touch actions */
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  // Crab object with properties
  const crab = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    size: 50,
    speed: 4,
    angle: 0,
    legOffset: 0,
    moving: false
  };

  // Keyboard input state
  const keys = {
    ArrowLeft: false,
    ArrowRight: false,
    ArrowUp: false,
    ArrowDown: false,
    a: false,
    d: false,
    w: false,
    s: false
  };

  // Variables for touch control
  let touchStartX = 0, touchStartY = 0;
  let touchDX = 0, touchDY = 0;
  let touchActive = false;

  // Keyboard event listeners
  document.addEventListener("keydown", e => {
    if (keys.hasOwnProperty(e.key)) {
      keys[e.key] = true;
    }
  });
  document.addEventListener("keyup", e => {
    if (keys.hasOwnProperty(e.key)) {
      keys[e.key] = false;
    }
  });

  // Touch event listeners on the canvas
  canvas.addEventListener("touchstart", e => {
    const touch = e.touches[0];
    touchStartX = touch.clientX;
    touchStartY = touch.clientY;
    touchActive = true;
  });
  canvas.addEventListener("touchmove", e => {
    if (!touchActive) return;
    const touch = e.touches[0];
    touchDX = touch.clientX - touchStartX;
    touchDY = touch.clientY - touchStartY;
    const distance = Math.sqrt(touchDX * touchDX + touchDY * touchDY);
    if (distance > 0) {
      crab.angle = Math.atan2(touchDY, touchDX);
      crab.moving = true;
    } else {
      crab.moving = false;
    }
  });
  canvas.addEventListener("touchend", e => {
    touchActive = false;
    touchDX = 0;
    touchDY = 0;
    crab.moving = false;
  });

  // Update crab position based on input
  function update() {
    let dx = 0, dy = 0;
    crab.moving = false; // Reset moving state

    // Keyboard input
    if (keys.ArrowLeft || keys.a) { dx = -1; crab.angle = Math.PI; crab.moving = true; }
    if (keys.ArrowRight || keys.d) { dx = 1; crab.angle = 0; crab.moving = true; }
    if (keys.ArrowUp || keys.w) { dy = -1; crab.moving = true; }
    if (keys.ArrowDown || keys.s) { dy = 1; crab.moving = true; }

    // Touch input overrides keyboard if active
    if (touchActive) {
      const tLength = Math.sqrt(touchDX * touchDX + touchDY * touchDY);
      if (tLength > 0) {
        dx = touchDX / tLength;
        dy = touchDY / tLength;
        crab.angle = Math.atan2(touchDY, touchDX);
        crab.moving = true;
      }
    }

    // Normalize movement vector
    if (dx !== 0 || dy !== 0) {
      const length = Math.sqrt(dx * dx + dy * dy);
      dx /= length;
      dy /= length;
    }

    // Update crab position and leg animation if moving
    if (crab.moving) {
      crab.x += dx * crab.speed;
      crab.y += dy * crab.speed;
      crab.legOffset += 0.2;
      if (crab.legOffset > Math.PI * 2) {
        crab.legOffset -= Math.PI * 2;
      }
    }
  }

  // Draw the crab with realistic three-segment legs
  function drawCrab() {
    ctx.save();
    ctx.translate(crab.x, crab.y);
    ctx.rotate(crab.angle);

    // Draw crab body
    ctx.fillStyle = "red";
    ctx.beginPath();
    ctx.ellipse(0, 0, crab.size, crab.size * 0.6, 0, 0, Math.PI * 2);
    ctx.fill();

    // Draw realistic legs (three segments per leg, four legs per side)
    ctx.strokeStyle = "red";
    ctx.lineWidth = 5;
    for (let side = -1; side <= 1; side += 2) {
      for (let j = 0; j < 4; j++) {
        let phase = crab.legOffset + j * 0.6;
        let movement = Math.sin(phase) * 8;

        // First segment (base)
        let x1 = side * crab.size * 0.8;
        let y1 = -j * 12;
        // Second segment
        let x2 = x1 + side * (15 + movement);
        let y2 = y1 - (10 - movement);
        // Third segment
        let x3 = x2 + side * (15 - movement);
        let y3 = y2 + (10 + movement);

        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.lineTo(x3, y3);
        ctx.stroke();
      }
    }

    // Draw eyes
    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.arc(-15, -20, 8, 0, Math.PI * 2);
    ctx.arc(15, -20, 8, 0, Math.PI * 2);
    ctx.fill();

    // Draw pupils
    ctx.fillStyle = "black";
    ctx.beginPath();
    ctx.arc(-15, -20, 4, 0, Math.PI * 2);
    ctx.arc(15, -20, 4, 0, Math.PI * 2);
    ctx.fill();

    ctx.restore();
  }

  // Main game loop
  function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    update();
    drawCrab();
    requestAnimationFrame(gameLoop);
  }

  gameLoop();
</script>
</body>
</html>