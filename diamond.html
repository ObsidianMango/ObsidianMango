<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes"> <!-- For better iOS experience -->
    <title>Settings-Enabled Permanent Motion Diamond Ocean Waves</title>
    <style>
        body {
            margin: 0;
            background-color: #000;
            overflow: hidden;
            touch-action: none; /* Prevent default touch behaviors */
        }
        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }
        #gear {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 30px;
            opacity: 0.5;
            cursor: pointer;
            color: white;
            z-index: 10;
        }
        #menu {
            position: fixed;
            top: 50px;
            right: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border: 1px solid #ccc;
            display: none;
            z-index: 10;
            max-width: 300px;
            overflow-y: auto;
            max-height: 80vh;
            color: black;
        }
        #menu label, #menu select, #menu input, #menu button {
            display: block;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="gear" onclick="toggleMenu()">⚙️</div>
    <div id="menu">
        <h3>Emoji Selector</h3>
        <select id="emojiSelect" onchange="changeEmoji(this.value)">
            <optgroup label="Smileys & Emotion">
                <option value="😀">😀 Grinning Face</option>
                <option value="😁">😁 Beaming Face with Smiling Eyes</option>
                <option value="😂">😂 Face with Tears of Joy</option>
                <option value="🤣">🤣 Rolling on the Floor Laughing</option>
                <option value="😃">😃 Grinning Face with Big Eyes</option>
                <option value="😄">😄 Grinning Face with Smiling Eyes</option>
                <option value="😅">😅 Grinning Face with Sweat</option>
                <option value="😆">😆 Grinning Squinting Face</option>
                <option value="😉">😉 Winking Face</option>
                <option value="😊">😊 Smiling Face with Smiling Eyes</option>
            </optgroup>
            <optgroup label="People & Body">
                <option value="👋">👋 Waving Hand</option>
                <option value="🤚">🤚 Raised Back of Hand</option>
                <option value="🖐️">🖐️ Hand with Fingers Splayed</option>
                <option value="✋">✋ Raised Hand</option>
                <option value="🖖">🖖 Vulcan Salute</option>
                <option value="👌">👌 OK Hand</option>
                <option value="🤌">🤌 Pinched Fingers</option>
                <option value="🤏">🤏 Pinching Hand</option>
                <option value="✌️">✌️ Victory Hand</option>
                <option value="🤞">🤞 Crossed Fingers</option>
            </optgroup>
            <optgroup label="Animals & Nature">
                <option value="🐵">🐵 Monkey Face</option>
                <option value="🐶">🐶 Dog Face</option>
                <option value="🐕">🐕 Dog</option>
                <option value="🦮">🦮 Guide Dog</option>
                <option value="🐕‍🦺">🐕‍🦺 Service Dog</option>
                <option value="🐩">🐩 Poodle</option>
                <option value="🐺">🐺 Wolf</option>
                <option value="🦊">🦊 Fox</option>
                <option value="🦝">🦝 Raccoon</option>
                <option value="🐱">🐱 Cat Face</option>
            </optgroup>
            <optgroup label="Food & Drink">
                <option value="🍇">🍇 Grapes</option>
                <option value="🍈">🍈 Melon</option>
                <option value="🍉">🍉 Watermelon</option>
                <option value="🍊">🍊 Tangerine</option>
                <option value="🍋">🍋 Lemon</option>
                <option value="🍌">🍌 Banana</option>
                <option value="🍍">🍍 Pineapple</option>
                <option value="🥭">🥭 Mango</option>
                <option value="🍎">🍎 Red Apple</option>
                <option value="🍏">🍏 Green Apple</option>
            </optgroup>
            <optgroup label="Travel & Places">
                <option value="🌍">🌍 Globe Showing Europe-Africa</option>
                <option value="🌎">🌎 Globe Showing Americas</option>
                <option value="🌏">🌏 Globe Showing Asia-Australia</option>
                <option value="🌐">🌐 Globe with Meridians</option>
                <option value="🗺️">🗺️ World Map</option>
                <option value="🗾">🗾 Map of Japan</option>
                <option value="🧭">🧭 Compass</option>
                <option value="🏔️">🏔️ Snow-Capped Mountain</option>
                <option value="⛰️">⛰️ Mountain</option>
                <option value="🌋">🌋 Volcano</option>
            </optgroup>
            <!-- Add more categories if needed, but keeping it reasonable -->
            <optgroup label="Objects">
                <option value="💎">💎 Gem Stone (Default)</option>
                <option value="📱">📱 Mobile Phone</option>
                <option value="💻">💻 Laptop</option>
                <option value="🖥️">🖥️ Desktop Computer</option>
                <option value="🖨️">🖨️ Printer</option>
                <option value="⌨️">⌨️ Keyboard</option>
                <option value="🖱️">🖱️ Computer Mouse</option>
                <option value="🖲️">🖲️ Trackball</option>
                <option value="🕹️">🖹️ Joystick</option>
                <option value="🗜️">🗜️ Clamp</option>
            </optgroup>
        </select>

        <h3>Wave Settings</h3>
        <label>Wave Speed: <input type="number" id="waveSpeedInput" value="0.05" step="0.01" onchange="waveSpeed = parseFloat(this.value)"></label>
        <label>Wave Frequency: <input type="number" id="waveFrequencyInput" value="0.3" step="0.01" onchange="waveFrequency = parseFloat(this.value)"></label>
        <label>Amplitude: <input type="number" id="amplitudeInput" value="18" step="1" onchange="amplitude = parseFloat(this.value)"></label>
        <label>Base Size: <input type="number" id="baseSizeInput" value="6" step="1" onchange="baseSize = parseFloat(this.value)"></label>
        <label>Ripple Speed: <input type="number" id="rippleSpeedInput" value="0.6" step="0.1" onchange="rippleSpeed = parseFloat(this.value)"></label>
        <label>Ripple Frequency: <input type="number" id="rippleFrequencyInput" value="0.6" step="0.1" onchange="rippleFrequency = parseFloat(this.value)"></label>

        <button onclick="resetToDefault()">Back to Default Settings</button>
    </div>
    <script>
        let emojiChar = '💎'; // Global emoji variable

        function toggleMenu() {
            const menu = document.getElementById('menu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }

        function changeEmoji(newEmoji) {
            emojiChar = newEmoji;
        }

        function resetToDefault() {
            waveSpeed = 0.05;
            waveFrequency = 0.3;
            amplitude = 18;
            baseSize = 6;
            rippleSpeed = 0.6;
            rippleFrequency = 0.6;
            emojiChar = '💎';
            ripples.length = 0; // Optional: clear ripples to reset motion

            // Update inputs
            document.getElementById('waveSpeedInput').value = waveSpeed;
            document.getElementById('waveFrequencyInput').value = waveFrequency;
            document.getElementById('amplitudeInput').value = amplitude;
            document.getElementById('baseSizeInput').value = baseSize;
            document.getElementById('rippleSpeedInput').value = rippleSpeed;
            document.getElementById('rippleFrequencyInput').value = rippleFrequency;
            document.getElementById('emojiSelect').value = '💎';
        }

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // ... (rest of the script remains the same, but replace '💎' in fillText with emojiChar)
        
        // In the draw function:
        // ctx.fillText(emojiChar, posX, posY);

        // Full script below with changes integrated

        // Grid parameters: Further increased cellSize on mobile for smoother performance and less stutter
        const cellSize = isMobile ? 30 : 20; // Larger cells to reduce computations and draws for better responsiveness
        
        // Animation parameters - tuned for more dynamic sloshing
        let time = 0;
        let waveSpeed = isMobile ? 0.05 : 0.07;
        let waveFrequency = 0.3; // Slightly increased for more activity
        let amplitude = isMobile ? 18 : 20; // Increased for bigger variations
        let baseSize = isMobile ? 6 : 4; // Decreased base for higher contrast

        // Ripple parameters - adjusted for permanent motion and instant start from touch point
        const ripples = [];
        let rippleFrequency = 0.6;
        let rippleSpeed = 0.6; // Slightly increased for faster initial propagation from touch point
        const rippleDecay = 0; // No decay for permanent motion
        const rippleMaxDuration = Infinity; // Infinite duration to never settle
        const minDragDistance = 2; // Increased to reduce ripple count during fast swipes
        const maxRipples = 50; // Increased limit to allow more persistent ripples without perf issues

        // Track last ripple position for swipe
        let lastGridX = null;
        let lastGridY = null;
        let isSwiping = false;

        // Simplified base wave function for performance (reduced components to minimize stutter)
        function getBaseWaveHeight(x, y, t) {
            let wave1 = Math.sin(waveFrequency * x + t) * Math.cos(0.5 * waveFrequency * y);
            let wave2 = Math.sin(0.8 * waveFrequency * (x + y) - 1.2 * t);
            let wave3 = Math.sin(waveFrequency * 1.2 * x - 1.5 * t); // Horizontal
            let wave4 = Math.sin(waveFrequency * 0.7 * y - 0.9 * t); // Vertical
            let combined = 1.5 * wave1 + 1.5 * wave2 + 1.8 * wave3 + 1.8 * wave4;
            return (combined + 6) / 12; // Adjusted normalization
        }

        // Ripple height with cos for immediate peak at touch point
        function getRippleHeight(gridX, gridY, t) {
            let rippleHeight = 0;
            for (let i = ripples.length - 1; i >= 0; i--) {
                const ripple = ripples[i];
                const age = t - ripple.startTime;
                if (age > rippleMaxDuration) {
                    ripples.splice(i, 1);
                    continue;
                }
                const dx = gridX - ripple.gridX;
                const dy = gridY - ripple.gridY;
                const dist = Math.sqrt(dx * dx + dy * dy);
                const phase = rippleFrequency * dist - rippleSpeed * age;
                const timeAtten = Math.exp(-rippleDecay * age); // No decay, always 1
                const distAtten = Math.exp(-0.02 * dist); // Slower distance decay for broader waves
                const attenuation = timeAtten * distAtten;
                rippleHeight += Math.cos(phase) * attenuation * 1.2; // Adjusted amplification
            }
            if (ripples.length > maxRipples) {
                ripples.shift(); // Remove oldest if too many
            }
            return rippleHeight;
        }

        // Combined height
        function getWaveHeight(gridX, gridY, t) {
            let base = getBaseWaveHeight(gridX, gridY, t);
            let ripple = getRippleHeight(gridX, gridY, t);
            let combined = base + 0.5 * ripple;
            return Math.min(1.4, Math.max(-0.4, combined)); // Wider clamp for more extreme variations
        }

        // Draw function for immediate updates
        function draw() {
            ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
            
            const cols = Math.floor(window.innerWidth / cellSize);
            const rows = Math.floor(window.innerHeight / cellSize);
            
            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    const height = getWaveHeight(x, y, time);
                    const normalizedHeight = (height + 0.4) / 1.8; // Adjusted normalization for wider clamp
                    const size = baseSize + amplitude * normalizedHeight;
                    
                    ctx.font = `${size}px sans-serif`;
                    ctx.fillStyle = `rgba(0, 191, 255, ${0.6 + 0.4 * normalizedHeight})`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    
                    const posX = x * cellSize + cellSize / 2;
                    const posY = y * cellSize + cellSize / 2;
                    ctx.fillText(emojiChar, posX, posY);
                }
            }
        }

        // Animate loop
        function animate() {
            time += waveSpeed;
            draw();
            requestAnimationFrame(animate);
        }

        animate();

        // Touch handlers with immediate draw on events for instant responsiveness
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const touchX = touch.clientX - canvas.getBoundingClientRect().left;
            const touchY = touch.clientY - canvas.getBoundingClientRect().top;
            
            const gridX = Math.floor(touchX / cellSize);
            const gridY = Math.floor(touchY / cellSize);
            
            ripples.push({ gridX, gridY, startTime: time });
            draw(); // Immediate draw for instant reaction from touch point
            
            lastGridX = gridX;
            lastGridY = gridY;
            isSwiping = false;
        }, { passive: false });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const touchX = touch.clientX - canvas.getBoundingClientRect().left;
            const touchY = touch.clientY - canvas.getBoundingClientRect().top;
            
            const gridX = Math.floor(touchX / cellSize);
            const gridY = Math.floor(touchY / cellSize);
            
            if (lastGridX !== null && lastGridY !== null) {
                const dx = gridX - lastGridX;
                const dy = gridY - lastGridY;
                const dist = Math.sqrt(dx * dx + dy * dy);
                
                if (dist >= minDragDistance) {
                    ripples.push({ gridX, gridY, startTime: time });
                    lastGridX = gridX;
                    lastGridY = gridY;
                    isSwiping = true;
                    draw(); // Immediate draw during swipe for smooth feel
                }
            }
        }, { passive: false });

        canvas.addEventListener('touchend', (e) => {
            if (lastGridX !== null && lastGridY !== null && isSwiping) {
                ripples.push({ gridX: lastGridX, gridY: lastGridY, startTime: time });
                draw(); // Immediate draw on lift for instant reaction from touch off
            }
            lastGridX = null;
            lastGridY = null;
            isSwiping = false;
        }, { passive: false });

        // Handle resize
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(resizeCanvas, 300);
        });
    </script>
</body>
</html>