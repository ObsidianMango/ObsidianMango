<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Mothman Pro Arc</title>
    <style>
        :root {
            --card-w: 84px;
            --card-h: 118px;
            --sidebar-w: 80px;
            --bg-dark: #050505;
            --accent: #b4ff00;
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }

        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; font-family: 'Segoe UI', sans-serif; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 30%, #1a1a1a 0%, #000 100%);
            color: #eee;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- HEADER --- */
        #ui-header {
            height: 44px;
            background: rgba(20, 20, 20, 0.9);
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            z-index: 100;
        }

        .mana-bar { display: flex; gap: 5px; font-size: 0.75rem; font-weight: bold; }
        .m-pill { background: #222; border: 1px solid #444; padding: 2px 6px; border-radius: 4px; color: #fff; min-width: 24px; text-align: center; }

        button { background: #333; border: 1px solid #555; color: #fff; padding: 4px 10px; border-radius: 4px; font-size: 0.8rem; }
        button:active { background: var(--accent); color: black; }

        /* --- BATTLEFIELD --- */
        #playmat {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr var(--sidebar-w);
            grid-template-rows: 1fr 1fr 1fr;
            padding-bottom: 140px; /* Space for hand */
            position: relative;
        }

        .zone {
            display: flex; align-items: center; overflow-x: auto; gap: 4px; padding: 10px 5px;
            border-bottom: 1px solid rgba(255,255,255,0.05); position: relative;
        }
        .zone::after { content: attr(data-label); position: absolute; top: 2px; left: 5px; font-size: 0.55rem; color: #555; text-transform: uppercase; font-weight: bold; }

        #zone-creatures { grid-column: 1; grid-row: 1; }
        #zone-artifacts { grid-column: 1; grid-row: 2; }
        #zone-lands     { grid-column: 1; grid-row: 3; border-bottom: none; }

        /* Sidebar */
        .side-zone {
            border-left: 1px solid rgba(255,255,255,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.2);
        }
        #zone-commander { grid-column: 2; grid-row: 1; }
        #zone-graveyard { grid-column: 2; grid-row: 2; font-size: 0.7rem; color: #888; text-align: center; }
        #zone-library   { grid-column: 2; grid-row: 3; border-bottom: none; }

        /* --- CARDS --- */
        .card {
            width: var(--card-w); height: var(--card-h);
            border-radius: 5px; background: #222; background-size: cover; background-position: center;
            box-shadow: 1px 2px 5px rgba(0,0,0,0.5); flex-shrink: 0; position: relative;
            transition: transform 0.15s;
        }
        .tapped { transform: rotate(90deg); filter: brightness(0.6); }

        .counter-badge {
            position: absolute; top: -5px; right: -5px; background: var(--accent); color: black;
            width: 20px; height: 20px; border-radius: 50%; font-size: 0.75rem; font-weight: bold;
            display: flex; justify-content: center; align-items: center; border: 1px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.5); z-index: 10;
        }

        /* --- HAND ARC (FIXED) --- */
        #hand-wrapper {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            height: 120px; /* Default Height */
            z-index: 500;
            perspective: 800px;
            pointer-events: none; /* Let clicks pass through empty areas */
            padding-bottom: var(--safe-bottom);
            transition: height 0.3s ease;
        }

        #hand-wrapper.expanded {
            height: 100vh; /* Full screen overlay */
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(8px);
            pointer-events: auto; /* Catch clicks to close */
        }

        #hand-anchor {
            position: absolute;
            bottom: 10px; /* Lifted up from bottom edge */
            left: 50%;
            width: 0; height: 0;
            display: flex; justify-content: center; align-items: flex-end;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), bottom 0.4s;
        }

        #hand-wrapper.expanded #hand-anchor {
            bottom: 50%; /* Move to center screen */
            transform: scale(1.3); /* Zoom in */
        }

        .hand-card {
            position: absolute;
            width: 90px; height: 126px;
            background-size: cover; background-position: center;
            border-radius: 6px;
            box-shadow: -2px 0 8px rgba(0,0,0,0.6);
            border: 1px solid #444;
            transform-origin: bottom center;
            pointer-events: auto; /* Cards are clickable */
            bottom: 0; /* Anchor point */
            transition: transform 0.2s;
        }

        .hand-card:hover {
            z-index: 1000 !important;
            transform: translateY(-40px) scale(1.2) !important; /* Pop up on hover */
            border-color: var(--accent);
        }

        /* --- INSPECTOR --- */
        #inspector {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);
            z-index: 2000; display: none;
            flex-direction: column; justify-content: center; align-items: center;
        }

        #insp-view {
            width: 240px; height: 336px;
            background-size: cover; background-position: center;
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            margin-bottom: 20px;
            position: relative;
            transition: transform 0.3s;
        }

        #insp-ui {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 260px;
        }
        
        .insp-btn {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            color: white; padding: 12px; border-radius: 8px; font-size: 1rem;
        }
        .insp-btn:active { background: var(--accent); color: black; border-color: var(--accent); }

        .counter-row {
            grid-column: span 2; display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.4); padding: 5px; border-radius: 8px;
        }
        .c-btn { width: 40px; height: 40px; background: #333; border: none; color: white; border-radius: 6px; font-size: 1.2rem; }

    </style>
</head>
<body>

    <div id="ui-header">
        <div class="mana-bar">
            POOL:
            <span class="m-pill" style="color:#aae0fa">U:<span id="pool-u">0</span></span>
            <span class="m-pill" style="color:#ccc">B:<span id="pool-b">0</span></span>
            <span class="m-pill" style="color:#9bd3ae">G:<span id="pool-g">0</span></span>
            <span class="m-pill" style="color:#aaa">C:<span id="pool-c">0</span></span>
        </div>
        <button onclick="untapAll()">Untap All</button>
    </div>

    <div id="playmat">
        <div id="zone-creatures" class="zone" data-label="CREATURES"></div>
        <div id="zone-artifacts" class="zone" data-label="ARTIFACTS/ENCH"></div>
        <div id="zone-lands" class="zone" data-label="LANDS"></div>

        <div id="zone-commander" class="side-zone"></div>
        <div id="zone-graveyard" class="side-zone">
            <div>GY</div><div id="gy-count" style="font-size:1.2rem; color:#fff; font-weight:bold">0</div>
        </div>
        <div id="zone-library" class="side-zone" onclick="drawCard()">
            <div style="width:50px; height:70px; background:url('https://m.media-amazon.com/images/I/71jKdIXo-tL._AC_UF894,1000_QL80_.jpg'); background-size:cover; border-radius:4px;"></div>
            <div id="lib-count" style="font-size:0.7rem; margin-top:2px;">99</div>
        </div>
    </div>

    <div id="hand-wrapper" onclick="toggleHand(event)">
        <div id="hand-anchor"></div>
    </div>

    <div id="inspector" onclick="closeInsp(event)">
        <div id="insp-view">
            <div id="insp-badge" class="counter-badge" style="display:none; transform:scale(1.5); top:-10px; right:-10px">0</div>
        </div>
        <div id="insp-ui">
            <button class="insp-btn" onclick="act('tap')"><span id="tap-txt">Tap</span></button>
            <button class="insp-btn" style="border-color:#ff4444; color:#ffaaaa" onclick="act('grave')">Destroy</button>
            <div class="counter-row">
                <button class="c-btn" onclick="act('sub')">-</button>
                <span style="font-weight:bold" id="cnt-val">0</span>
                <button class="c-btn" style="color:var(--accent)" onclick="act('add')">+</button>
            </div>
        </div>
        <div style="margin-top:20px; color:#666; font-size:0.8rem">Tap background to close</div>
    </div>

<script>
    // --- FULL DECK (Abbreviated for performance, logic expands it) ---
    // You can paste the full list here. I will use the array provided previously.
    const deckList = [
        { qty: 1, name: "The Wise Mothman", type: "Creature", category: "Commander", setCode: 'pip' },
        { qty: 1, name: "Bruvac the Grandiloquent", type: "Creature" },
        { qty: 1, name: "The Mindskinner", type: "Creature" },
        { qty: 1, name: "Fetid Gargantua", type: "Creature" },
        { qty: 1, name: "Expanding Ooze", type: "Creature" },
        { qty: 1, name: "Ultimecia, Time Sorceress", type: "Creature" },
        { qty: 1, name: "Danny Pink", type: "Creature" },
        { qty: 1, name: "Zellix, Sanity Flayer", type: "Creature" },
        { qty: 1, name: "Syr Konrad, the Grim", type: "Creature" },
        { qty: 1, name: "Consuming Aberration", type: "Creature" },
        { qty: 1, name: "Eternal Witness", type: "Creature", setCode: '2x2', cn: '368' },
        { qty: 1, name: "Thrummingbird", type: "Creature", setCode: 'one', cn: '288' },
        { qty: 1, name: "Evolution Sage", type: "Creature" },
        { qty: 1, name: "Flux Channeler", type: "Creature" },
        { qty: 1, name: "Rishkar, Peema Renegade", type: "Creature" },
        { qty: 1, name: "Bloatfly Swarm", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Corpsejack Menace", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Glowing One", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Harold and Bob, First Numens", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Lily Bowen, Raging Grandma", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Rampaging Yao Guai", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "The Master, Transcendent", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Tireless Tracker", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Vexing Radgull", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Watchful Radstag", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Winding Constrictor", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Maximum Overdrive", type: "Instant" },
        { qty: 1, name: "Origin of Metalbending", type: "Instant" },
        { qty: 1, name: "Brain Freeze", type: "Instant", setCode: 'slc', cn: '2' }, 
        { qty: 1, name: "Narset's Reversal", type: "Instant" },
        { qty: 1, name: "Golgari Charm", type: "Instant", setCode: 'rtr' },
        { qty: 1, name: "Biomass Mutation", type: "Instant", setCode: 'pip' },
        { qty: 1, name: "Inspiring Call", type: "Instant", setCode: 'pip' },
        { qty: 1, name: "Mutational Advantage", type: "Instant", setCode: 'pip' },
        { qty: 1, name: "Putrefy", type: "Instant", setCode: 'pip' },
        { qty: 1, name: "Radstorm", type: "Instant", setCode: 'pip' },
        { qty: 1, name: "Grasping Tentacles", type: "Sorcery" },
        { qty: 1, name: "Eerie Ultimatum", type: "Sorcery", setCode: 'slc', cn: '5' },
        { qty: 1, name: "Nature's Lore", type: "Sorcery", setCode: 'afc', cn: '164' },
        { qty: 1, name: "Victimize", type: "Sorcery" },
        { qty: 1, name: "Casualties of War", type: "Sorcery", setCode: 'pip' },
        { qty: 1, name: "Cultivate", type: "Sorcery", setCode: 'pip' },
        { qty: 1, name: "Farseek", type: "Sorcery", setCode: 'pip' },
        { qty: 1, name: "Mesmeric Orb", type: "Artifact", setCode: 'brr', cn: '31' },
        { qty: 1, name: "Codex Shredder", type: "Artifact", setCode: 'sld' },
        { qty: 1, name: "Mindcrank", type: "Artifact", setCode: 'sld' },
        { qty: 1, name: "Arcane Signet", type: "Artifact", setCode: 'pip' },
        { qty: 1, name: "Contagion Clasp", type: "Artifact", setCode: 'pip' },
        { qty: 1, name: "Power Fist", type: "Artifact", setCode: 'pip' },
        { qty: 1, name: "Recon Craft Theta", type: "Artifact", setCode: 'pip' },
        { qty: 1, name: "Sol Ring", type: "Artifact", setCode: 'pip' },
        { qty: 1, name: "Talisman of Curiosity", type: "Artifact", setCode: 'pip' },
        { qty: 1, name: "Talisman of Dominance", type: "Artifact", setCode: 'pip' },
        { qty: 1, name: "Dictate of Erebos", type: "Enchantment" },
        { qty: 1, name: "Bloodchief Ascension", type: "Enchantment" },
        { qty: 1, name: "Fertile Ground", type: "Enchantment", setCode: 'sld', cn: '1846' },
        { qty: 1, name: "Branching Evolution", type: "Enchantment", setCode: 'pip' },
        { qty: 1, name: "Fraying Sanity", type: "Enchantment", setCode: 'pip' },
        { qty: 1, name: "Guardian Project", type: "Enchantment", setCode: 'pip' },
        { qty: 1, name: "Hardened Scales", type: "Enchantment", setCode: 'pip' },
        { qty: 1, name: "Inexorable Tide", type: "Enchantment", setCode: 'pip' },
        { qty: 1, name: "Struggle for Project Purity", type: "Enchantment", setCode: 'pip' },
        { qty: 1, name: "Takenuma, Abandoned Mire", type: "Land" },
        { qty: 1, name: "Rejuvenating Springs", type: "Land" },
        { qty: 1, name: "Vesuva", type: "Land" },
        { qty: 1, name: "Ash Barrens", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Command Tower", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Darkwater Catacombs", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Drowned Catacomb", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Evolving Wilds", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Exotic Orchard", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Fetid Pools", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Hinterland Harbor", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Mariposa Military Base", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Nesting Grounds", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Opulent Palace", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Overflowing Basin", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Path of Ancestry", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Sunken Hollow", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Tainted Isle", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Tainted Wood", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Temple of Deceit", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Temple of Malady", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Viridescent Bog", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Woodland Cemetery", type: "Land", setCode: 'pip' },
        { qty: 5, name: "Island", type: "Land", setCode: 'pip' },
        { qty: 5, name: "Swamp", type: "Land", setCode: 'pip' },
        { qty: 5, name: "Forest", type: "Land", setCode: 'pip' },
    ];

    let library = [], hand = [], grave = [], activeCard = null;
    let mana = {u:0, b:0, g:0, c:0};
    const imgCache = {};

    function init() {
        // Expand Deck
        deckList.forEach(c => {
            if(c.category === 'Commander') {
                createCard(c, 'zone-commander');
            } else {
                for(let i=0; i<c.qty; i++) {
                    library.push({...c, id: Math.random().toString(36).substr(2,9), counters:0, tapped:false});
                }
            }
        });
        library.sort(() => Math.random() - 0.5);
        updateCounts();
        for(let i=0; i<7; i++) drawCard();
    }

    async function createCard(data, zoneId) {
        const el = document.createElement('div');
        el.className = zoneId === 'hand-anchor' ? 'hand-card' : 'card';
        el.id = data.id || 'cmd';
        
        // Data binding
        el.dataset.name = data.name;
        el.dataset.type = data.type;
        el.dataset.tapped = 'false';
        el.dataset.counters = 0;

        const url = await getImg(data);
        el.style.backgroundImage = `url('${url}')`;

        const badge = document.createElement('div');
        badge.className = 'counter-badge';
        badge.style.display = 'none';
        badge.innerText = '0';
        el.appendChild(badge);

        el.onclick = (e) => {
            e.stopPropagation();
            if(zoneId === 'hand-anchor') playCard(el, data);
            else if(zoneId === 'zone-commander') playCard(el, data);
            else openInsp(el);
        };

        const container = zoneId === 'hand-anchor' ? document.getElementById('hand-anchor') : document.getElementById(zoneId);
        container.appendChild(el);
        
        if(zoneId === 'hand-anchor') updateHandArc();
    }

    async function getImg(data) {
        const k = data.name + (data.setCode||'');
        if(imgCache[k]) return imgCache[k];
        let u = `https://api.scryfall.com/cards/named?fuzzy=${encodeURIComponent(data.name)}`;
        if(data.setCode) u += `&set=${data.setCode}`;
        if(data.cn) u = `https://api.scryfall.com/cards/${data.setCode}/${data.cn}`;
        try {
            const r = await fetch(u);
            const j = await r.json();
            const i = j.image_uris ? j.image_uris.normal : j.card_faces[0].image_uris.normal;
            imgCache[k] = i; return i;
        } catch { return 'https://via.placeholder.com/200'; }
    }

    // --- HAND ARC MATH ---
    function updateHandArc() {
        const container = document.getElementById('hand-anchor');
        const cards = Array.from(container.children);
        const count = cards.length;
        // Logic: Keep angle tight, but allow width.
        const baseAngle = 30; // total arc degree
        const step = Math.min(6, baseAngle / Math.max(count-1, 1));
        const totalW = Math.min(window.innerWidth - 40, count * 40); // Max width of fan
        const startX = -totalW / 2;
        const stepX = totalW / Math.max(count-1, 1);

        cards.forEach((c, i) => {
            const angle = (i - (count-1)/2) * 5; // Rotation
            const x = (i - (count-1)/2) * 30; // X Spread
            const y = Math.abs(angle) * 1.5; // Slight curve down
            
            c.style.transform = `translateX(${x}px) translateY(${y}px) rotate(${angle}deg)`;
            c.style.zIndex = i;
        });
    }

    function toggleHand(e) {
        if(e.target.id === 'hand-wrapper' || e.target.id === 'hand-anchor') {
            document.getElementById('hand-wrapper').classList.toggle('expanded');
        }
    }

    // --- PLAY & LOGIC ---
    function playCard(el, data) {
        // Move to board
        el.remove();
        
        let zone = 'zone-artifacts';
        if(data.type.includes('Land')) zone = 'zone-lands';
        else if(data.type.includes('Creature')) zone = 'zone-creatures';

        // Recreate simple card
        const newEl = el.cloneNode(true);
        newEl.className = 'card';
        newEl.style.transform = 'none';
        newEl.onclick = (e) => { e.stopPropagation(); openInsp(newEl); };
        
        document.getElementById(zone).appendChild(newEl);
        updateHandArc();

        // Auto Tap Land (sim)
        if(data.type.includes('Land')) {
            // newEl.classList.add('tapped');
            // newEl.dataset.tapped = 'true';
            // Infer Mana
            if(data.name.includes('Island')) addMana('u');
            else if(data.name.includes('Swamp')) addMana('b');
            else if(data.name.includes('Forest')) addMana('g');
            else addMana('c');
        }
    }

    function drawCard() {
        if(!library.length) return;
        const c = library.pop();
        createCard(c, 'hand-anchor');
        updateCounts();
    }

    function addMana(t) {
        mana[t]++;
        document.getElementById(`pool-${t}`).innerText = mana[t];
    }

    function updateCounts() {
        document.getElementById('lib-count').innerText = library.length;
        document.getElementById('gy-count').innerText = grave.length;
    }

    function untapAll() {
        document.querySelectorAll('.tapped').forEach(e => {
            e.classList.remove('tapped'); e.dataset.tapped = 'false';
        });
        mana = {u:0, b:0, g:0, c:0};
        ['u','b','g','c'].forEach(k => document.getElementById(`pool-${k}`).innerText = 0);
    }

    // --- INSPECTOR ---
    function openInsp(el) {
        activeCard = el;
        const v = document.getElementById('insp-view');
        v.style.backgroundImage = el.style.backgroundImage;
        
        // Sync
        const t = el.dataset.tapped === 'true';
        v.style.transform = t ? 'rotate(90deg)' : 'none';
        document.getElementById('tap-txt').innerText = t ? 'Untap' : 'Tap';
        
        const c = parseInt(el.dataset.counters);
        document.getElementById('cnt-val').innerText = c;
        const b = document.getElementById('insp-badge');
        b.style.display = c > 0 ? 'flex' : 'none';
        b.innerText = c;

        document.getElementById('inspector').style.display = 'flex';
    }

    function closeInsp(e) {
        if(e.target.id === 'inspector') document.getElementById('inspector').style.display = 'none';
    }

    function act(a) {
        if(!activeCard) return;
        if(a === 'tap') {
            const t = activeCard.dataset.tapped === 'true';
            if(t) {
                activeCard.classList.remove('tapped'); activeCard.dataset.tapped='false';
                document.getElementById('insp-view').style.transform = 'none';
                document.getElementById('tap-txt').innerText = 'Tap';
            } else {
                activeCard.classList.add('tapped'); activeCard.dataset.tapped='true';
                document.getElementById('insp-view').style.transform = 'rotate(90deg)';
                document.getElementById('tap-txt').innerText = 'Untap';
                
                // Mana Check
                const n = activeCard.dataset.name;
                if(n.includes('Island')) addMana('u');
                else if(n.includes('Swamp')) addMana('b');
                else if(n.includes('Forest')) addMana('g');
            }
        }
        if(a === 'add' || a === 'sub') {
            let c = parseInt(activeCard.dataset.counters);
            if(a==='add') c++; else c = Math.max(0, c-1);
            activeCard.dataset.counters = c;
            
            // Update UI
            const b = activeCard.querySelector('.counter-badge');
            b.innerText = c; b.style.display = c>0?'flex':'none';
            document.getElementById('cnt-val').innerText = c;
            const ib = document.getElementById('insp-badge');
            ib.innerText = c; ib.style.display = c>0?'flex':'none';
        }
        if(a === 'grave') {
            activeCard.remove();
            grave.push(1); updateCounts();
            document.getElementById('inspector').style.display = 'none';
        }
    }

    init();

</script>
</body>
</html>
