<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mothman Playmat Sim</title>
    <style>
        :root {
            --card-w: 110px;
            --card-h: 154px;
            --sidebar-w: 130px;
            --bg-dark: #0d0d0d;
            --zone-bg: rgba(255, 255, 255, 0.03);
            --border-color: #333;
            --accent: #b4ff00; /* Mothman Green */
            --card-back-url: url('https://m.media-amazon.com/images/I/71jKdIXo-tL._AC_UF894,1000_QL80_.jpg');
        }

        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; }

        body {
            margin: 0;
            background-color: var(--bg-dark);
            color: #eee;
            font-family: 'Segoe UI', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- UI BAR --- */
        #ui-bar {
            height: 40px;
            background: #111;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 10px;
            justify-content: space-between;
            z-index: 100;
        }
        
        button {
            background: #333; border: 1px solid #555; color: #fff;
            padding: 4px 10px; border-radius: 4px; cursor: pointer;
        }
        button:active { background: var(--accent); color: #000; }

        /* --- MAIN GRID LAYOUT --- */
        #playmat {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr var(--sidebar-w);
            grid-template-rows: 1fr 1fr 1fr; /* Creatures, Artifacts, Lands */
            height: calc(100vh - 180px); /* Subtract Header + Hand */
        }

        /* --- ZONES --- */
        .zone {
            border-right: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            position: relative;
            padding: 25px 10px 10px 10px;
            overflow-x: auto;
            overflow-y: hidden;
            display: flex;
            align-items: center;
            gap: 5px;
            background: var(--zone-bg);
        }

        .zone::before {
            content: attr(data-label);
            position: absolute;
            top: 5px; left: 10px;
            font-size: 0.7rem;
            color: #555;
            text-transform: uppercase;
            font-weight: bold;
            pointer-events: none;
        }

        /* Specific Zones */
        #zone-creatures { grid-column: 1; grid-row: 1; }
        #zone-artifacts { grid-column: 1; grid-row: 2; }
        #zone-lands     { grid-column: 1; grid-row: 3; border-bottom: none; }

        /* Sidebar Zones */
        .sidebar-zone {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            background: rgba(0,0,0,0.3);
            position: relative;
        }
        
        #zone-commander { grid-column: 2; grid-row: 1; }
        #zone-graveyard { grid-column: 2; grid-row: 2; }
        #zone-library   { grid-column: 2; grid-row: 3; border-bottom: none; }

        /* --- HAND (Fixed Bottom) --- */
        #hand-container {
            height: 140px;
            background: #080808;
            border-top: 1px solid var(--accent);
            display: flex;
            align-items: center;
            padding: 0 10px;
            overflow-x: auto;
            gap: -10px; /* Overlap */
            z-index: 500;
        }

        /* --- CARD STYLING --- */
        .card {
            width: var(--card-w);
            height: var(--card-h);
            border-radius: 6px;
            background-color: #222;
            background-size: cover;
            background-position: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.5);
            transition: transform 0.1s;
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
            border: 1px solid #111;
        }

        /* Hand Logic */
        #hand-container .card {
            transform-origin: bottom center;
            margin-right: -40px; /* Fan effect */
            transition: margin 0.2s, transform 0.2s;
        }
        #hand-container .card:hover {
            transform: translateY(-30px) scale(1.2);
            z-index: 999;
            margin-right: 10px;
            box-shadow: 0 0 15px var(--accent);
        }

        /* Battlefield Logic */
        .zone .card:hover {
            transform: scale(1.05);
            z-index: 100;
        }

        .tapped {
            transform: rotate(90deg) !important;
            filter: brightness(0.7);
        }

        /* Library & Face Down */
        .card-back {
            background-image: var(--card-back-url);
            background-size: cover;
            background-position: center;
            width: 100%; height: 100%;
            border-radius: 6px;
        }

        #library-pile {
            width: 80px; height: 112px;
            border-radius: 5px;
            background-image: var(--card-back-url);
            background-size: cover;
            box-shadow: 2px 2px 0 #333, 4px 4px 0 #222;
            cursor: pointer;
            position: relative;
        }
        
        /* Counters */
        .counter {
            position: absolute;
            background: var(--accent);
            color: #000;
            font-weight: bold;
            font-size: 0.8rem;
            padding: 2px 6px;
            border-radius: 10px;
            bottom: -8px; right: -8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        /* Loading State */
        .loading { opacity: 0.5; animation: pulse 1s infinite; }
        @keyframes pulse { 50% { opacity: 0.2; } }

        /* Mobile Tweak */
        @media (max-width: 768px) {
            :root { --card-w: 80px; --card-h: 112px; --sidebar-w: 90px; }
            #hand-container .card { margin-right: -25px; }
        }

    </style>
</head>
<body>

    <div id="ui-bar">
        <span style="color:var(--accent); font-weight:bold;">MOTHMAN SIM</span>
        <div>
            <button onclick="untapAll()">Untap All</button>
            <button onclick="resetGame()">Reset</button>
        </div>
    </div>

    <div id="playmat">
        <div id="zone-creatures" class="zone" data-label="Creatures"></div>
        <div id="zone-artifacts" class="zone" data-label="Artifacts / Enchantments"></div>
        <div id="zone-lands" class="zone" data-label="Lands"></div>

        <div id="zone-commander" class="sidebar-zone">
            <span style="font-size:0.6rem; color:#666; position:absolute; top:5px;">COMMANDER</span>
        </div>
        
        <div id="zone-graveyard" class="sidebar-zone">
            <span style="font-size:0.6rem; color:#666; position:absolute; top:5px;">GRAVEYARD</span>
            <div id="gy-pile" style="width:80%; height:70%; border:2px dashed #444; border-radius:6px; display:flex; justify-content:center; align-items:center; color:#444;">
                GY <span id="gy-count" style="margin-left:5px">0</span>
            </div>
        </div>
        
        <div id="zone-library" class="sidebar-zone">
            <div id="library-pile" onclick="drawCard()">
                <div id="lib-count" class="counter">99</div>
            </div>
            <span style="font-size:0.6rem; color:#666; margin-top:5px;">LIBRARY</span>
        </div>
    </div>

    <div id="hand-container">
        </div>

<script>
    // --- DATA ---
    const deckList = [
        { qty: 1, name: "The Wise Mothman", type: "Creature", category: "Commander", setCode: 'pip' },
        // ... (Using the same list structure as before, condensed for brevity in logic)
        { qty: 1, name: "Bruvac the Grandiloquent", type: "Creature" },
        { qty: 1, name: "The Mindskinner", type: "Creature" },
        { qty: 1, name: "Fetid Gargantua", type: "Creature" },
        { qty: 1, name: "Expanding Ooze", type: "Creature" },
        { qty: 1, name: "Ultimecia, Time Sorceress", type: "Creature" },
        { qty: 1, name: "Danny Pink", type: "Creature" },
        { qty: 1, name: "Zellix, Sanity Flayer", type: "Creature" },
        { qty: 1, name: "Syr Konrad, the Grim", type: "Creature" },
        { qty: 1, name: "Consuming Aberration", type: "Creature" },
        { qty: 1, name: "Eternal Witness", type: "Creature", setCode: '2x2', cn: '368' },
        { qty: 1, name: "Thrummingbird", type: "Creature", setCode: 'one', cn: '288' },
        { qty: 1, name: "Evolution Sage", type: "Creature" },
        { qty: 1, name: "Flux Channeler", type: "Creature" },
        { qty: 1, name: "Rishkar, Peema Renegade", type: "Creature" },
        { qty: 1, name: "Bloatfly Swarm", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Corpsejack Menace", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Glowing One", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Harold and Bob, First Numens", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Lily Bowen, Raging Grandma", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Rampaging Yao Guai", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "The Master, Transcendent", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Tireless Tracker", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Vexing Radgull", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Watchful Radstag", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Winding Constrictor", type: "Creature", setCode: 'pip' },
        { qty: 1, name: "Maximum Overdrive", type: "Instant" },
        { qty: 1, name: "Origin of Metalbending", type: "Instant" },
        { qty: 1, name: "Brain Freeze", type: "Instant", setCode: 'slc', cn: '2' }, 
        { qty: 1, name: "Narset's Reversal", type: "Instant" },
        { qty: 1, name: "Golgari Charm", type: "Instant", setCode: 'rtr' },
        { qty: 1, name: "Biomass Mutation", type: "Instant", setCode: 'pip' },
        { qty: 1, name: "Inspiring Call", type: "Instant", setCode: 'pip' },
        { qty: 1, name: "Mutational Advantage", type: "Instant", setCode: 'pip' },
        { qty: 1, name: "Putrefy", type: "Instant", setCode: 'pip' },
        { qty: 1, name: "Radstorm", type: "Instant", setCode: 'pip' },
        { qty: 1, name: "Grasping Tentacles", type: "Sorcery" },
        { qty: 1, name: "Eerie Ultimatum", type: "Sorcery", setCode: 'slc', cn: '5' },
        { qty: 1, name: "Nature's Lore", type: "Sorcery", setCode: 'afc', cn: '164' },
        { qty: 1, name: "Victimize", type: "Sorcery" },
        { qty: 1, name: "Casualties of War", type: "Sorcery", setCode: 'pip' },
        { qty: 1, name: "Cultivate", type: "Sorcery", setCode: 'pip' },
        { qty: 1, name: "Farseek", type: "Sorcery", setCode: 'pip' },
        { qty: 1, name: "Mesmeric Orb", type: "Artifact", setCode: 'brr', cn: '31' },
        { qty: 1, name: "Codex Shredder", type: "Artifact", setCode: 'sld' },
        { qty: 1, name: "Mindcrank", type: "Artifact", setCode: 'sld' },
        { qty: 1, name: "Arcane Signet", type: "Artifact", setCode: 'pip' },
        { qty: 1, name: "Contagion Clasp", type: "Artifact", setCode: 'pip' },
        { qty: 1, name: "Power Fist", type: "Artifact", setCode: 'pip' },
        { qty: 1, name: "Recon Craft Theta", type: "Artifact", setCode: 'pip' },
        { qty: 1, name: "Sol Ring", type: "Artifact", setCode: 'pip' },
        { qty: 1, name: "Talisman of Curiosity", type: "Artifact", setCode: 'pip' },
        { qty: 1, name: "Talisman of Dominance", type: "Artifact", setCode: 'pip' },
        { qty: 1, name: "Dictate of Erebos", type: "Enchantment" },
        { qty: 1, name: "Bloodchief Ascension", type: "Enchantment" },
        { qty: 1, name: "Fertile Ground", type: "Enchantment", setCode: 'sld', cn: '1846' },
        { qty: 1, name: "Branching Evolution", type: "Enchantment", setCode: 'pip' },
        { qty: 1, name: "Fraying Sanity", type: "Enchantment", setCode: 'pip' },
        { qty: 1, name: "Guardian Project", type: "Enchantment", setCode: 'pip' },
        { qty: 1, name: "Hardened Scales", type: "Enchantment", setCode: 'pip' },
        { qty: 1, name: "Inexorable Tide", type: "Enchantment", setCode: 'pip' },
        { qty: 1, name: "Struggle for Project Purity", type: "Enchantment", setCode: 'pip' },
        { qty: 1, name: "Takenuma, Abandoned Mire", type: "Land" },
        { qty: 1, name: "Rejuvenating Springs", type: "Land" },
        { qty: 1, name: "Vesuva", type: "Land" },
        { qty: 1, name: "Ash Barrens", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Command Tower", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Darkwater Catacombs", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Drowned Catacomb", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Evolving Wilds", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Exotic Orchard", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Fetid Pools", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Hinterland Harbor", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Mariposa Military Base", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Nesting Grounds", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Opulent Palace", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Overflowing Basin", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Path of Ancestry", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Sunken Hollow", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Tainted Isle", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Tainted Wood", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Temple of Deceit", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Temple of Malady", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Viridescent Bog", type: "Land", setCode: 'pip' },
        { qty: 1, name: "Woodland Cemetery", type: "Land", setCode: 'pip' },
        { qty: 5, name: "Island", type: "Land", setCode: 'pip' },
        { qty: 5, name: "Swamp", type: "Land", setCode: 'pip' },
        { qty: 5, name: "Forest", type: "Land", setCode: 'pip' },
    ];

    // --- STATE ---
    let library = [];
    let graveyard = [];
    let commander = null;
    let cardCache = {}; 

    // --- INITIALIZATION ---
    function init() {
        resetGame();
    }

    function resetGame() {
        library = [];
        graveyard = [];
        document.getElementById('zone-creatures').innerHTML = '';
        document.getElementById('zone-artifacts').innerHTML = '';
        document.getElementById('zone-lands').innerHTML = '';
        document.getElementById('zone-commander').innerHTML = '<span style="font-size:0.6rem; color:#666; position:absolute; top:5px;">COMMANDER</span>';
        document.getElementById('hand-container').innerHTML = '';
        
        processDeck();
        shuffleLibrary();
        
        // Spawn Commander
        createCard(commander, document.getElementById('zone-commander'), 'commander');
        
        // Draw 7
        for(let i=0; i<7; i++) drawCard();
    }

    function processDeck() {
        deckList.forEach(entry => {
            if (entry.category === "Commander") {
                commander = { ...entry, id: 'cmd' };
            } else {
                for (let i = 0; i < entry.qty; i++) {
                    library.push({ ...entry, id: Math.random().toString(36).substr(2,9) });
                }
            }
        });
        updateCounts();
    }

    function shuffleLibrary() {
        for (let i = library.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [library[i], library[j]] = [library[j], library[i]];
        }
    }

    function drawCard() {
        if(library.length === 0) return;
        const data = library.pop();
        updateCounts();
        createCard(data, document.getElementById('hand-container'), 'hand');
    }

    function updateCounts() {
        document.getElementById('lib-count').innerText = library.length;
        document.getElementById('gy-count').innerText = graveyard.length;
    }

    async function createCard(data, container, zone) {
        const el = document.createElement('div');
        el.className = 'card loading';
        el.id = data.id;
        
        // Image Logic
        let imgUrl = await getCardImage(data);
        el.style.backgroundImage = `url('${imgUrl}')`;
        el.classList.remove('loading');

        // Events
        el.onclick = () => handleCardClick(el, data, container);
        el.oncontextmenu = (e) => { e.preventDefault(); moveToGraveyard(el); };

        container.appendChild(el);
    }

    async function getCardImage(data) {
        const key = data.name + (data.setCode || '');
        if(cardCache[key]) return cardCache[key];

        let url = data.setCode 
            ? `https://api.scryfall.com/cards/named?exact=${encodeURIComponent(data.name)}&set=${data.setCode}`
            : `https://api.scryfall.com/cards/named?fuzzy=${encodeURIComponent(data.name)}`;
        
        if(data.cn && data.setCode) url = `https://api.scryfall.com/cards/${data.setCode}/${data.cn}`;

        try {
            const res = await fetch(url);
            const json = await res.json();
            let img = json.image_uris ? json.image_uris.normal : json.card_faces[0].image_uris.normal;
            cardCache[key] = img;
            return img;
        } catch {
            return 'https://via.placeholder.com/200';
        }
    }

    function handleCardClick(el, data, currentContainer) {
        // If in Hand or Commander Zone -> Play to Field
        if (currentContainer.id === 'hand-container' || currentContainer.id === 'zone-commander') {
            playCard(el, data);
        } else {
            // If on field -> Tap
            el.classList.toggle('tapped');
        }
    }

    function playCard(el, data) {
        el.classList.remove('tapped'); // Reset state
        el.style.transform = 'none'; // Reset hover/hand transforms
        
        // Auto-Sort Logic
        let targetId = 'zone-artifacts';
        if (data.type.includes('Land')) targetId = 'zone-lands';
        else if (data.type.includes('Creature')) targetId = 'zone-creatures';
        
        document.getElementById(targetId).appendChild(el);
    }

    function moveToGraveyard(el) {
        graveyard.push(el.id);
        updateCounts();
        
        // Visual feedback (shrink into GY pile)
        el.style.transition = 'all 0.5s';
        const gyRect = document.getElementById('gy-pile').getBoundingClientRect();
        const cardRect = el.getBoundingClientRect();
        
        // Calculate translation to GY center
        // Since we are removing element, we just destroy it for now visually
        el.style.opacity = '0';
        el.style.transform = 'scale(0)';
        setTimeout(() => el.remove(), 500);
    }

    function untapAll() {
        document.querySelectorAll('.tapped').forEach(c => c.classList.remove('tapped'));
    }

    init();
</script>
</body>
</html>
