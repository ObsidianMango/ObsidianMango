<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Prosper Ultimate Tactical Board</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    <style>
        body { background: #0c0c0e; color: #e2e8f0; height: 100vh; overflow: hidden; font-family: system-ui, -apple-system, sans-serif; }
        .zone { border: 2px dashed #27272a; border-radius: 12px; min-height: 100px; transition: all 0.2s; display: flex; flex-wrap: wrap; gap: 12px; padding: 15px; overflow-y: auto; align-content: flex-start; }
        .drop-active { border-color: #f97316; background: rgba(249, 115, 22, 0.05); }

        /* Enhanced Card Interactions */
        .card-container { 
            width: 105px; 
            touch-action: none; 
            position: relative; 
            z-index: 10; 
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .card-container:hover { 
            transform: scale(1.8) translateY(-30px) !important; 
            z-index: 9999; 
        }
        
        /* Tap Mechanics */
        .tapped { transform: rotate(90deg); margin: 0 20px; }
        .tapped .control-panel { transform: rotate(-90deg) translateY(15px); } 

        .card-img { width: 100%; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.7); pointer-events: none; border: 1px solid #333; }
        
        /* Floating Controls on Card */
        .control-panel {
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 3px;
            background: rgba(0, 0, 0, 0.9);
            padding: 3px 6px;
            border-radius: 6px;
            border: 1px solid #555;
            backdrop-filter: blur(4px);
            z-index: 100;
        }
        .btn-ctrl { color: white; font-size: 10px; font-weight: bold; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; border-radius: 4px; transition: filter 0.2s; }
        .btn-ctrl:hover { filter: brightness(1.3); }
        
        .counter-badge { 
            position: absolute; top: -12px; right: -12px; 
            background: #ef4444; color: white; border-radius: 50%; 
            width: 26px; height: 26px; display: flex; align-items: center; 
            justify-content: center; font-size: 13px; font-weight: bold; border: 2px solid #000;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }

        /* Layout cleanup */
        h3 { font-size: 10px; font-weight: 900; letter-spacing: 0.1em; margin-bottom: 4px; color: #71717a; text-transform: uppercase; }
    </style>
</head>
<body class="flex flex-col">

    <header class="p-4 bg-zinc-900 border-b border-zinc-800 flex justify-between items-center shadow-2xl z-50">
        <div class="flex items-center gap-8">
            <h1 class="text-orange-500 font-black italic text-2xl tracking-tighter">PROSPER // TACTICAL</h1>
            <div class="flex items-center bg-black rounded-full px-5 py-1.5 border border-zinc-700">
                <button onclick="adjLife(-1)" class="text-red-500 font-bold text-xl px-2">-</button>
                <span id="life-display" class="font-mono text-3xl px-3 text-white">40</span>
                <button onclick="adjLife(1)" class="text-green-500 font-bold text-xl px-2">+</button>
            </div>
        </div>
        <div class="flex gap-4">
            <button onclick="openBinder()" class="bg-zinc-800 hover:bg-zinc-700 px-5 py-2 rounded font-bold text-xs border border-zinc-600">BINDER (TUTOR)</button>
            <button onclick="drawRandom()" class="bg-orange-600 hover:bg-orange-500 px-5 py-2 rounded font-bold text-xs shadow-lg shadow-orange-900/40">RANDOM DRAW</button>
        </div>
    </header>

    <main class="flex-grow p-4 grid grid-cols-6 grid-rows-3 gap-4 overflow-hidden">
        <div class="col-span-5 row-span-2 flex flex-col gap-3">
            <div class="flex-grow flex flex-col">
                <h3>Battlefield</h3>
                <div id="zone-field" class="zone flex-grow bg-zinc-900/10"></div>
            </div>
            <div class="h-1/3 flex flex-col">
                <h3>Lands / Artifact Mana</h3>
                <div id="zone-lands" class="zone flex-grow bg-zinc-900/10"></div>
            </div>
        </div>

        <div class="col-span-1 row-span-3 flex flex-col gap-4">
            <div class="flex-grow flex flex-col">
                <h3 class="text-orange-500">Exile (Prosper)</h3>
                <div id="zone-exile" class="zone flex-grow border-orange-900/30 bg-orange-950/10"></div>
            </div>
            <div class="h-1/3 flex flex-col">
                <h3>Graveyard</h3>
                <div id="zone-grave" class="zone flex-grow opacity-50"></div>
            </div>
            <div class="h-32 flex flex-col">
                <h3 class="text-blue-500">Commander</h3>
                <div id="zone-commander" class="zone flex-grow border-blue-900/20"></div>
            </div>
        </div>

        <div class="col-span-5 row-span-1 flex flex-col">
            <h3>Hand</h3>
            <div id="zone-hand" class="zone h-full border-none justify-center items-center -space-x-12 hover:space-x-4 transition-all overflow-visible"></div>
        </div>
    </main>

    <div id="binder-modal" class="fixed inset-0 bg-black/98 z-[9999] hidden p-10 flex flex-col">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-4xl font-black text-orange-500 tracking-tighter">DECK BINDER</h2>
            <div class="flex gap-4">
                <input type="text" id="binder-search" oninput="renderBinder()" placeholder="Search library..." class="bg-zinc-900 border-2 border-zinc-700 px-6 py-2 rounded-lg w-80 outline-none focus:border-orange-500">
                <button onclick="closeBinder()" class="text-5xl text-zinc-600 hover:text-white">&times;</button>
            </div>
        </div>
        <div id="binder-grid" class="grid grid-cols-2 md:grid-cols-5 lg:grid-cols-8 gap-6 overflow-y-auto pr-4"></div>
    </div>

    <script>
        const fullDeckList = [
            { qty: 1, name: "Prosper, Tome-Bound", type: "Creature", category: "Commander" },
            { qty: 1, name: "Dockside Extortionist", type: "Creature" },
            { qty: 1, name: "Professional Face-Breaker", type: "Creature" },
            { qty: 1, name: "Xorn", type: "Creature" },
            { qty: 1, name: "Academy Manufactor", type: "Creature" },
            { qty: 1, name: "Grim Hireling", type: "Creature" },
            { qty: 1, name: "Mayhem Devil", type: "Creature" },
            { qty: 1, name: "Marionette Master", type: "Creature" },
            { qty: 1, name: "Birgi, God of Storytelling", type: "Creature" },
            { qty: 1, name: "Etali, Primal Storm", type: "Creature" },
            { qty: 1, name: "Dauthi Voidwalker", type: "Creature" },
            { qty: 1, name: "Ragavan, Nimble Pilferer", type: "Creature" },
            { qty: 1, name: "Author of Shadows", type: "Creature" },
            { qty: 1, name: "Gonti, Lord of Luxury", type: "Creature" },
            { qty: 1, name: "Dire Fleet Hoarder", type: "Creature" },
            { qty: 1, name: "Kalain, Reclusive Painter", type: "Creature" },
            { qty: 1, name: "Magda, Brazen Outlaw", type: "Creature" },
            { qty: 1, name: "Loyal Apprentice", type: "Creature" },
            { qty: 1, name: "Goldspan Dragon", type: "Creature" },
            { qty: 1, name: "Valakut Exploration", type: "Creature" },
            { qty: 1, name: "Stolen Strategy", type: "Creature" },
            { qty: 1, name: "Wild-Magic Sorcerer", type: "Creature" },
            { qty: 1, name: "Dream Devourer", type: "Creature" },
            { qty: 1, name: "Storm-Kiln Artist", type: "Creature" },
            { qty: 1, name: "Tectonic Giant", type: "Creature" },
            { qty: 1, name: "Laelia, the Blade Reforged", type: "Creature" },
            { qty: 1, name: "Orcish Bowmasters", type: "Creature" },
            { qty: 1, name: "Opposition Agent", type: "Creature" },
            { qty: 1, name: "Atsushi, the Blazing Sky", type: "Creature" },
            { qty: 1, name: "Jeska's Will", type: "Sorcery" },
            { qty: 1, name: "Light Up the Stage", type: "Sorcery" },
            { qty: 1, name: "Chaos Warp", type: "Instant" },
            { qty: 1, name: "Bedevil", type: "Instant" },
            { qty: 1, name: "Terminate", type: "Instant" },
            { qty: 1, name: "Vandalblast", type: "Sorcery" },
            { qty: 1, name: "Toxic Deluge", type: "Sorcery" },
            { qty: 1, name: "Deadly Rollick", type: "Instant" },
            { qty: 1, name: "Deflecting Swat", type: "Instant" },
            { qty: 1, name: "Tibalt's Trickery", type: "Instant" },
            { qty: 1, name: "Feed the Swarm", type: "Sorcery" },
            { qty: 1, name: "Night's Whisper", type: "Sorcery" },
            { qty: 1, name: "Commune with Lava", type: "Instant" },
            { qty: 1, name: "You Find Some Prisoners", type: "Instant" },
            { qty: 1, name: "Reckless Impulse", type: "Sorcery" },
            { qty: 1, name: "Wrenn's Resolve", type: "Sorcery" },
            { qty: 1, name: "Damnation", type: "Sorcery" },
            { qty: 1, name: "Blasphemous Act", type: "Sorcery" },
            { qty: 1, name: "Rakdos Charm", type: "Instant" },
            { qty: 1, name: "Invert Polarity", type: "Instant" },
            { qty: 1, name: "Mizzix's Mastery", type: "Sorcery" },
            { qty: 1, name: "Brass's Bounty", type: "Sorcery" },
            { qty: 1, name: "Sol Ring", type: "Artifact" },
            { qty: 1, name: "Arcane Signet", type: "Artifact" },
            { qty: 1, name: "Rakdos Signet", type: "Artifact" },
            { qty: 1, name: "Talisman of Indulgence", type: "Artifact" },
            { qty: 1, name: "Bucknard's Everfull Purse", type: "Artifact" },
            { qty: 1, name: "Lightning Greaves", type: "Artifact" },
            { qty: 1, name: "Swiftfoot Boots", type: "Artifact" },
            { qty: 1, name: "Sensei's Divining Top", type: "Artifact" },
            { qty: 1, name: "Skullclamp", type: "Artifact" },
            { qty: 1, name: "Bolas's Citadel", type: "Artifact" },
            { qty: 1, name: "Aetherflux Reservoir", type: "Artifact" },
            { qty: 1, name: "Shadowspear", type: "Artifact" },
            { qty: 1, name: "Revel in Riches", type: "Enchantment" },
            { qty: 1, name: "Black Market Connections", type: "Enchantment" },
            { qty: 1, name: "Command Tower", type: "Land" },
            { qty: 1, name: "Luxury Suite", type: "Land" },
            { qty: 1, name: "Graven Cairns", type: "Land" },
            { qty: 1, name: "Dragonskull Summit", type: "Land" },
            { qty: 1, name: "Mount Doom", type: "Land" },
            { qty: 1, name: "Bloodstained Mire", type: "Land" },
            { qty: 1, name: "Badlands", type: "Land" },
            { qty: 1, name: "Blood Crypt", type: "Land" },
            { qty: 1, name: "Urborg, Tomb of Yawgmoth", type: "Land" },
            { qty: 1, name: "Cabal Coffers", type: "Land" },
            { qty: 1, name: "Ancient Tomb", type: "Land" },
            { qty: 1, name: "Bojuka Bog", type: "Land" },
            { qty: 1, name: "Reliquary Tower", type: "Land" },
            { qty: 11, name: "Mountain", type: "Land" },
            { qty: 11, name: "Swamp", type: "Land" }
        ];

        let library = [];
        let state = { life: 40, hand: [], field: [], lands: [], exile: [], grave: [], commander: [] };

        async function init() {
            let idCount = 0;
            fullDeckList.forEach(c => {
                for(let i=0; i<c.qty; i++) {
                    library.push({
                        ...c, id: `mtg-${idCount++}`, tapped: false, counters: 0,
                        img: `https://api.scryfall.com/cards/named?exact=${encodeURIComponent(c.name)}&format=image`
                    });
                }
            });
            const cmdIdx = library.findIndex(c => c.category === "Commander");
            state.commander.push(library.splice(cmdIdx, 1)[0]);
            render();
            setupDND();
        }

        function setupDND() {
            interact('.card-container').draggable({
                listeners: {
                    move(event) {
                        const t = event.target;
                        const x = (parseFloat(t.getAttribute('data-x')) || 0) + event.dx;
                        const y = (parseFloat(t.getAttribute('data-y')) || 0) + event.dy;
                        t.style.transform = `translate(${x}px, ${y}px)`;
                        t.setAttribute('data-x', x); t.setAttribute('data-y', y);
                    },
                    end(event) {
                        event.target.style.transform = '';
                        event.target.setAttribute('data-x', 0); event.target.setAttribute('data-y', 0);
                    }
                }
            });

            interact('.zone').dropzone({
                accept: '.card-container',
                overlap: 0.5,
                ondragenter: e => e.target.classList.add('drop-active'),
                ondragleave: e => e.target.classList.remove('drop-active'),
                ondrop: (e) => {
                    moveCard(e.relatedTarget.id, e.target.id.replace('zone-', ''));
                    e.target.classList.remove('drop-active');
                }
            });
        }

        function moveCard(id, to) {
            let card;
            ['hand', 'field', 'lands', 'exile', 'grave', 'commander'].forEach(z => {
                const idx = state[z].findIndex(c => c.id === id);
                if (idx !== -1) card = state[z].splice(idx, 1)[0];
            });
            if (!card) {
                const libIdx = library.findIndex(c => c.id === id);
                if (libIdx !== -1) card = library.splice(libIdx, 1)[0];
            }
            if (card) { state[to].push(card); render(); }
        }

        function toggleTap(id, e) {
            e.stopPropagation();
            ['field', 'lands', 'exile', 'commander'].forEach(z => {
                const c = state[z].find(card => card.id === id);
                if (c) c.tapped = !c.tapped;
            });
            render();
        }

        function modCounter(id, amt, e) {
            e.stopPropagation();
            ['field', 'lands', 'exile'].forEach(z => {
                const c = state[z].find(card => card.id === id);
                if (c) c.counters = Math.max(0, c.counters + amt);
            });
            render();
        }

        function drawRandom() { if(library.length) { state.hand.push(library.splice(Math.floor(Math.random()*library.length),1)[0]); render(); } }
        function adjLife(n) { state.life += n; render(); }
        function openBinder() { document.getElementById('binder-modal').classList.remove('hidden'); renderBinder(); }
        function closeBinder() { document.getElementById('binder-modal').classList.add('hidden'); }

        function renderBinder() {
            const query = document.getElementById('binder-search').value.toLowerCase();
            const grid = document.getElementById('binder-grid');
            grid.innerHTML = library.filter(c => c.name.toLowerCase().includes(query))
                .map(c => `<img src="${c.img}" class="rounded-lg cursor-pointer hover:scale-110 transition shadow-lg w-full" onclick="moveCard('${c.id}', 'hand'); closeBinder()">`).join('');
        }

        function render() {
            document.getElementById('life-display').innerText = state.life;
            ['hand', 'field', 'lands', 'exile', 'grave', 'commander'].forEach(z => {
                document.getElementById(`zone-${z}`).innerHTML = state[z].map(c => `
                    <div class="card-container ${c.tapped ? 'tapped' : ''}" id="${c.id}">
                        <img src="${c.img}" class="card-img">
                        <div class="control-panel">
                            <button class="btn-ctrl bg-blue-600" onclick="toggleTap('${c.id}', event)">T</button>
                            <button class="btn-ctrl bg-green-600" onclick="modCounter('${c.id}', 1, event)">+</button>
                            <button class="btn-ctrl bg-red-600" onclick="modCounter('${c.id}', -1, event)">-</button>
                        </div>
                        ${c.counters > 0 ? `<div class="counter-badge">${c.counters}</div>` : ''}
                    </div>
                `).join('');
            });
        }
        init();
    </script>
</body>
</html>
