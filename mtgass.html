<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MTG Prosper Digital Partner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    <style>
        body { background: #0c0c0e; color: #e2e8f0; height: 100vh; overflow: hidden; font-family: sans-serif; }
        .zone { border: 2px dashed #27272a; border-radius: 8px; min-height: 120px; transition: all 0.2s; display: flex; flex-wrap: wrap; gap: 8px; padding: 10px; overflow-y: auto; }
        .drop-active { border-color: #f97316; background: rgba(249, 115, 22, 0.1); }
        .card-container { width: 90px; touch-action: none; position: relative; z-index: 10; transition: transform 0.1s; }
        .card-img { width: 100%; border-radius: 6px; box-shadow: 0 4px 8px rgba(0,0,0,0.5); pointer-events: none; }
        .tapped { transform: rotate(90deg); margin: 0 12px; }
        .counter-badge { position: absolute; top: -8px; right: -8px; background: #ef4444; color: white; border-radius: 50%; width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold; border: 2px solid #000; }
        .card-controls { position: absolute; bottom: -10px; left: 0; right: 0; display: none; justify-content: center; gap: 2px; z-index: 50; }
        .card-container:hover .card-controls { display: flex; }
        .control-btn { background: #18181b; border: 1px solid #3f3f46; padding: 2px 5px; border-radius: 4px; font-size: 10px; }
        .control-btn:hover { background: #27272a; }
    </style>
</head>
<body class="flex flex-col">

    <header class="p-3 bg-zinc-900 border-b border-zinc-800 flex justify-between items-center shadow-xl">
        <div class="flex items-center gap-6">
            <h1 class="text-orange-500 font-black italic text-xl tracking-tighter">PROSPER // ENGINE</h1>
            <div class="flex items-center bg-black rounded-full px-4 py-1 border border-zinc-700">
                <button onclick="adjLife(-1)" class="text-red-500 font-bold px-2">-</button>
                <span id="life-display" class="font-mono text-2xl px-2">40</span>
                <button onclick="adjLife(1)" class="text-green-500 font-bold px-2">+</button>
            </div>
        </div>
        <div class="flex gap-3">
            <button onclick="openBinder()" class="bg-zinc-800 hover:bg-zinc-700 px-4 py-2 rounded text-xs font-bold uppercase border border-zinc-600">Search Library</button>
            <button onclick="drawRandom()" class="bg-orange-600 hover:bg-orange-500 px-4 py-2 rounded text-xs font-bold uppercase shadow-lg shadow-orange-900/20">Draw Random</button>
        </div>
    </header>

    <main class="flex-grow p-4 grid grid-cols-5 grid-rows-3 gap-4 overflow-hidden">
        <div class="col-span-4 row-span-2 flex flex-col gap-2">
            <div class="flex-grow flex flex-col">
                <span class="text-[10px] uppercase text-zinc-500 font-bold ml-1 mb-1">Permanents (Non-Land)</span>
                <div id="zone-field" class="zone flex-grow"></div>
            </div>
            <div class="h-1/3 flex flex-col">
                <span class="text-[10px] uppercase text-zinc-500 font-bold ml-1 mb-1">Mana Pool / Lands</span>
                <div id="zone-lands" class="zone flex-grow"></div>
            </div>
        </div>

        <div class="col-span-1 row-span-3 flex flex-col gap-4">
            <div class="flex-grow flex flex-col">
                <span class="text-[10px] uppercase text-orange-500 font-bold">Exile (Prosper)</span>
                <div id="zone-exile" class="zone flex-grow border-orange-900/40 bg-orange-950/5"></div>
            </div>
            <div class="h-48 flex flex-col">
                <span class="text-[10px] uppercase text-zinc-500 font-bold">Graveyard</span>
                <div id="zone-grave" class="zone h-full opacity-60"></div>
            </div>
            <div class="h-32 flex flex-col">
                <span class="text-[10px] uppercase text-blue-500 font-bold">Commander Zone</span>
                <div id="zone-commander" class="zone h-full"></div>
            </div>
        </div>

        <div class="col-span-4 row-span-1 flex flex-col">
            <span class="text-[10px] uppercase text-zinc-500 font-bold ml-1 mb-1">Player Hand</span>
            <div id="zone-hand" class="zone h-full bg-zinc-900/30 -space-x-12 hover:space-x-2 transition-all border-none justify-center items-center"></div>
        </div>
    </main>

    <div id="binder-modal" class="fixed inset-0 bg-black/95 z-[100] hidden p-8 flex flex-col">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold text-orange-500">Deck Library</h2>
            <div class="flex gap-4">
                <input type="text" id="binder-search" oninput="renderBinder()" placeholder="Search by name..." class="bg-zinc-800 border border-zinc-700 px-4 py-2 rounded w-80">
                <button onclick="closeBinder()" class="text-4xl">&times;</button>
            </div>
        </div>
        <div id="binder-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4 overflow-y-auto pr-4"></div>
    </div>

    <script>
        const rawDeckData = [
            { qty: 1, name: "Prosper, Tome-Bound", type: "Creature", category: "Commander" },
            { qty: 1, name: "Dockside Extortionist", type: "Creature" },
            { qty: 1, name: "Professional Face-Breaker", type: "Creature" },
            { qty: 1, name: "Xorn", type: "Creature" },
            { qty: 1, name: "Academy Manufactor", type: "Creature" },
            { qty: 1, name: "Grim Hireling", type: "Creature" },
            { qty: 1, name: "Mayhem Devil", type: "Creature" },
            { qty: 1, name: "Marionette Master", type: "Creature" },
            { qty: 1, name: "Birgi, God of Storytelling", type: "Creature" },
            { qty: 1, name: "Etali, Primal Storm", type: "Creature" },
            { qty: 1, name: "Dauthi Voidwalker", type: "Creature" },
            { qty: 1, name: "Ragavan, Nimble Pilferer", type: "Creature" },
            { qty: 1, name: "Author of Shadows", type: "Creature" },
            { qty: 1, name: "Gonti, Lord of Luxury", type: "Creature" },
            { qty: 1, name: "Dire Fleet Hoarder", type: "Creature" },
            { qty: 1, name: "Kalain, Reclusive Painter", type: "Creature" },
            { qty: 1, name: "Magda, Brazen Outlaw", type: "Creature" },
            { qty: 1, name: "Loyal Apprentice", type: "Creature" },
            { qty: 1, name: "Goldspan Dragon", type: "Creature" },
            { qty: 1, name: "Valakut Exploration", type: "Creature" },
            { qty: 1, name: "Stolen Strategy", type: "Creature" },
            { qty: 1, name: "Wild-Magic Sorcerer", type: "Creature" },
            { qty: 1, name: "Dream Devourer", type: "Creature" },
            { qty: 1, name: "Storm-Kiln Artist", type: "Creature" },
            { qty: 1, name: "Tectonic Giant", type: "Creature" },
            { qty: 1, name: "Laelia, the Blade Reforged", type: "Creature" },
            { qty: 1, name: "Orcish Bowmasters", type: "Creature" },
            { qty: 1, name: "Opposition Agent", type: "Creature" },
            { qty: 1, name: "Atsushi, the Blazing Sky", type: "Creature" },
            { qty: 1, name: "Jeska's Will", type: "Sorcery" },
            { qty: 1, name: "Light Up the Stage", type: "Sorcery" },
            { qty: 1, name: "Chaos Warp", type: "Instant" },
            { qty: 1, name: "Bedevil", type: "Instant" },
            { qty: 1, name: "Terminate", type: "Instant" },
            { qty: 1, name: "Vandalblast", type: "Sorcery" },
            { qty: 1, name: "Toxic Deluge", type: "Sorcery" },
            { qty: 1, name: "Deadly Rollick", type: "Instant" },
            { qty: 1, name: "Deflecting Swat", type: "Instant" },
            { qty: 1, name: "Tibalt's Trickery", type: "Instant" },
            { qty: 1, name: "Feed the Swarm", type: "Sorcery" },
            { qty: 1, name: "Night's Whisper", type: "Sorcery" },
            { qty: 1, name: "Commune with Lava", type: "Instant" },
            { qty: 1, name: "You Find Some Prisoners", type: "Instant" },
            { qty: 1, name: "Reckless Impulse", type: "Sorcery" },
            { qty: 1, name: "Wrenn's Resolve", type: "Sorcery" },
            { qty: 1, name: "Damnation", type: "Sorcery" },
            { qty: 1, name: "Blasphemous Act", type: "Sorcery" },
            { qty: 1, name: "Rakdos Charm", type: "Instant" },
            { qty: 1, name: "Invert Polarity", type: "Instant" },
            { qty: 1, name: "Mizzix's Mastery", type: "Sorcery" },
            { qty: 1, name: "Brass's Bounty", type: "Sorcery" },
            { qty: 1, name: "Sol Ring", type: "Artifact" },
            { qty: 1, name: "Arcane Signet", type: "Artifact" },
            { qty: 1, name: "Rakdos Signet", type: "Artifact" },
            { qty: 1, name: "Talisman of Indulgence", type: "Artifact" },
            { qty: 1, name: "Bucknard's Everfull Purse", type: "Artifact" },
            { qty: 1, name: "Lightning Greaves", type: "Artifact" },
            { qty: 1, name: "Swiftfoot Boots", type: "Artifact" },
            { qty: 1, name: "Sensei's Divining Top", type: "Artifact" },
            { qty: 1, name: "Skullclamp", type: "Artifact" },
            { qty: 1, name: "Bolas's Citadel", type: "Artifact" },
            { qty: 1, name: "Aetherflux Reservoir", type: "Artifact" },
            { qty: 1, name: "Shadowspear", type: "Artifact" },
            { qty: 1, name: "Revel in Riches", type: "Enchantment" },
            { qty: 1, name: "Black Market Connections", type: "Enchantment" },
            { qty: 1, name: "Command Tower", type: "Land" },
            { qty: 1, name: "Luxury Suite", type: "Land" },
            { qty: 1, name: "Graven Cairns", type: "Land" },
            { qty: 1, name: "Dragonskull Summit", type: "Land" },
            { qty: 1, name: "Mount Doom", type: "Land" },
            { qty: 1, name: "Bloodstained Mire", type: "Land" },
            { qty: 1, name: "Badlands", type: "Land" },
            { qty: 1, name: "Blood Crypt", type: "Land" },
            { qty: 1, name: "Urborg, Tomb of Yawgmoth", type: "Land" },
            { qty: 1, name: "Cabal Coffers", type: "Land" },
            { qty: 1, name: "Ancient Tomb", type: "Land" },
            { qty: 1, name: "Bojuka Bog", type: "Land" },
            { qty: 1, name: "Reliquary Tower", type: "Land" },
            { qty: 11, name: "Mountain", type: "Land" },
            { qty: 11, name: "Swamp", type: "Land" }
        ];

        let library = [];
        let state = { life: 40, hand: [], field: [], lands: [], exile: [], grave: [], commander: [] };

        async function init() {
            // Unpack deck based on qty
            let idCounter = 0;
            rawDeckData.forEach(card => {
                for(let i=0; i<card.qty; i++) {
                    library.push({
                        ...card, 
                        id: `mtg-${idCounter++}`,
                        tapped: false,
                        counters: 0,
                        img: `https://api.scryfall.com/cards/named?exact=${encodeURIComponent(card.name)}&format=image`
                    });
                }
            });
            
            // Move Commander automatically
            const cmdIdx = library.findIndex(c => c.category === "Commander");
            state.commander.push(library.splice(cmdIdx, 1)[0]);
            
            render();
            setupDND();
        }

        function setupDND() {
            interact('.card-container').draggable({
                listeners: {
                    move(event) {
                        const t = event.target;
                        const x = (parseFloat(t.getAttribute('data-x')) || 0) + event.dx;
                        const y = (parseFloat(t.getAttribute('data-y')) || 0) + event.dy;
                        t.style.transform = `translate(${x}px, ${y}px)`;
                        t.setAttribute('data-x', x);
                        t.setAttribute('data-y', y);
                        t.style.zIndex = 1000;
                    },
                    end(event) {
                        event.target.style.transform = '';
                        event.target.setAttribute('data-x', 0);
                        event.target.setAttribute('data-y', 0);
                        event.target.style.zIndex = 10;
                    }
                }
            });

            interact('.zone').dropzone({
                accept: '.card-container',
                overlap: 0.5,
                ondragenter: e => e.target.classList.add('drop-active'),
                ondragleave: e => e.target.classList.remove('drop-active'),
                ondrop: (event) => {
                    const cardId = event.relatedTarget.id;
                    const zoneName = event.target.id.replace('zone-', '');
                    moveCard(cardId, zoneName);
                    event.target.classList.remove('drop-active');
                }
            });
        }

        function moveCard(id, toZone) {
            let card;
            // Find in current zones
            ['hand', 'field', 'lands', 'exile', 'grave', 'commander'].forEach(z => {
                const idx = state[z].findIndex(c => c.id === id);
                if (idx !== -1) card = state[z].splice(idx, 1)[0];
            });
            // Check library if not found
            if (!card) {
                const libIdx = library.findIndex(c => c.id === id);
                if (libIdx !== -1) card = library.splice(libIdx, 1)[0];
            }

            if (card) {
                state[toZone].push(card);
                render();
            }
        }

        function toggleTap(id) {
            ['field', 'lands', 'exile'].forEach(z => {
                const card = state[z].find(c => c.id === id);
                if (card) card.tapped = !card.tapped;
            });
            render();
        }

        function modCounter(id, amt) {
            ['field', 'lands', 'exile'].forEach(z => {
                const card = state[z].find(c => c.id === id);
                if (card) card.counters = Math.max(0, card.counters + amt);
            });
            render();
        }

        function drawRandom() {
            if (library.length > 0) {
                const card = library.splice(Math.floor(Math.random() * library.length), 1)[0];
                state.hand.push(card);
                render();
            }
        }

        function adjLife(n) { state.life += n; render(); }
        function openBinder() { document.getElementById('binder-modal').classList.remove('hidden'); renderBinder(); }
        function closeBinder() { document.getElementById('binder-modal').classList.add('hidden'); }

        function renderBinder() {
            const query = document.getElementById('binder-search').value.toLowerCase();
            const grid = document.getElementById('binder-grid');
            grid.innerHTML = library
                .filter(c => c.name.toLowerCase().includes(query))
                .map(c => `<img src="${c.img}" class="rounded-lg cursor-pointer hover:scale-110 transition w-full" onclick="moveCard('${c.id}', 'hand'); closeBinder()">`)
                .join('');
        }

        function render() {
            document.getElementById('life-display').innerText = state.life;
            ['hand', 'field', 'lands', 'exile', 'grave', 'commander'].forEach(z => {
                document.getElementById(`zone-${z}`).innerHTML = state[z].map(c => `
                    <div class="card-container ${c.tapped ? 'tapped' : ''}" id="${c.id}" onclick="if(event.ctrlKey) toggleTap('${c.id}')">
                        <img src="${c.img}" class="card-img shadow-2xl">
                        <div class="card-controls">
                            <button class="control-btn text-blue-400" onclick="toggleTap('${c.id}')">Tap</button>
                            <button class="control-btn text-green-400" onclick="modCounter('${c.id}', 1)">+</button>
                            <button class="control-btn text-red-400" onclick="modCounter('${c.id}', -1)">-</button>
                        </div>
                        ${c.counters > 0 ? `<div class="counter-badge">${c.counters}</div>` : ''}
                    </div>
                `).join('');
            });
        }

        init();
    </script>
</body>
</html>
