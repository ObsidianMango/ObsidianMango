<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pebble Flow</title>
  <style>
    html,body{margin:0;padding:0;overflow:hidden;background:#222;}
    #hud{position:absolute;top:10px;left:10px;color:#fff;font-family:sans-serif;font-size:14px}
    canvas{display:block}
  </style>
</head>
<body>
<canvas id="game"></canvas>
<div id="hud"></div>

<script>
/* ---------- basic canvas setup ---------- */
const canvas = document.getElementById('game');
const ctx     = canvas.getContext('2d');
let W,H;
function resize(){ W = canvas.width  = innerWidth; 
                   H = canvas.height = innerHeight; }
addEventListener('resize', resize); resize();

/* ---------- game constants ---------- */
const GRAVITY      = 0.35;   // vertical acceleration
const SLOPE_FORCE  = 0.55;   // horizontal “down-hill” pull
const GROUND_Y     = H - 22; // flat ground strip
const MAX_DEBRIS   = 30;     // how many loose stones to keep ahead
const LANDSLIDE_AT = 25;     // pebble mass → win condition

/* ---------- player (the pebble) ---------- */
const pebble = {
  x: 120, y: 80,           // position
  vx: 0,   vy: 0,           // velocity
  r: 10, mass: 1           // size & score
};

/* ---------- world junk to absorb ---------- */
const debris = [];
function spawnDebris(){
  while(debris.length < MAX_DEBRIS){
    const r = 4 + Math.random()*9;           // radius 4-13 px
    debris.push({ x: W + Math.random()*W,    // spawn ahead
                  y: Math.random()*(H-120),  // random height
                  r, collected:false });
  }
}

/* ---------- core update step ---------- */
let distance = 0, landslide = false;
function update(){
  if(landslide) return;

  // gravity + downhill acceleration
  pebble.vx += SLOPE_FORCE;
  pebble.vy += GRAVITY;

  // integrate position
  pebble.x += pebble.vx;
  pebble.y += pebble.vy;
  distance += pebble.vx * 0.016;

  // bounce on “ground”
  if(pebble.y + pebble.r > GROUND_Y){
    pebble.y  = GROUND_Y - pebble.r;
    pebble.vy = -pebble.vy * 0.35;           // lose some vertical speed
  }

  // world scrolls opposite pebble motion
  debris.forEach(d => d.x -= pebble.vx);

  // collisions → grow
  debris.forEach(d => {
    if(d.collected) return;
    const dx = pebble.x - d.x, dy = pebble.y - d.y;
    if(Math.hypot(dx,dy) < pebble.r + d.r){
      d.collected = true;
      pebble.mass += d.r/6;
      pebble.r    += d.r*0.12;
      pebble.vx   += 0.65;                    // momentum kick
    }
  });

  // win?
  if(pebble.mass >= LANDSLIDE_AT){
    landslide = true;
    setTimeout(()=>alert('LANDSLIDE! You won. Reload to roll again.'),10);
  }

  spawnDebris();
}

/* ---------- render step ---------- */
function draw(){
  ctx.fillStyle = '#222';
  ctx.fillRect(0,0,W,H);

  // ground strip
  ctx.fillStyle = '#444';
  ctx.fillRect(0,GROUND_Y,W,H-GROUND_Y);

  // debris
  ctx.fillStyle = '#666';
  debris.forEach(d=>{
    if(!d.collected){
      ctx.beginPath();
      ctx.arc(d.x,d.y,d.r,0,Math.PI*2);
      ctx.fill();
    }
  });

  // pebble
  ctx.fillStyle = '#c9c9c9';
  ctx.beginPath();
  ctx.arc(pebble.x,pebble.y,pebble.r,0,Math.PI*2);
  ctx.fill();

  // HUD
  hud.textContent =
    `Mass: ${pebble.mass.toFixed(1)}  |  Momentum: ${pebble.vx.toFixed(1)}  |  Distance: ${distance|0}`;
}

/* ---------- main loop ---------- */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
spawnDebris();
loop();
</script>
</body>
</html>