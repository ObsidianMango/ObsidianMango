<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>4‑7‑8 Breathing</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body {
      width:100%; height:100%; overflow:hidden;
      display:flex; align-items:center; justify-content:center;
      background:#121212; font-family:sans-serif; position:relative;
    }
    #progress {
      position:absolute; top:0; left:0;
      width:0%; height:100%; background:#4caf50;
      z-index:0; transition:none;
    }
    #container {
      position:relative; z-index:1;
      display:flex; flex-direction:column; align-items:center;
    }
    #label {
      color:#fff; font-size:1.5rem; margin-bottom:10px;
      text-transform:capitalize;
    }
    #circle {
      width:200px; height:200px; border-radius:50%;
      background:#222; display:flex;
      align-items:center; justify-content:center;
      color:#fff; font-size:4rem; cursor:pointer;
      transition:background .5s, transform 1s ease-in-out;
      position:relative; overflow:hidden;
    }
    #circle::before {
      content:''; position:absolute;
      width:250px; height:250px; border-radius:50%;
      border:2px dashed rgba(255,255,255,0.5);
      transform:scale(1); opacity:1;
      /* We'll only animate this on exhale */
    }
    #circle.inhale::before {
      transform: scale(0.6);
      transition: transform 4s ease-in-out;
    }
    #circle.exhale::before {
      animation: flowOut 8s linear forwards;
    }
    @keyframes flowOut {
      from { transform: scale(1); opacity: 1; }
      to   { transform: scale(2); opacity: 0; }
    }
  </style>
</head>
<body>
  <div id="progress"></div>
  <div id="container">
    <div id="label">Start</div>
    <div id="circle">Start</div>
  </div>

  <script>
    const label  = document.getElementById('label');
    const circle = document.getElementById('circle');
    const prog   = document.getElementById('progress');
    let running = false;

    circle.addEventListener('click', () => {
      if (!running) startBreathing();
    });

    async function startBreathing() {
      running = true;
      while (true) {
        await phase(4, '#4caf50', 'inhale', 1.6);
        await phase(7, '#b71c1c', 'hold',   1.0);
        await phase(8, '#2196f3', 'exhale', 0.7);
      }
    }

    async function phase(sec, color, mode, scale) {
      // progress bar fill
      prog.style.background = color;
      prog.style.transition = `width ${sec}s linear`;
      prog.style.width = '0%';
      requestAnimationFrame(()=> prog.style.width = '100%');

      // label & circle visuals
      label.textContent = mode;
      circle.style.background = color;
      circle.className = mode;
      circle.style.transform = `scale(${scale})`;

      // countdown number
      for (let i = sec; i > 0; i--) {
        circle.textContent = i;
        await new Promise(r => setTimeout(r, 1000));
      }
    }
  </script>
</body>
</html>
